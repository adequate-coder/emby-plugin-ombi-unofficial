define(["exports","./../approuter.js","./../emby-apiclient/events.js","./../common/methodtimer.js"],function(_exports,_approuter,_events,_methodtimer){function onEndedInternal(instance,triggerStopped){!function(instance){instance.timeUpdateInterval&&instance.timeUpdateInterval.destroy(),instance.timeUpdateInterval=null}(instance);var resizeListener=instance.resizeListener;resizeListener&&(window.removeEventListener("resize",resizeListener),window.removeEventListener("orientationChange",resizeListener),instance.resizeListener=null),triggerStopped&&_events.default.trigger(instance,"stopped",[{}]),instance.currentYoutubePlayer&&instance.currentYoutubePlayer.destroy(),instance.currentYoutubePlayer=null}function setCurrentSrc(instance,elem,options,signal){var reason;return signal.aborted?((reason=signal.reason)||((reason=new Error("Aborted")).name="AbortError"),Promise.reject(reason)):(options.fullscreen&&_approuter.default.showVideoOsd(),new Promise(function(resolve,reject){var params,_reason,firstScriptTag;signal.aborted?((_reason=signal.reason)||((_reason=new Error("Aborted")).name="AbortError"),reject(_reason)):(console.log("youtube playing: "+options.url),params=new URLSearchParams(options.url.split("?")[1]),window.onYouTubeIframeAPIReady=function(){var _reason2;signal.aborted?((_reason2=signal.reason)||((_reason2=new Error("Aborted")).name="AbortError"),reject(_reason2)):(instance.currentYoutubePlayer=new YT.Player("player",{height:instance.videoDialog.offsetHeight,width:instance.videoDialog.offsetWidth,videoId:params.get("v"),events:{onReady:function(event){var _reason3;signal.aborted?(stopInternal(instance,!0,!1),(_reason3=signal.reason)||((_reason3=new Error("Aborted")).name="AbortError"),reject(_reason3)):event.target.playVideo()},onStateChange:function(event){if(event.data===YT.PlayerState.PLAYING){var _reason4,rejectFn=reject;if(reject=null,resolve){if(signal.aborted)return stopInternal(instance,!0,!1),void(rejectFn&&((_reason4=signal.reason)||((_reason4=new Error("Aborted")).name="AbortError"),rejectFn(_reason4)));resolve(),resolve=null}instance.timeUpdateInterval||(instance.timeUpdateInterval=new _methodtimer.default({onInterval:function(e){_events.default.trigger(this,"timeupdate")}.bind(instance),timeoutMs:500,type:"interval"}))}else event.data===YT.PlayerState.ENDED?onEndedInternal(instance,!0):event.data===YT.PlayerState.PAUSED&&_events.default.trigger(instance,"pause")},onError:function(event){console.log("youtubeplayer, received error code during playback : "+event.data);event=reject;event?(reject=null,event()):_events.default.trigger(instance,"error")}},playerVars:{controls:0,enablejsapi:1,modestbranding:1,rel:0,showinfo:0,fs:0,playsinline:1}}),(_reason2=instance.resizeListener)?window.removeEventListener("resize",_reason2):_reason2=instance.resizeListener=function(){var instance=this;setTimeout(function(){var player=instance.currentYoutubePlayer,dlg=instance.videoDialog;player&&dlg&&player.setSize(dlg.offsetWidth,dlg.offsetHeight)},100)}.bind(instance),window.addEventListener("resize",_reason2),window.removeEventListener("orientationChange",_reason2),window.addEventListener("orientationChange",_reason2))},window.YT?window.onYouTubeIframeAPIReady():((_reason=document.createElement("script")).src="https://www.youtube.com/iframe_api",(firstScriptTag=document.getElementsByTagName("script")[0]).parentNode.insertBefore(_reason,firstScriptTag)))}))}function YoutubePlayer(){this.name="Youtube Player",this.type="mediaplayer",this.id="youtubeplayer",this.priority=1}function stopInternal(instance,destroyPlayer,triggerStopped){var currentYoutubePlayer=instance.currentYoutubePlayer;currentYoutubePlayer&&(currentYoutubePlayer.stopVideo&&currentYoutubePlayer.stopVideo(),onEndedInternal(instance,triggerStopped)),destroyPlayer&&instance.destroy()}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,require(["css!modules/youtubeplayer/style.css"]),YoutubePlayer.prototype.play=function(options,signal){!function(instance){var dlg=document.querySelector(".youtubePlayerContainer");dlg?dlg.classList.add("youtubePlayerContainer"):((dlg=document.createElement("div")).classList.add("youtubePlayerContainer"),dlg.innerHTML='<div id="player"></div>',document.body.insertBefore(dlg,document.body.firstChild),instance.videoDialog=dlg),dlg.querySelector("#player")}(this);return setCurrentSrc(this,0,options,signal)},YoutubePlayer.prototype.isPlaying=function(){return null!=this.currentYoutubePlayer},YoutubePlayer.prototype.stop=function(destroyPlayer){return stopInternal(this,destroyPlayer,!0),Promise.resolve()},YoutubePlayer.prototype.destroy=function(){var dlg=this.videoDialog;dlg&&(this.videoDialog=null,dlg.parentNode.removeChild(dlg))},YoutubePlayer.prototype.canPlayMediaType=function(mediaType){switch(mediaType){case"Audio":case"Video":return!0;default:return!1}},YoutubePlayer.prototype.canPlayItem=function(item){return!1},YoutubePlayer.prototype.canPlayUrl=function(url){return url.toLowerCase().includes("youtube.com")},YoutubePlayer.prototype.getDeviceProfile=function(){return Promise.resolve({})},YoutubePlayer.prototype.setSubtitleStreamIndex=function(index){},YoutubePlayer.prototype.canSetAudioStreamIndex=function(){return!1},YoutubePlayer.prototype.setAudioStreamIndex=function(index){},YoutubePlayer.prototype.currentTime=function(val){var currentYoutubePlayer=this.currentYoutubePlayer;if(currentYoutubePlayer&&currentYoutubePlayer.getCurrentTime){if(null==val)return 1e3*currentYoutubePlayer.getCurrentTime();currentYoutubePlayer.seekTo(val/1e3,!0)}},YoutubePlayer.prototype.duration=function(val){var currentYoutubePlayer=this.currentYoutubePlayer;return currentYoutubePlayer&&currentYoutubePlayer.getDuration?1e3*currentYoutubePlayer.getDuration():null},YoutubePlayer.prototype.pause=function(){var instance,currentYoutubePlayer=this.currentYoutubePlayer;currentYoutubePlayer&&currentYoutubePlayer.pauseVideo&&(currentYoutubePlayer.pauseVideo(),instance=this,setTimeout(function(){_events.default.trigger(instance,"pause")},200))},YoutubePlayer.prototype.unpause=function(){var instance,currentYoutubePlayer=this.currentYoutubePlayer;currentYoutubePlayer&&currentYoutubePlayer.playVideo&&(currentYoutubePlayer.playVideo(),instance=this,setTimeout(function(){_events.default.trigger(instance,"unpause")},200))},YoutubePlayer.prototype.paused=function(){var currentYoutubePlayer=this.currentYoutubePlayer;return!(!currentYoutubePlayer||!currentYoutubePlayer.getPlayerState)&&2===currentYoutubePlayer.getPlayerState()},YoutubePlayer.prototype.volume=function(val){return null!=val?this.setVolume(val):this.getVolume()},YoutubePlayer.prototype.setVolume=function(val){var currentYoutubePlayer=this.currentYoutubePlayer;currentYoutubePlayer&&null!=val&&currentYoutubePlayer.setVolume(val)},YoutubePlayer.prototype.getVolume=function(){var currentYoutubePlayer=this.currentYoutubePlayer;if(currentYoutubePlayer&&currentYoutubePlayer.getVolume)return currentYoutubePlayer.getVolume()},YoutubePlayer.prototype.setMute=function(mute){var currentYoutubePlayer=this.currentYoutubePlayer;mute?currentYoutubePlayer&&currentYoutubePlayer.mute&&currentYoutubePlayer.mute():currentYoutubePlayer&&currentYoutubePlayer.unMute&&currentYoutubePlayer.unMute()},YoutubePlayer.prototype.isMuted=function(){var currentYoutubePlayer=this.currentYoutubePlayer;if(currentYoutubePlayer&&currentYoutubePlayer.isMuted)return currentYoutubePlayer.isMuted()};_exports.default=YoutubePlayer});