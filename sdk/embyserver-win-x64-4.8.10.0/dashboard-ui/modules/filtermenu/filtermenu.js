define(["exports","./../dialoghelper/dialoghelper.js","./../layoutmanager.js","./../common/globalize.js","./../emby-apiclient/connectionmanager.js","./../emby-elements/emby-checkbox/emby-checkbox.js","./../emby-elements/emby-select/emby-select.js","./../emby-elements/emby-button/emby-button.js","./../emby-elements/emby-button/paper-icon-button-light.js","./../emby-elements/emby-dialogclosebutton/emby-dialogclosebutton.js"],function(_exports,_dialoghelper,_layoutmanager,_globalize,_connectionmanager,_embyCheckbox,_embySelect,_embyButton,_paperIconButtonLight,_embyDialogclosebutton){function onSubmit(e){return e.preventDefault(),!1}function renderMultiSelectList(container,getItemsFn,options,property,delimiter){var select=container.querySelector("select");select.getItems=getItemsFn,select.parentContainer=container;getItemsFn=(getItemsFn=options.settings[property])?getItemsFn.split(delimiter):[];select.values=getItemsFn,afterSelectValueSet(select,getItemsFn[0])}function getBaseFilterMenuOptions(options){return Object.assign({},options.filterMenuOptions)}function loadGenres(context,options){renderMultiSelectList(context.querySelector(".genreFilters"),function(query){var apiClient=_connectionmanager.default.getApiClient(this.serverId),outerItemIds=query.Ids;return query.Ids=null,query=Object.assign(getBaseFilterMenuOptions(this),{SortBy:"SortName",SortOrder:"Ascending",Recursive:null==this.Recursive||this.Recursive,EnableImages:!1,EnableUserData:!1,GenreIds:this.GenreIds,PersonIds:this.PersonIds,StudioIds:this.StudioIds,ParentId:this.parentId,OuterIds:outerItemIds,IncludeItemTypes:this.itemTypes.join(",")},query),apiClient.getGenres(apiClient.getCurrentUserId(),query)}.bind(options),options,"GenreIds",",")}function loadStudios(context,options){renderMultiSelectList(context.querySelector(".studioFilters"),function(query){var apiClient=_connectionmanager.default.getApiClient(this.serverId),outerItemIds=query.Ids;return query.Ids=null,query=Object.assign(getBaseFilterMenuOptions(this),{SortBy:"SortName",SortOrder:"Ascending",Recursive:null==this.Recursive||this.Recursive,EnableImages:!1,EnableUserData:!1,GenreIds:this.GenreIds,PersonIds:this.PersonIds,StudioIds:this.StudioIds,ParentId:this.parentId,IncludeItemTypes:this.itemTypes.join(","),OuterIds:outerItemIds},query),apiClient.getStudios(apiClient.getCurrentUserId(),query)}.bind(options),options,"StudioIds",",")}function loadOfficialRatings(context,options){renderMultiSelectList(context.querySelector(".officialRatingFilters"),function(query){var apiClient=_connectionmanager.default.getApiClient(this.serverId),outerItemIds=query.Ids;return query.Ids=null,query=Object.assign(getBaseFilterMenuOptions(this),{SortBy:"SortName",SortOrder:"Ascending",Recursive:null==this.Recursive||this.Recursive,EnableImages:!1,EnableUserData:!1,GenreIds:this.GenreIds,PersonIds:this.PersonIds,StudioIds:this.StudioIds,ParentId:this.parentId,IncludeItemTypes:this.itemTypes.join(","),OuterIds:outerItemIds},query),apiClient.getOfficialRatings(apiClient.getCurrentUserId(),query)}.bind(options),options,"OfficialRatings","|")}function loadTags(context,options){renderMultiSelectList(context.querySelector(".tagFilters"),function(query){var apiClient=_connectionmanager.default.getApiClient(this.serverId),outerItemIds=query.Ids;return query.Ids=null,query=Object.assign(getBaseFilterMenuOptions(this),{SortBy:"SortName",SortOrder:"Ascending",Recursive:null==this.Recursive||this.Recursive,EnableImages:!1,EnableUserData:!1,GenreIds:this.GenreIds,PersonIds:this.PersonIds,StudioIds:this.StudioIds,ParentId:this.parentId,IncludeItemTypes:this.itemTypes.join(","),OuterIds:outerItemIds},query),apiClient.getTags(apiClient.getCurrentUserId(),query)}.bind(options),options,"TagIds",",")}function loadYears(context,options){renderMultiSelectList(context.querySelector(".yearFilters"),function(query){var apiClient=_connectionmanager.default.getApiClient(this.serverId),outerItemIds=query.Ids;return query.Ids=null,query=Object.assign(getBaseFilterMenuOptions(this),{SortBy:"SortName",SortOrder:"Descending",Recursive:null==this.Recursive||this.Recursive,EnableImages:!1,EnableUserData:!1,GenreIds:this.GenreIds,PersonIds:this.PersonIds,StudioIds:this.StudioIds,ParentId:this.parentId,IncludeItemTypes:this.itemTypes.join(","),OuterIds:outerItemIds},query),apiClient.getYears(apiClient.getCurrentUserId(),query)}.bind(options),options,"Years",",")}function loadContainers(context,options){renderMultiSelectList(context.querySelector(".containerFilters"),function(query){var apiClient=_connectionmanager.default.getApiClient(this.serverId),outerItemIds=query.Ids;return query.Ids=null,query=Object.assign(getBaseFilterMenuOptions(this),{SortBy:"SortName",SortOrder:"Ascending",Recursive:null==this.Recursive||this.Recursive,EnableImages:!1,EnableUserData:!1,GenreIds:this.GenreIds,PersonIds:this.PersonIds,StudioIds:this.StudioIds,ParentId:this.parentId,IncludeItemTypes:this.itemTypes.join(","),OuterIds:outerItemIds},query),apiClient.getContainers(apiClient.getCurrentUserId(),query)}.bind(options),options,"Containers",",")}function loadAudioCodecs(context,options){renderMultiSelectList(context.querySelector(".audioCodecFilters"),function(query){var apiClient=_connectionmanager.default.getApiClient(this.serverId),outerItemIds=query.Ids;return query.Ids=null,query=Object.assign(getBaseFilterMenuOptions(this),{SortBy:"SortName",SortOrder:"Ascending",Recursive:null==this.Recursive||this.Recursive,EnableImages:!1,EnableUserData:!1,GenreIds:this.GenreIds,PersonIds:this.PersonIds,StudioIds:this.StudioIds,ParentId:this.parentId,IncludeItemTypes:this.itemTypes.join(","),OuterIds:outerItemIds},query),apiClient.getAudioCodecs(apiClient.getCurrentUserId(),query)}.bind(options),options,"AudioCodecs",",")}function loadAudioLayouts(context,options){renderMultiSelectList(context.querySelector(".audioLayoutFilters"),function(query){var apiClient=_connectionmanager.default.getApiClient(this.serverId),outerItemIds=query.Ids;return query.Ids=null,query=Object.assign(getBaseFilterMenuOptions(this),{SortBy:"SortName",SortOrder:"Ascending",Recursive:null==this.Recursive||this.Recursive,EnableImages:!1,EnableUserData:!1,GenreIds:this.GenreIds,PersonIds:this.PersonIds,StudioIds:this.StudioIds,ParentId:this.parentId,IncludeItemTypes:this.itemTypes.join(","),OuterIds:outerItemIds},query),apiClient.getAudioLayouts(apiClient.getCurrentUserId(),query)}.bind(options),options,"AudioLayouts",",")}function loadAudioLanguages(context,options){renderMultiSelectList(context.querySelector(".audioLanguageFilters"),function(query){var apiClient=_connectionmanager.default.getApiClient(this.serverId),outerItemIds=query.Ids;return query.Ids=null,query=Object.assign(getBaseFilterMenuOptions(this),{SortBy:"SortName",SortOrder:"Ascending",Recursive:null==this.Recursive||this.Recursive,EnableImages:!1,EnableUserData:!1,GenreIds:this.GenreIds,PersonIds:this.PersonIds,StudioIds:this.StudioIds,ParentId:this.parentId,IncludeItemTypes:this.itemTypes.join(","),StreamType:"Audio",OuterIds:outerItemIds},query),apiClient.getStreamLanguages(apiClient.getCurrentUserId(),query)}.bind(options),options,"AudioLanguages",",")}function loadSubtitleLanguages(context,options){renderMultiSelectList(context.querySelector(".subtitleLanguageFilters"),function(query){var apiClient=_connectionmanager.default.getApiClient(this.serverId),outerItemIds=query.Ids;return query.Ids=null,query=Object.assign(getBaseFilterMenuOptions(this),{SortBy:"SortName",SortOrder:"Ascending",Recursive:null==this.Recursive||this.Recursive,EnableImages:!1,EnableUserData:!1,GenreIds:this.GenreIds,PersonIds:this.PersonIds,StudioIds:this.StudioIds,ParentId:this.parentId,IncludeItemTypes:this.itemTypes.join(","),StreamType:"Subtitle",OuterIds:outerItemIds},query),apiClient.getStreamLanguages(apiClient.getCurrentUserId(),query)}.bind(options),options,"SubtitleLanguages",",")}function loadVideoCodecs(context,options){renderMultiSelectList(context.querySelector(".videoCodecFilters"),function(query){var apiClient=_connectionmanager.default.getApiClient(this.serverId),outerItemIds=query.Ids;return query.Ids=null,query=Object.assign(getBaseFilterMenuOptions(this),{SortBy:"SortName",SortOrder:"Ascending",Recursive:null==this.Recursive||this.Recursive,EnableImages:!1,EnableUserData:!1,GenreIds:this.GenreIds,PersonIds:this.PersonIds,StudioIds:this.StudioIds,ParentId:this.parentId,IncludeItemTypes:this.itemTypes.join(","),OuterIds:outerItemIds},query),apiClient.getVideoCodecs(apiClient.getCurrentUserId(),query)}.bind(options),options,"VideoCodecs",",")}function loadExtendedVideoTypes(context,options){renderMultiSelectList(context.querySelector(".fldExtendedVideoTypes"),function(query){var apiClient=_connectionmanager.default.getApiClient(this.serverId),outerItemIds=query.Ids;return query.Ids=null,query=Object.assign(getBaseFilterMenuOptions(this),{SortBy:"SortName",SortOrder:"Ascending",Recursive:null==this.Recursive||this.Recursive,EnableImages:!1,EnableUserData:!1,GenreIds:this.GenreIds,PersonIds:this.PersonIds,StudioIds:this.StudioIds,ParentId:this.parentId,IncludeItemTypes:this.itemTypes.join(","),OuterIds:outerItemIds},query),apiClient.getExtendedVideoTypes(apiClient.getCurrentUserId(),query)}.bind(options),options,"ExtendedVideoTypes",",")}function loadSubtitleCodecs(context,options){renderMultiSelectList(context.querySelector(".subtitleCodecFilters"),function(query){var apiClient=_connectionmanager.default.getApiClient(this.serverId),outerItemIds=query.Ids;return query.Ids=null,query=Object.assign(getBaseFilterMenuOptions(this),{SortBy:"SortName",SortOrder:"Ascending",Recursive:null==this.Recursive||this.Recursive,EnableImages:!1,EnableUserData:!1,GenreIds:this.GenreIds,PersonIds:this.PersonIds,StudioIds:this.StudioIds,ParentId:this.parentId,IncludeItemTypes:this.itemTypes.join(","),OuterIds:outerItemIds},query),apiClient.getSubtitleCodecs(apiClient.getCurrentUserId(),query)}.bind(options),options,"SubtitleCodecs",",")}function updateClearButton(context){context.querySelector(".filter-active")||context.querySelector("input:checked")?context.querySelector(".filterMenuClearButton").classList.remove("hide"):context.querySelector(".filterMenuClearButton").classList.add("hide")}function afterSelectValueSet(elem,value){var filterIndicator,elem=elem.closest(".selectContainer");elem&&(filterIndicator=elem.querySelector(".filterMenu-indicator"),value?filterIndicator||elem.insertAdjacentHTML("afterbegin",'<div class="filterMenu-indicator filter-active"></div>'):filterIndicator&&filterIndicator.remove())}function onValueChange(){"SELECT"===this.tagName&&afterSelectValueSet(this,this.singleValue),updateClearButton(this.closest(".dialog"))}function setBasicFilter(filters,key,elem){var value="SELECT"===elem.tagName?elem.singleValue||null:"true"===elem.getAttribute("data-invert")?!elem.checked&&null:(value=elem.checked)||null;filters[key]=value}function FilterMenu(){}function onResetClick(){for(var context=this.closest(".dialog"),elems=context.querySelectorAll("select,input"),i=0,length=elems.length;i<length;i++){var elem=elems[i];switch(elem.tagName){case"INPUT":"checkbox"===elem.type&&(elem.checked=!1,function(elem){elem.dispatchEvent(new CustomEvent("change",{bubbles:!0}))}(elem));break;case"SELECT":elem.setValues([],!0)}}_dialoghelper.default.close(context)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,require(["flexStyles","formDialogStyle","material-icons","css!modules/filtermenu/filtermenu.css"]),FilterMenu.prototype.show=function(options){return require(["text!./modules/filtermenu/filtermenu.template.html"]).then(function(responses){for(var submitted,responses=responses[0],dialogOptions={removeOnClose:!0,scrollY:!1,offsetTop:2,positionTo:options.positionTo,positionY:options.positionY},dialogOptions=(_layoutmanager.default.tv&&(dialogOptions.size="fullscreen"),_dialoghelper.default.createDialog(dialogOptions)),html=(dialogOptions.classList.add("formDialog"),""),settingElements=(html=(html=(html=html+'<div class="formDialogHeader">'+'<button type="button" is="emby-dialogclosebutton"></button>')+('<h3 class="formDialogHeaderTitle">'+_globalize.default.translate("Filters")+"</h3>"))+('<button type="button" is="emby-button" class="button-link filterMenuClearButton hide">'+_globalize.default.translate("HeaderClearFilters")+"</button>"),dialogOptions.innerHTML=_globalize.default.translateDocument(html=html+"</div>"+responses,"sharedcomponents"),dialogOptions.querySelectorAll(".viewSetting")),i=0,length=settingElements.length;i<length;i++)-1===options.visibleSettings.indexOf(settingElements[i].getAttribute("data-settingname"))?settingElements[i].classList.add("hide"):settingElements[i].classList.remove("hide");return function(context,settings){context.querySelector("form").addEventListener("submit",onSubmit);for(var elems=context.querySelectorAll(".simpleFilter"),i=0,length=elems.length;i<length;i++){var selectElem,val=settings[elems[i].getAttribute("data-settingname")];"INPUT"===elems[i].tagName?"true"===elems[i].getAttribute("data-invert")?elems[i].checked="false"===val:elems[i].checked=val||!1:elems[i].classList.contains("selectContainer")?(selectElem=elems[i].querySelector("select"),null==val?(selectElem.singleValue="",afterSelectValueSet(selectElem,"")):(selectElem.singleValue=val.toString(),afterSelectValueSet(selectElem,val.toString()))):elems[i].querySelector("input").checked=val||!1}var selectSeriesStatus=context.querySelector(".selectSeriesStatus");selectSeriesStatus.value=settings.SeriesStatus||"",afterSelectValueSet(selectSeriesStatus,settings.SeriesStatus||"");for(var _i=0,_length=(elems=context.querySelectorAll(".multiSettingsSection")).length;_i<_length;_i++)elems[_i].querySelector(".viewSetting:not(.hide)")||elems[_i].querySelector(".selectContainer:not(.hide)")?elems[_i].classList.remove("hide"):elems[_i].classList.add("hide");for(var _i2=0,_length2=(elems=context.querySelectorAll("select,input")).length;_i2<_length2;_i2++)elems[_i2].addEventListener("change",onValueChange)}(dialogOptions,options.settings),function(context,options){var anySelected=!1,menuItems=[],html=(-1!==options.visibleSettings.indexOf("IsPlayed")&&menuItems.push({name:_globalize.default.translate("Played"),value:"IsPlayed"}),-1!==options.visibleSettings.indexOf("IsUnplayed")&&menuItems.push({name:_globalize.default.translate("Unplayed"),value:"IsUnplayed"}),-1!==options.visibleSettings.indexOf("IsResumable")&&menuItems.push({name:_globalize.default.translate("ContinuePlaying"),value:"IsResumable"}),menuItems.map(function(m){var selectedHtml="";return!anySelected&&(options.settings[m.value]||!1)&&(anySelected=!0,selectedHtml=" selected"),'<option value="'+m.value+'" '+selectedHtml+">"+m.name+"</option>"}).join("")),allText=_globalize.default.translate("Any"),allText=anySelected?'<option value="">'+allText+"</option>":'<option value="" selected>'+allText+"</option>",selectPlaystate=context.querySelector(".selectPlaystate");selectPlaystate.innerHTML=allText+html,afterSelectValueSet(selectPlaystate,selectPlaystate.singleValue),menuItems.length?context.querySelector(".playstateFilters").classList.remove("hide"):context.querySelector(".playstateFilters").classList.add("hide")}(dialogOptions,options),-1!==options.visibleSettings.indexOf("Genres")&&loadGenres(dialogOptions,options),-1!==options.visibleSettings.indexOf("Studios")&&loadStudios(dialogOptions,options),-1!==options.visibleSettings.indexOf("Tags")&&loadTags(dialogOptions,options),-1!==options.visibleSettings.indexOf("OfficialRatings")&&loadOfficialRatings(dialogOptions,options),-1!==options.visibleSettings.indexOf("Containers")&&loadContainers(dialogOptions,options),-1!==options.visibleSettings.indexOf("Years")&&loadYears(dialogOptions,options),-1!==options.visibleSettings.indexOf("AudioCodecs")&&(loadAudioCodecs(dialogOptions,options),loadAudioLanguages(dialogOptions,options)),-1!==options.visibleSettings.indexOf("AudioLayouts")&&loadAudioLayouts(dialogOptions,options),-1!==options.visibleSettings.indexOf("VideoCodecs")&&loadVideoCodecs(dialogOptions,options),-1!==options.visibleSettings.indexOf("ExtendedVideoTypes")&&loadExtendedVideoTypes(dialogOptions,options),-1!==options.visibleSettings.indexOf("SubtitleCodecs")&&(loadSubtitleCodecs(dialogOptions,options),loadSubtitleLanguages(dialogOptions,options)),updateClearButton(dialogOptions),dialogOptions.querySelector(".filterMenuClearButton").addEventListener("click",onResetClick),dialogOptions.querySelector("form").addEventListener("change",function(e){submitted=!0,options.onChange(function(elem){var filters={};if(selectPlaystate=elem.closest(".selectPlaystate"))for(var options=selectPlaystate.options,value=selectPlaystate.singleValue,i=0,length=options.length;i<length;i++){var optionValue=options[i].value;optionValue===value?optionValue&&(filters[optionValue]=!0):optionValue&&(filters[optionValue]=null)}else{var delimiter,settingName,selectPlaystate=elem.closest(".simpleFilter");selectPlaystate?"INPUT"===selectPlaystate.tagName?setBasicFilter(filters,selectPlaystate.getAttribute("data-settingname"),selectPlaystate):selectPlaystate.classList.contains("selectContainer")?setBasicFilter(filters,selectPlaystate.getAttribute("data-settingname"),selectPlaystate.querySelector("select")):setBasicFilter(filters,selectPlaystate.getAttribute("data-settingname"),selectPlaystate.querySelector("input")):(selectPlaystate=elem.closest("select[multiple]"))?(settingName=selectPlaystate.getAttribute("data-settingname"),delimiter=selectPlaystate.getAttribute("data-delimiter")||",",filters[settingName]=selectPlaystate.getValues().join(delimiter)||null):(settingName=elem.closest(".selectSeriesStatus"))&&(filters[settingName.getAttribute("data-settingname")]=settingName.value||null)}return filters}(e.target))},!0),_dialoghelper.default.open(dialogOptions).then(function(){return submitted?Promise.resolve():Promise.reject()})})};_exports.default=FilterMenu});