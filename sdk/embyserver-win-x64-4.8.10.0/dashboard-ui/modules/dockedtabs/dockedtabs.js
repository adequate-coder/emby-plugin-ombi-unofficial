define(["exports","./../emby-apiclient/connectionmanager.js","./../emby-apiclient/events.js","./../common/globalize.js","./../approuter.js","./../emby-elements/emby-tabs/emby-tabs.js","./../layoutmanager.js","./../common/itemmanager/itemmanager.js","./../common/servicelocator.js","./../appfooter/appfooter.js","./../viewmanager/viewmanager.js","./../common/inputmanager.js"],function(_exports,_connectionmanager,_events,_globalize,_approuter,_embyTabs,_layoutmanager,_itemmanager,_servicelocator,_appfooter,_viewmanager,_inputmanager){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,require(["css!modules/dockedtabs/dockedtabs.css"]);var instance,headerHomeButton,headerSearchButton,headerMenuButton,currentServerId,hiddenMode=0,libraryMode=2,currentMode=hiddenMode,userSignedIn=!1,currentTabsList=[];function onLocalUserSignedIn(e,serverId,userId){currentMode=hiddenMode,currentServerId=serverId,userSignedIn=!0}function onLocalUserSignedOut(e){userSignedIn=!1}function updateHomeButton(tabsEnabled){(tabsEnabled||headerHomeButton)&&(headerHomeButton=headerHomeButton||document.querySelector(".headerHomeButton"),tabsEnabled?headerHomeButton.classList.add("hiddenWhenBottomNavVisible"):headerHomeButton.classList.remove("hiddenWhenBottomNavVisible"))}function updateSearchButton(tabsEnabled){(tabsEnabled||headerSearchButton)&&(headerSearchButton=headerSearchButton||document.querySelector(".headerSearchButton"),tabsEnabled?headerSearchButton.classList.add("hiddenWhenBottomNavVisible"):headerSearchButton.classList.remove("hiddenWhenBottomNavVisible"))}function updateMenuButton(tabsEnabled){(tabsEnabled||headerMenuButton)&&(headerMenuButton=headerMenuButton||document.querySelector(".headerMenuButton"))}function setMode(e,mode){var tabs;mode===currentMode?mode!==hiddenMode&&function(e){var navMenuId=e.detail.navMenuId;if(navMenuId){var element=instance.element;if(element)for(var url=null==(e=e.detail.url)?void 0:e.toLowerCase(),i=0,length=currentTabsList.length;i<length;i++){var tab=currentTabsList[i];if(navMenuId===tab.navMenuId){element.selectedIndex(i,!1);break}if(tab.href&&url.endsWith(tab.href.toLowerCase())){element.selectedIndex(i,!1);break}}}}(e):(tabs=instance)&&((currentMode=mode)===libraryMode&&function(e,parentElement){var tabs=[];_connectionmanager.default.getApiClient(currentServerId).getUserViews().then(function(result){var _e$detail$url;tabs.push({name:_globalize.default.translate("Home"),icon:"&#xe88a;",href:_approuter.default.getRouteUrl("home"),fillIcon:!0}),tabs.push({name:_globalize.default.translate("Search"),icon:"&#xe8B6;",href:"#",onclick:"search",navMenuId:"search"}),_servicelocator.appHost.supports("sync")&&tabs.push({name:_globalize.default.translate("Downloads"),icon:"&#xf090;",href:_approuter.default.getRouteUrl("downloads")});for(var i=0,length=result.Items.length;i<length&&!(5<=tabs.length);i++)tabs.push({name:result.Items[i].Name,icon:_itemmanager.default.getDefaultIcon(result.Items[i]),href:_approuter.default.getRouteUrl(result.Items[i])});var foundActive=!1,navMenuId=e.detail.navMenuId,url=null==(_e$detail$url=e.detail.url)?void 0:_e$detail$url.toLowerCase();if(navMenuId)for(var _i=0,_length=tabs.length;_i<_length;_i++){var tab=tabs[_i];if(navMenuId===tab.navMenuId){foundActive=tab.active=!0;break}if(tab.href&&url.endsWith(tab.href.toLowerCase())){foundActive=tab.active=!0;break}}foundActive||(tabs[0].active=!0),function(tabs,parentElement){(currentTabsList=tabs).length?(tabs=tabs.map(function(tab,index){var active=tab.active?" emby-tab-button-active":"",iconClass=tab.fillIcon?" md-icon-fill":"";return'<a is="emby-linkbutton" href="'+tab.href+'" tabindex="-1" class="dockedtabs-tab-button secondaryText emby-tab-button'+active+'" data-index="'+index+'" data-navmenuid="'+(tab.navMenuId||"")+'">                <i class="dockedtabs-tab-button-icon md-icon'+iconClass+'">'+tab.icon+"</i><div>"+tab.name+"</div></a>"}).join(""),parentElement.innerHTML=tabs):parentElement.innerHTML="",parentElement.onTabsChanged()}(tabs,parentElement)})}(e,getElement(tabs)),mode===hiddenMode?(tabs.hide(),updateHomeButton(!1),updateSearchButton(!1),updateMenuButton(!1)):(tabs.show(),updateHomeButton(!0),updateSearchButton(!0),updateMenuButton(!0)))}function onViewShow(e){var _detail$params,detail=e.detail;"true"!==(null==(_detail$params=detail.params)?void 0:_detail$params.asDialog)&&(_layoutmanager.default.tv||!1===detail.dockedTabs||!userSignedIn?setMode(e,hiddenMode):setMode(e,libraryMode))}function onTabsClick(e){var button=e.target.closest(".dockedtabs-tab-button");button&&(button=button.getAttribute("data-navmenuid"))&&"search"===button&&(_inputmanager.default.trigger("search",{sourceElement:_viewmanager.default.currentView(),originalEvent:e}),e.preventDefault())}function getElement(instance){var element=instance.element;return element||(element=instance.element=(_appfooter.default.add('<div is="emby-tabs" class="dockedtabs-tabs dockedtabs hide focuscontainer-x"></div>'),_appfooter.default.element.querySelector(".dockedtabs"))).addEventListener("click",onTabsClick),element}function DockedTabs(){instance=this,_events.default.on(_connectionmanager.default,"localusersignedin",onLocalUserSignedIn),_events.default.on(_connectionmanager.default,"localusersignedout",onLocalUserSignedOut),document.addEventListener("viewshow",onViewShow);var apiClient=_connectionmanager.default.currentApiClient();null!=apiClient&&apiClient.isLoggedIn()&&onLocalUserSignedIn(0,apiClient.serverId(),apiClient.getCurrentUserId())}DockedTabs.prototype.destroy=function(){document.removeEventListener("viewshow",onViewShow);this.element=null},DockedTabs.prototype.show=function(){getElement(this).classList.remove("hide"),_appfooter.default.setWithContent50w(!0)},DockedTabs.prototype.hide=function(){var element=this.element;element&&(element.classList.add("hide"),element.innerHTML="",_appfooter.default.setWithContent50w(!1))};_exports.default=new DockedTabs});