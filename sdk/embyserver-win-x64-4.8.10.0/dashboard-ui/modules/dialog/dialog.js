define(["exports","./../layoutmanager.js","./../common/globalize.js","./../approuter.js","./../dialoghelper/dialoghelper.js","./../dom.js","./../common/inputmanager.js","./../emby-apiclient/connectionmanager.js","./../common/imagehelper.js","./../common/itemmanager/itemmanager.js","./../emby-elements/emby-button/emby-button.js","./../emby-elements/emby-scroller/emby-scroller.js","./../emby-elements/emby-dialogclosebutton/emby-dialogclosebutton.js"],function(_exports,_layoutmanager,_globalize,_approuter,_dialoghelper,_dom,_inputmanager,_connectionmanager,_imagehelper,_itemmanager,_embyButton,_embyScroller,_embyDialogclosebutton){function wrapTextWithButtonIfNeeded(text,enableScrollWithDirectionButtons){return enableScrollWithDirectionButtons&&(text='<button type="button" is="emby-button" class="button-link text-align-start button-link-no-focus-bg dialog-btn-textscroll" style="font-weight:normal;color:inherit!important;transform:none!important;text-decoration:none!important;background:none!important;">'+text,text+="</button>"),text}function getTextLinkButton(item){var href=_approuter.default.getRouteUrl(item);return'<a is="emby-linkbutton" class="button-link noautofocus" data-href="'+href+'" href="'+href+'" style="max-width:100%;overflow:hidden;">'+item.Name+"</a>"}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=function(text,title){var options;options="string"==typeof text?{title:title,text:text}:text;var deps,title=uiDependencies;title.length?(deps=title.slice(0),uiDependencies=[]):deps=[];return deps.unshift("text!modules/dialog/dialog.template.html"),require(deps).then(function(responses){return window.dispatchEvent(new CustomEvent("userprompt",{detail:{promptType:options.dialogType},bubbles:!0,cancelable:!1})),function(options,template){var dialogOptions={removeOnClose:!0,scrollY:!1,lowResAutoHeight:!0},enableTvLayout=_layoutmanager.default.tv;enableTvLayout&&(dialogOptions.size="fullscreen");var dlg=_dialoghelper.default.createDialog(dialogOptions);dlg.classList.add("formDialog","justify-content-center"),options.dialogType&&dlg.classList.add(options.dialogType+"Dialog");var optionButtons=options.buttons||[],dialogOptions=enableTvLayout&&0===optionButtons.length;dialogOptions&&(template=template.replace('data-focusscroll="true"','data-focusscroll="false"'));dlg.innerHTML=_globalize.default.translateHtml(template,"sharedcomponents");template=dlg.querySelector(".formDialogContent");template.classList.add("no-grow"),enableTvLayout?template.style["max-height"]="60%":_dom.default.allowBackdropFilter()&&dlg.classList.add("dialog-blur");enableTvLayout=dlg.querySelector(".formDialogHeaderTitle"),template=dlg.querySelector(".formDialogHeader");options.item?(template.insertAdjacentHTML("afterbegin",function(options,item){var html="",apiClient=(html+='<div class="dialogItemPreview flex flex-direction-row align-items-center">',_connectionmanager.default.getApiClient(item)),imageUrlInfo=_imagehelper.default.getImageUrl(item,apiClient,{height:60,width:200}),imageUrl=imageUrlInfo.imgUrl,imgClass="",round="MusicArtist"===item.Type;html=imageUrl?(imgClass+=" dialogItemPreviewImage-bg",imageUrlInfo=imageUrlInfo.aspect||1,shape=_imagehelper.default.getShapeFromAspect(imageUrlInfo),imgClass+=" dialogItemPreviewImage-bg-"+shape,round&&"square"===shape&&(imgClass+=" dialogItemPreviewImage-round"),html+('<div class="'+imgClass.trim())+'" style="aspect-ratio:'+imageUrlInfo+";background-image:url("+imageUrl+');"></div>'):(imgClass+=" dialogItemPreviewImage-iconcontainer",round&&(imgClass+=" dialogItemPreviewImage-round"),(html=(html=html+('<div class="'+imgClass.trim())+'"><i class="dialogItemPreviewImage-icon md-icon autortl">')+_itemmanager.default.getDefaultIcon(item))+"</i></div>");html+='<div class="dialogItemPreviewContent">';var lines=[];item.SeriesName?item.SeriesId?lines.push(getTextLinkButton({Type:"Series",Id:item.SeriesId,Name:item.SeriesName,IsFolder:!0,ServerId:item.ServerId})):lines.push(item.SeriesName):"Program"===item.Type&&lines.push(item.Name);lines.push(_itemmanager.default.getDisplayName(item,{})),"Server"===item.Type&&(apiClient&&apiClient.serverVersion()&&lines.push(apiClient.serverVersion()),apiClient)&&apiClient.serverAddress()&&lines.push(apiClient.serverAddress());{var shape;"User"===item.Type&&options.showServerName&&(shape=apiClient.serverName())&&lines.push(shape)}item.IsFolder&&item.AlbumArtists&&item.AlbumArtists.length?lines.push(getTextLinkButton({Type:"MusicArtist",Id:item.AlbumArtists[0].Id,Name:item.AlbumArtists[0].Name,ServerId:item.ServerId})):item.ArtistItems&&item.ArtistItems.length?lines.push(getTextLinkButton({Type:"MusicArtist",Id:item.ArtistItems[0].Id,Name:item.ArtistItems[0].Name,ServerId:item.ServerId})):item.AlbumArtists&&item.AlbumArtists.length&&lines.push(getTextLinkButton({Type:"MusicArtist",Id:item.AlbumArtists[0].Id,Name:item.AlbumArtists[0].Name,ServerId:item.ServerId}));imageUrlInfo=[];item.Album&&item.AlbumId?imageUrlInfo.push(getTextLinkButton({Type:"Photo"===item.MediaType?"PhotoAlbum":"MusicAlbum",Id:item.AlbumId,Name:item.Album,ServerId:item.ServerId})):item.Album&&imageUrlInfo.push(item.Album);item.ProductionYear&&"Episode"!==item.Type&&imageUrlInfo.push(item.ProductionYear);imageUrlInfo.length&&lines.push(imageUrlInfo.join(" &middot; "));for(var i=0,length=Math.min(lines.length,3);i<length;i++)html=1<=i?(html+='<div class="dialogItemPreviewText secondaryText">')+lines[i]+"</div>":(html+='<div class="dialogItemPreviewText">')+lines[i]+"</div>";return html+="</div></div>"}(options,options.item)),template.classList.remove("justify-content-center"),template.classList.add("padded-left","padded-right","dialogHeader-withpreview","dialog-content-centered"),enableTvLayout.classList.add("hide")):options.title?enableTvLayout.innerHTML=options.title||"":(enableTvLayout.classList.add("hide"),template.style.height="auto");var i,length,enableTvLayout=dlg.querySelector(".dialogContentInner");!1!==options.centerText&&(enableTvLayout.style.textAlign="center",isDialogContentCentered=!0);_layoutmanager.default.tv||optionButtons.length||dlg.classList.add("dialog-largefont");options.html?enableTvLayout.innerHTML=wrapTextWithButtonIfNeeded(options.html,dialogOptions):options.preFormattedText?enableTvLayout.innerHTML=wrapTextWithButtonIfNeeded('<pre class="text-align-start" style="font-size:inherit;margin:0;">'+options.preFormattedText+"</pre>",dialogOptions):options.code?enableTvLayout.innerHTML=wrapTextWithButtonIfNeeded('<div class="text-align-start"><code class="text-align-start" style="font-size:inherit;margin:0;">'+options.code+"</code></div>",dialogOptions):options.text?(template=enableTvLayout,isDialogContentCentered&&(enableTvLayout.innerHTML='<span style="display:inline-block;" class="text-align-start"></span>',template=enableTvLayout.querySelector("span")),template.innerText=wrapTextWithButtonIfNeeded((options.text||"").replaceAll("<br/>","\n"),dialogOptions)):enableTvLayout.classList.add("hide");var html="",hasDescriptions=!1;for(i=0,length=optionButtons.length;i<length;i++){var item=optionButtons[i],buttonClass="btnOption raised formDialogFooterItem formDialogFooterItem-autosize";item.type&&(buttonClass+=" button-"+item.type),item.description&&(hasDescriptions=!0),item.href?html+='<a is="emby-linkbutton" target="_blank" href="'+item.href+'" class="'+buttonClass+'" data-id="'+item.id+'">'+item.name+"</a>":html+='<button is="emby-button" type="button" class="'+buttonClass+'" data-id="'+item.id+'"><span>'+item.name+"</span></button>",item.description&&(html+='<div class="formDialogFooterItem formDialogFooterItem-autosize fieldDescription" style="margin-top:.25em!important;margin-bottom:1.25em!important;">'+item.description+"</div>")}var dialogResult,isDialogContentCentered=dlg.querySelector(".formDialogFooter");(isDialogContentCentered.innerHTML=html)||(isDialogContentCentered.classList.add("hide"),(template=dlg.querySelector(".scrollSlider")).style["padding-bottom"]="2em",options.item&&(template.style["padding-top"]="0"),_layoutmanager.default.tv?dlg.querySelector(".formDialogHeader").insertAdjacentHTML("afterbegin",'<button type="button" is="emby-dialogclosebutton" class="dialog-dialog-close" closetype="done"></button>'):dlg.querySelector(".formDialogHeader").insertAdjacentHTML("afterbegin",'<button type="button" is="emby-dialogclosebutton" class="dialog-dialog-close dialog-dialog-close-reducefont" closetype="done"></button>'));hasDescriptions&&dlg.querySelector(".formDialogFooter").classList.add("formDialogFooter-vertical");function onButtonClick(){dialogResult=this.getAttribute("data-id"),_dialoghelper.default.close(dlg)}var timeout,buttons=dlg.querySelectorAll(".btnOption");for(i=0,length=buttons.length;i<length;i++)buttons[i].addEventListener("click",onButtonClick);dialogOptions&&!function(dlg){_inputmanager.default.on(dlg,function(e){var command=e.detail.command;"up"===command?(this.querySelector(".emby-scroller").scrollBackwards(),e.preventDefault()):"down"===command&&(this.querySelector(".emby-scroller").scrollForwards(),e.preventDefault())}.bind(dlg))}(dlg);options.timeout&&(timeout=setTimeout(function(){dialogResult="_timeout",_dialoghelper.default.close(dlg)},options.timeout));return _dialoghelper.default.open(dlg).then(function(){return timeout&&clearTimeout(timeout),dialogResult||Promise.reject()})}(options,responses[0])})},require(["material-icons","formDialogStyle","flexStyles","css!modules/dialog/dialog.css"]);var uiDependencies=["material-icons","emby-button","paper-icon-button-light","formDialogStyle","flexStyles","emby-scroller"]});