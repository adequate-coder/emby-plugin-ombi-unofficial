define(["./../common/playback/playbackmanager.js","./../emby-apiclient/connectionmanager.js","./../emby-apiclient/events.js","./../common/globalize.js","./../layoutmanager.js","./../dom.js","./../common/itemmanager/itemmanager.js","./../shortcuts.js","./../mediainfo/mediainfo.js","./../emby-elements/emby-button/paper-icon-button-light.js","./../emby-elements/userdatabuttons/emby-ratingbutton.js","./../common/inputmanager.js","./../focusmanager.js","./../common/usersettings/usersettings.js","./../playback/osdcontroller.js"],function(_playbackmanager,_connectionmanager,_events,_globalize,_layoutmanager,_dom,_itemmanager,_shortcuts,_mediainfo,_paperIconButtonLight,_embyRatingbutton,_inputmanager,_focusmanager,_usersettings,_osdcontroller){var currentPlayer,osdController,nowPlayingImageElement,nowPlayingTextElement,nowPlayingBarTVTextElement,nowPlayingBarFavoriteButton,muteButton,volumeSlider,volumeSliderContainer,playPauseButtons,positionSlider,toggleRepeatButton,toggleShuffleButton,remoteControlButton,stopButtonRight,isEnabled,appFooter,currentMode,currentPlayerSupportedCommands=[],lastUpdateTime=0,currentRuntimeTicks=0,isVisibilityAllowed=!0,headerElement=document.querySelector(".skinHeader");function onSlideDownComplete(e){var elem=e.currentTarget;elem===e.target&&elem.classList.contains("nowPlayingBar-hidden")&&elem.classList.add("hide")}function onInputCommand(e){"up"===e.detail.command&&_focusmanager.default.focus(nowPlayingBarTVTextElement)}function slideUp(elem){elem._visible||(elem._visible=!0,"tv"===currentMode?(elem.classList.remove("nowPlayingBar-hidden","hide"),headerElement.classList.add("skinHeader-withnowplaying"),document.documentElement.classList.add("withheadernowplaying"),_inputmanager.default.off(headerElement,onInputCommand),_inputmanager.default.on(headerElement,onInputCommand)):(elem.classList.remove("hide"),elem.offsetWidth,elem.classList.remove("nowPlayingBar-hidden")))}function onPlayPauseClick(){_playbackmanager.default.playPause(currentPlayer)}function onStopClick(){currentPlayer&&_playbackmanager.default.stop(currentPlayer)}var nowPlayingBarElement,currentImgUrl,dragCounter=0;function onDragEnter(e){e.dataTransfer.dropEffect="copy";e=window.CurrentDragInfo,e=e?e.item:null;e&&_playbackmanager.default.canQueue(e)&&(this.classList.add("nowPlayingBar-dragging-over"),dragCounter++)}function onDragOver(e){e.dataTransfer.dropEffect="copy";var data=window.CurrentDragInfo,data=data?data.item:null;data&&_playbackmanager.default.canQueue(data)&&e.preventDefault()}function onDragLeave(e){var data=window.CurrentDragInfo,data=data?data.item:null;data&&_playbackmanager.default.canQueue(data)&&0===--dragCounter&&this.classList.remove("nowPlayingBar-dragging-over")}function onDragEnd(e){this.classList.remove("nowPlayingBar-dragging-over")}function onDrop(e){dragCounter=0,e.preventDefault(),this.classList.remove("nowPlayingBar-dragging-over");var options,e=(null==(e=window.CurrentDragInfo)?void 0:e.items)||[];e.length&&(e=e.filter(function(i){return _playbackmanager.default.canQueue(i)})).length&&(_playbackmanager.default.queue({items:e}),options={text:_globalize.default.translate("HeaderAddedToPlayQueue"),icon:"&#xe03b;"},Emby.importModule("./modules/toast/toast.js").then(function(toast){return toast(options)}))}function showRemoteControl(){Emby.importModule("./modules/approuter.js").then(function(appRouter){appRouter.showNowPlaying()})}function getNowPlayingBar(){var parentModule;return nowPlayingBarElement?Promise.resolve(nowPlayingBarElement):(parentModule="tv"===(currentMode=_layoutmanager.default.tv?"tv":null)?"./modules/appheader/appheader.js":"./modules/appfooter/appfooter.js",Promise.all([Emby.importModule(parentModule),require(["css!modules/nowplayingbar/nowplayingbar.css"]),Emby.importModule("./modules/emby-elements/emby-slider/emby-slider.js")]).then(function(responses){appFooter=responses[0];responses="tv"===currentMode?headerElement:appFooter.element;if(!(nowPlayingBarElement=responses.querySelector(".nowPlayingBar"))){responses.insertAdjacentHTML("afterbegin",(className=html="",html+='<div class="nowPlayingBar focuscontainer-x hide nowPlayingBar-hidden'+(className+="tv"===currentMode?" nowPlayingBar-tv headerNowPlaying headerSection":" nowPlayingBar-footer nowPlayingBar-footer-transition")+'">',"tv"!==currentMode&&(html+='<div class="nowPlayingBarTop">'),html=(html=(html=(html=(html=(html=(html=(html=(html=(html=html+("tv"===currentMode?'<div class="nowPlayingBarPositionContainer nowPlayingBarPositionContainer-tv sliderContainer">':'<div class="nowPlayingBarPositionContainer sliderContainer">')+'<input type="range" is="emby-slider" pin step=".01" min="0" max="100" value="0" class="nowPlayingBarPositionSlider" tabindex="-1" data-defaultinputhandling="false" data-hoverthumb="true" data-thumbclass="nowPlayingBarPositionSliderThumb" data-sliderbackgroundclass="nowPlayingBarPositionContainer-background" />')+"</div>"+("tv"===currentMode?'<div class="nowPlayingBarInfoContainer nowPlayingBarInfoContainer-tv">':'<div class="nowPlayingBarInfoContainer">'))+("tv"===currentMode?'<div class="nowPlayingBarImage nowPlayingBarImage-tv" loading="lazy"></div>':'<div class="nowPlayingBarImage" loading="lazy"></div>')+'<div class="nowPlayingBarText nowPlayingBar-hidetv"></div>')+'</div><button is="emby-button" type="button" class="nowPlayingBarTVText'+(className="tv"===currentMode?"":" hide")+' button-link button-link-color-inherit" tabindex="-1"></button>')+("tv"===currentMode?'<div class="nowPlayingBarCenter nowPlayingBarCenter-tv">':'<div class="nowPlayingBarCenter nowPlayingBarCenter-autohide">')+'<button is="paper-icon-button-light" class="nowPlayingBar-hidetv previousTrackButton mediaButton md-icon md-icon-fill">&#xe045;</button>')+'<button is="paper-icon-button-light" class="nowPlayingBar-hidetv playPauseButton mediaButton md-icon md-icon-fill">&#xe034;</button><button is="paper-icon-button-light" class="nowPlayingBar-hidetv stopButton mediaButton md-icon md-icon-fill">&#xe047;</button>')+'<button is="paper-icon-button-light" class="nowPlayingBar-hidetv nextTrackButton mediaButton md-icon md-icon-fill">&#xe044;</button>'+("tv"===currentMode?'<div class="nowPlayingBarCurrentTime"></div>':'<div class="nowPlayingBarCurrentTime nowPlayingBarCurrentTime-autohide"></div>'))+'</div><div class="nowPlayingBarRight nowPlayingBar-hidetv">')+'<button is="paper-icon-button-light" class="nowPlayingBar-hidetv nowPlayingBarMuteButton muteButton mediaButton hide md-icon md-icon-fill">&#xe050;</button><div class="sliderContainer nowPlayingBarVolumeSliderContainer hide" style="width:100px;vertical-align:middle;display:inline-flex;">')+'<input type="range" is="emby-slider" pin step="1" min="0" max="100" value="0" class="nowPlayingBarVolumeSlider" tabindex="-1" data-hoverthumb="true" /></div>',className="toggleButtonIcon",_dom.default.allowBackdropFilter()&&(className+=" toggleButtonIcon-backdropfilter"),html=(html=(html=(html=(html+='<button is="paper-icon-button-light" class="nowPlayingBar-hidetv toggleShuffleButton toggleButton mediaButton" style="padding:.24em;" title="'+_globalize.default.translate("Shuffle")+'"><i style="font-size:inherit;padding:.1em;" class="md-icon '+className+'">&#xe043;</i></button>')+'<button is="paper-icon-button-light" class="nowPlayingBar-hidetv toggleRepeatButton toggleButton mediaButton" style="padding:.24em;" title="'+_globalize.default.translate("HeaderRepeatMode")+'"><i style="font-size:inherit;padding:.1em;" class="md-icon '+className+'">&#xe040;</i></button>')+'<button is="emby-ratingbutton" type="button" class="nowPlayingBar-hidetv nowPlayingBarFavoriteButton listItemButton paper-icon-button-light md-icon">&#xe87D;</button><button is="paper-icon-button-light" class="nowPlayingBar-hidetv playPauseButton playPauseButton-right mediaButton md-icon md-icon-fill">&#xe034;</button>')+'<button is="paper-icon-button-light" class="nowPlayingBar-hidetv stopButton stopButton-right mediaButton md-icon md-icon-fill">&#xe047;</button><button is="paper-icon-button-light" class="nowPlayingBar-hidetv remoteControlButton mediaButton md-icon autortl">&#xe241;</button>')+"</div></div>",html="tv"!==currentMode?(html+='<div class="nowPlayingBarDropOverlay">')+'<h3 style="margin:0;"><i class="md-icon button-icon button-icon-left autortl" style="font-size:150%;">&#xe03b;</i>'+_globalize.default.translate("HeaderAddToPlayQueue")+"</h3></div></div>":html)),nowPlayingBarElement=responses.querySelector(".nowPlayingBar"),_shortcuts.default.on(nowPlayingBarElement);var html,className=nowPlayingBarElement;"tv"!==currentMode&&_dom.default.addEventListener(className,_dom.default.whichTransitionEvent(),onSlideDownComplete,{passive:!0}),nowPlayingImageElement=className.querySelector(".nowPlayingBarImage"),nowPlayingTextElement=className.querySelector(".nowPlayingBarText"),nowPlayingBarTVTextElement=className.querySelector(".nowPlayingBarTVText"),nowPlayingBarFavoriteButton=className.querySelector(".nowPlayingBarFavoriteButton"),positionSlider=className.querySelector(".nowPlayingBarPositionSlider"),osdController=new _osdcontroller.default({nowPlayingPositionSlider:positionSlider,positionTextElem:className.querySelector(".nowPlayingBarCurrentTime"),durationTextElem:null,enableSeekThumbnails:!1}),_events.default.on(osdController,"displayitemupdated",onDisplayItemUpdated),osdController.bindToPlayer(currentPlayer),(muteButton=className.querySelector(".muteButton")).addEventListener("click",function(){currentPlayer&&_playbackmanager.default.toggleMute(currentPlayer)}),stopButtonRight=className.querySelector(".stopButton-right");for(var stopButtons=className.querySelectorAll(".stopButton"),i=0,length=stopButtons.length;i<length;i++)stopButtons[i].addEventListener("click",onStopClick);for(var _i=0,_length=(playPauseButtons=className.querySelectorAll(".playPauseButton")).length;_i<_length;_i++)playPauseButtons[_i].addEventListener("click",onPlayPauseClick);className.querySelector(".nextTrackButton").addEventListener("click",function(){currentPlayer&&_playbackmanager.default.nextTrack(currentPlayer)}),className.querySelector(".previousTrackButton").addEventListener("click",function(){currentPlayer&&_playbackmanager.default.previousTrack(currentPlayer)}),(remoteControlButton=className.querySelector(".remoteControlButton")).addEventListener("click",showRemoteControl),(toggleRepeatButton=className.querySelector(".toggleRepeatButton")).addEventListener("click",function(){currentPlayer&&_playbackmanager.default.toggleRepeatMode(currentPlayer)}),(toggleShuffleButton=className.querySelector(".toggleShuffleButton")).addEventListener("click",function(){currentPlayer&&_playbackmanager.default.toggleShuffle(currentPlayer)}),volumeSlider=className.querySelector(".nowPlayingBarVolumeSlider"),volumeSliderContainer=className.querySelector(".nowPlayingBarVolumeSliderContainer"),volumeSlider.addEventListener("change",function(){currentPlayer&&currentPlayer.setVolume(this.value)}),volumeSlider.addEventListener("input",function(){currentPlayer&&currentPlayer.setVolume(this.value)}),positionSlider.getBubbleHtml=function(value){return osdController.getPositionBubbleHtml(value,currentRuntimeTicks)},className.addEventListener("click",function(e){e.target.closest("BUTTON:not(.nowPlayingBarTVText),INPUT,A")||showRemoteControl()}),className.addEventListener("dragover",onDragOver),className.addEventListener("dragend",onDragEnd),className.addEventListener("dragenter",onDragEnter),className.addEventListener("dragleave",onDragLeave),className.addEventListener("drop",onDrop)}return Promise.resolve(nowPlayingBarElement)}))}function updatePlayPauseState(isPaused){var i,length;if(playPauseButtons)if(isPaused)for(i=0,length=playPauseButtons.length;i<length;i++)playPauseButtons[i].innerHTML="&#xe037;";else for(i=0,length=playPauseButtons.length;i<length;i++)playPauseButtons[i].innerHTML="&#xe034;"}function updatePlayerStateInternal(event,state,player){isVisibilityAllowed?("tv"!==currentMode&&appFooter&&appFooter.setWithContent(!0),getNowPlayingBar().then(slideUp)):hideNowPlayingBar();var playerInfo=_playbackmanager.default.getPlayerInfo(player),playState=state.PlayState||{},event=(osdController&&(osdController.disablePositionSlider="tv"===currentMode,osdController.updatePlayerState(event,player,state)),updatePlayPauseState(playState.IsPaused),playerInfo.supportedCommands||[]),playerInfo=(currentPlayerSupportedCommands=event,state.NowPlayingItem||{});!event.includes("SetRepeatMode")||player.isLocalPlayer&&"Video"===playerInfo.MediaType?toggleRepeatButton.classList.add("hide"):toggleRepeatButton.classList.remove("hide"),!event.includes("SetShuffle")||player.isLocalPlayer&&"Video"===playerInfo.MediaType?toggleShuffleButton.classList.add("hide"):toggleShuffleButton.classList.remove("hide"),player.isLocalPlayer&&"Video"===playerInfo.MediaType?(remoteControlButton.innerHTML="&#xe5d0;",stopButtonRight.classList.remove("hide")):(remoteControlButton.innerHTML="&#xe241;",stopButtonRight.classList.add("hide")),updateRepeatModeDisplay(playState.RepeatMode),updateShuffleDisplay(playState.Shuffle),updatePlayerVolumeState(playState.IsMuted,playState.VolumeLevel),updateTimeDisplay(playState.PositionTicks,playerInfo.RunTimeTicks,_playbackmanager.default.getSeekableRanges(player))}function updateRepeatModeDisplay(repeatMode){var icon=toggleRepeatButton.querySelector("i"),btnRepeatMode=toggleRepeatButton;"RepeatAll"===repeatMode?(icon.innerHTML="&#xe040;",icon.classList.add("toggleButtonIcon-active"),btnRepeatMode.classList.add("toggleButton-active")):"RepeatOne"===repeatMode?(icon.innerHTML="&#xe041;",icon.classList.add("toggleButtonIcon-active"),btnRepeatMode.classList.add("toggleButton-active")):(icon.innerHTML="&#xe040;",icon.classList.remove("toggleButtonIcon-active"),btnRepeatMode.classList.remove("toggleButton-active"))}function updateShuffleDisplay(shuffle){var icon=toggleShuffleButton.querySelector("i"),btn=toggleShuffleButton;shuffle?(icon.classList.add("toggleButtonIcon-active"),btn.classList.add("toggleButton-active")):(icon.classList.remove("toggleButtonIcon-active"),btn.classList.remove("toggleButton-active"))}function updateTimeDisplay(positionTicks,runtimeTicks,seekableRanges){var _osdController;null!=(_osdController=osdController)&&_osdController.onPlayerTimeUpdate(positionTicks,runtimeTicks,seekableRanges)}function updatePlayerVolumeState(isMuted,volumeLevel){var supportedCommands=currentPlayerSupportedCommands,showMuteButton=!0,showVolumeSlider=!0;-1===supportedCommands.indexOf("ToggleMute")&&(showMuteButton=!1),muteButton.innerHTML=isMuted?"&#xe04F;":"&#xe050;",-1===supportedCommands.indexOf("SetVolume")&&(showVolumeSlider=!1),showMuteButton?muteButton.classList.remove("hide"):muteButton.classList.add("hide"),volumeSlider&&(showVolumeSlider?volumeSliderContainer.classList.remove("hide"):volumeSliderContainer.classList.add("hide"),volumeSlider.dragging||(supportedCommands=isMuted?0:volumeLevel,(showMuteButton=volumeSlider).setValue?showMuteButton.setValue(supportedCommands):function(slider,value){slider.waitForCustomElementUpgrade().then(function(){slider.setValue(value)})}(showMuteButton,supportedCommands)))}function getTextActionButton(item,text,serverId,enableButton,addComma){text=text||_itemmanager.default.getDisplayName(item)||"",addComma&&(text+=", ");addComma="";return enableButton?(addComma=(addComma="<button "+_shortcuts.default.getShortcutAttributesHtml(item,{serverId:serverId})+' type="button" class="itemAction button-link button-inherit-color nowPlayingBarButton-autohide textItem" data-action="link" is="emby-button">')+text+'</button><div class="nowPlayingBarText-autohide textItem">')+text+"</div>":(addComma+='<div class="textItem">')+text+"</div>"}function getNowPlayingNames(nowPlayingItem,includeNonNameInfo,enableTextLinks){var topText=nowPlayingItem.Name,topText=nowPlayingItem.AlbumId&&"Audio"===nowPlayingItem.MediaType?getTextActionButton({Id:nowPlayingItem.AlbumId,Name:nowPlayingItem.Album,Type:"MusicAlbum",IsFolder:!0,ServerId:nowPlayingItem.ServerId},topText,null,enableTextLinks):_itemmanager.default.getDisplayName(nowPlayingItem,{})||nowPlayingItem.Name,bottomText="",includeNonNameInfo=(nowPlayingItem.ArtistItems&&nowPlayingItem.ArtistItems.length?bottomText=nowPlayingItem.ArtistItems.map(function(a,index){return getTextActionButton({Id:a.Id,Name:a.Name,Type:"MusicArtist",IsFolder:!0,ServerId:nowPlayingItem.ServerId},null,null,enableTextLinks,index<nowPlayingItem.ArtistItems.length-1)}).join(""):nowPlayingItem.SeriesName||nowPlayingItem.Album?(bottomText=topText,topText=nowPlayingItem.SeriesName||nowPlayingItem.Album,nowPlayingItem.SeriesId&&(topText=getTextActionButton({Id:nowPlayingItem.SeriesId,Name:nowPlayingItem.SeriesName,Type:"Series",IsFolder:!0,ServerId:nowPlayingItem.ServerId},topText,null,enableTextLinks))):nowPlayingItem.ProductionYear&&!1!==includeNonNameInfo&&(bottomText=nowPlayingItem.ProductionYear),[]);return enableTextLinks?(includeNonNameInfo.push('<div class="textItems nowplayingbar-textitems">'+topText+"</div>"),bottomText&&includeNonNameInfo.push('<div class="textItems secondaryText nowplayingbar-textitems">'+bottomText+"</div>")):(includeNonNameInfo.push('<div class="textItems nowplayingbar-textitems">'+topText+"</div>"),bottomText&&includeNonNameInfo.push('<div class="textItems nowplayingbar-textitems">'+bottomText+"</div>")),includeNonNameInfo}function onDisplayItemUpdated(e,item,displayItem,state){var textLines=displayItem?getNowPlayingNames(displayItem,null,!0):[],textLines=(nowPlayingTextElement.innerHTML=textLines.join(""),nowPlayingBarTVTextElement.innerHTML=(displayItem?getNowPlayingNames(displayItem):[]).join('<div style="margin: 0.5em;"> - </div>'),displayItem?function(item,options){if(item)return"Episode"!==item.Type?null:((options=options||{}).type=options.type||"Primary","Primary"===options.type&&item.SeriesPrimaryImageTag?(options.tag=item.SeriesPrimaryImageTag,{url:_connectionmanager.default.getApiClient(item).getImageUrl(item.SeriesId,options),aspect:"2/3"}):"Thumb"===options.type&&item.ParentThumbImageTag?(options.tag=item.ParentThumbImageTag,{url:_connectionmanager.default.getApiClient(item).getImageUrl(item.ParentThumbItemId,options),aspect:"16/9"}):null);throw new Error("item cannot be null!")}(displayItem,{height:70})||function(item,options){if(!item)throw new Error("item cannot be null!");(options=options||{}).type=options.type||"Primary";var imageTags=item.ImageTags||{};return options.tag=item.PrimaryImageTag||imageTags[options.type],options.tag?{url:_connectionmanager.default.getApiClient(item).getImageUrl(item.PrimaryImageItemId||item.Id||item.ItemId,options),aspect:item.PrimaryImageAspectRatio?item.PrimaryImageAspectRatio.toString():"1"}:item.AlbumId&&item.AlbumPrimaryImageTag?(options.tag=item.AlbumPrimaryImageTag,{url:_connectionmanager.default.getApiClient(item).getImageUrl(item.AlbumId,options),aspect:"1"}):null}(displayItem,{height:70}):null),url=textLines?textLines.url:null;url!==currentImgUrl&&((currentImgUrl=url)?(nowPlayingImageElement.style["aspect-ratio"]=textLines.aspect,nowPlayingImageElement.style.backgroundImage="url('"+url+"')",nowPlayingImageElement.classList.remove("defaultCardBackground"),nowPlayingImageElement.innerHTML=""):(nowPlayingImageElement.style.backgroundImage="",nowPlayingImageElement.style["aspect-ratio"]="1",nowPlayingImageElement.classList.add("defaultCardBackground"),nowPlayingImageElement.innerHTML='<i class="md-icon nowPlayingBarDefaultItemIcon autortl">'+_itemmanager.default.getDefaultIcon(displayItem)+"</i>")),displayItem&&_itemmanager.default.canRate(item)?(nowPlayingBarFavoriteButton.setItem(displayItem),nowPlayingBarFavoriteButton.classList.remove("hide")):(nowPlayingBarFavoriteButton.classList.add("hide"),nowPlayingBarFavoriteButton.setItem(null))}function onPlaybackStart(e,state){var _osdController2;null!=(_osdController2=osdController)&&_osdController2.onPlaybackStart(e,state);onStateChanged.call(this,e,state)}function onShuffleChange(e){isEnabled&&updateShuffleDisplay(_playbackmanager.default.getShuffle(this))}function onRepeatModeChange(e){isEnabled&&updateRepeatModeDisplay(_playbackmanager.default.getRepeatMode(this))}function hideNowPlayingBar(){isEnabled=!1,nowPlayingBarElement&&function(elem){elem._visible&&(elem._visible=!1,"tv"===currentMode?(_inputmanager.default.off(headerElement,onInputCommand),elem.classList.add("nowPlayingBar-hidden","hide"),headerElement.classList.remove("skinHeader-withnowplaying"),document.documentElement.classList.remove("withheadernowplaying")):(elem.classList.remove("nowPlayingBar-footer-transition"),elem.offsetWidth,elem.classList.add("nowPlayingBar-footer-transition"),elem.offsetWidth,elem.classList.add("nowPlayingBar-hidden")))}(nowPlayingBarElement),"tv"!==currentMode&&appFooter&&appFooter.setWithContent(!1)}function onPlaybackStopped(e,state){var _osdController3;null!=(_osdController3=osdController)&&_osdController3.onPlaybackStopped(e,state);this.isLocalPlayer?"Audio"!==state.NextMediaType&&"Video"!==state.NextMediaType&&hideNowPlayingBar():state.NextMediaType||hideNowPlayingBar()}function onPlayPauseStateChanged(e){isEnabled&&updatePlayPauseState(this.paused())}function onStateChanged(event,state){var player=this;if(state.IsBackgroundPlayback)hideNowPlayingBar();else if(state.NowPlayingItem){if(player.isLocalPlayer&&state.NowPlayingItem){if("Video"===state.NowPlayingItem.MediaType)if(!_usersettings.default.enableVideoUnderUI())return void hideNowPlayingBar();if("Audio"!==state.NowPlayingItem.MediaType&&"Video"!==state.NowPlayingItem.MediaType)return void hideNowPlayingBar()}isEnabled=!0,nowPlayingBarElement?updatePlayerStateInternal(event,state,player):getNowPlayingBar().then(function(){updatePlayerStateInternal(event,state,player)})}else hideNowPlayingBar()}function onTimeUpdate(e){var now;!isEnabled||(now=Date.now())-lastUpdateTime<700||(lastUpdateTime=now,currentRuntimeTicks=_playbackmanager.default.duration(this),updateTimeDisplay(_playbackmanager.default.currentTime(this),currentRuntimeTicks,_playbackmanager.default.getSeekableRanges(this)))}function onVolumeChanged(e){isEnabled&&updatePlayerVolumeState(this.isMuted(),this.getVolume())}function refreshFromPlayer(player){var state=_playbackmanager.default.getPlayerState(player);onStateChanged.call(player,{type:"init"},state)}function bindToPlayer(player){var _osdController5;null!=(_osdController5=osdController)&&_osdController5.bindToPlayer(player),player!==currentPlayer&&(null!=(_osdController5=osdController)&&_osdController5.releaseCurrentPlayer(),(_osdController5=currentPlayer)&&(_events.default.off(_osdController5,"playbackstart",onPlaybackStart),_events.default.off(_osdController5,"statechange",onPlaybackStart),_events.default.off(_osdController5,"repeatmodechange",onRepeatModeChange),_events.default.off(_osdController5,"shufflechange",onShuffleChange),_events.default.off(_osdController5,"playbackstop",onPlaybackStopped),_events.default.off(_osdController5,"volumechange",onVolumeChanged),_events.default.off(_osdController5,"pause",onPlayPauseStateChanged),_events.default.off(_osdController5,"unpause",onPlayPauseStateChanged),_events.default.off(_osdController5,"timeupdate",onTimeUpdate),currentPlayer=null,hideNowPlayingBar()),currentPlayer=player)&&(refreshFromPlayer(player),_events.default.on(player,"playbackstart",onPlaybackStart),_events.default.on(player,"statechange",onPlaybackStart),_events.default.on(player,"repeatmodechange",onRepeatModeChange),_events.default.on(player,"shufflechange",onShuffleChange),_events.default.on(player,"playbackstop",onPlaybackStopped),_events.default.on(player,"volumechange",onVolumeChanged),_events.default.on(player,"pause",onPlayPauseStateChanged),_events.default.on(player,"unpause",onPlayPauseStateChanged),_events.default.on(player,"timeupdate",onTimeUpdate))}_events.default.on(_playbackmanager.default,"playerchange",function(e,player){bindToPlayer(player)}),bindToPlayer(_playbackmanager.default.getCurrentPlayer()),document.addEventListener("viewbeforeshow",function(e){var _e$detail$params;"true"!==(null==(_e$detail$params=e.detail.params)?void 0:_e$detail$params.asDialog)&&(!function(e){return!1!==e.detail.enableMediaControl&&!("tv"===currentMode&&!e.detail.enableMediaControlTV)}(e)?isVisibilityAllowed&&(isVisibilityAllowed=!1,hideNowPlayingBar()):isVisibilityAllowed||(isVisibilityAllowed=!0,currentPlayer?refreshFromPlayer(currentPlayer):hideNowPlayingBar()))})});