define(["exports","./../dom.js","./../browser.js","./../layoutmanager.js","./../common/globalize.js","./../common/datetime.js","./../common/textencoding.js","./../mediainfo/mediainfo.js","./../indicators/indicators.js","./../focusmanager.js","./../common/itemmanager/itemmanager.js","./../emby-apiclient/connectionmanager.js","./../common/imagehelper.js","./../lazyloader/lazyimageloader.js","./../shortcuts.js","./../common/playback/playbackmanager.js","./../emby-elements/userdatabuttons/emby-ratingbutton.js","./../emby-elements/userdatabuttons/emby-playstatebutton.js","./../common/dataformatter.js","./../emby-elements/emby-button/emby-button.js"],function(_exports,_dom,_browser,_layoutmanager,_globalize,_datetime,_textencoding,_mediainfo,_indicators,_focusmanager,_itemmanager,_connectionmanager,_imagehelper,_lazyimageloader,_shortcuts,_playbackmanager,_embyRatingbutton,_embyPlaystatebutton,_dataformatter,_embyButton){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,require(["css!modules/listview/listview.css"]);var embyCheckboxLoaded,supportsNativeLazyLoading="loading"in HTMLImageElement.prototype,decodingAttribute=_dom.default.supportsAsyncDecodedImages()?' decoding="async"':"",supportsObjectFit=CSS.supports("object-fit","contain")&&!_browser.default.edge,enableFocusTransfrom=_dom.default.allowFocusScaling(),secondaryTextClass=CSS.supports("color","var(--fake-var)")?"secondaryText":"",DownloadIcon="&#xe5db;";function getTextLinesHtml(textlines,options){for(var html="",isFirst=!0,listItemBodyTextTagName=options.listItemBodyTextTagName,cssClass=options.listItemBodyTextClass,i=0,length=textlines.length;i<length;i++){var text=textlines[i];text&&(isFirst?(html+="<"+listItemBodyTextTagName+' class="'+cssClass+'">',isFirst=!1,listItemBodyTextTagName="div"):html+='<div class="'+cssClass+" "+options.listItemBodyTextSecondaryClass+'">',html=html+text+"</"+listItemBodyTextTagName+">")}return html}function getId(item){return item.Id}function getTextActionButton(options,item,text,serverId,parentId,isSameItemAsCard){return text=text||_itemmanager.default.getDisplayName(item),!_layoutmanager.default.tv&&!1!==options.textLinks&&(item.Id||isSameItemAsCard)?'<button title="'+(text=_textencoding.default.htmlEncode(text))+'" title="'+text+'" '+(isSameItemAsCard?"":_shortcuts.default.getShortcutAttributesHtml(item,{serverId:serverId,parentId:parentId}))+' type="button"'+(!options.draggable||isSameItemAsCard?"":' draggable="true"')+' class="itemAction textActionButton listItem-textActionButton emby-button button-link" data-action="link">'+text+"</button>":_textencoding.default.htmlEncode(text)}function isUsingLiveTvNaming(itemType){return"Program"===itemType||"Timer"===itemType||"Recording"===itemType}function mapArtistsToTextButtons(item,artistItems,options){return artistItems.map(function(a){return a.Type="MusicArtist",a.IsFolder=!0,getTextActionButton(options,a,null,item.ServerId)}).join(", ")}function getMdIconClass(icon){switch(icon){case"&#xe88a;":case"&#xe034;":case"&#xe037;":case"&#xe042;":case"&#xe044;":case"&#xe045;":case"&#xe047;":case"&#xe061;":case"&#xe062;":return" md-icon-fill";case"&#xe8cd;":case"&#xec0b;":return" md-icon-pushdown-bubble";default:return""}}function getPlayAction(item,options){return item.IsFolder?"resume":"Photo"===item.MediaType?"playallfromhere":options.playAction}function getListItemHtml(item,index,options){var fields,enableSideMediaInfo=options.enableSideMediaInfo,tagName=options.tagName,action=options.action,html="",downloadWidth=options.imageDownloadWidth,hoverPlayButtonRequested=!_layoutmanager.default.tv&&!1!==options.hoverPlayButton,enableHoverPlayButton=hoverPlayButtonRequested&&_playbackmanager.default.canPlay(item),itemType=item.Type,itemController=_itemmanager.default.getItemController(itemType),serverId=(html+="<div"+(options.tooltip?' title="'+_textencoding.default.htmlEncode(itemController.getDisplayName(item,{}))+'"':"")+' class="'+options.contentWrapperClass+'">',options.enableBottomOverview&&(html+='<div class="listItem-innerwrapper">'),item.ServerId),apiClient=serverId?_connectionmanager.default.getApiClient(serverId):null,fieldMap=(options.multiSelect&&(html+='<label title="'+options.multiSelectTitle+'" data-action="multiselect" class="chkListItemSelectContainer chkItemSelectContainer itemAction emby-checkbox-label"><input tabindex="-1" class="chkListItemSelect chkItemSelect emby-checkbox emby-checkbox-notext" is="emby-checkbox" type="checkbox" data-classes="true" /><span class="checkboxLabel chkListItemSelect-checkboxLabel"></span></label>'),options.fieldMap),listItemBodyTextTagName=(fieldMap.ItemCheckbox&&(checkbox=options.itemCheckbox,html+=checkbox=(options.getIsItemChecked?options.getIsItemChecked(item):item.Selected||!1===item.Disabled)?checkbox.replace('type="checkbox"','type="checkbox" checked'):checkbox),options.treeButton&&(item.IsFolder?html+=options.treeButtonHtml:html+=options.disabledTreeButtonHtml),!1!==options.image&&(checkbox=options.showCurrentProgramImage?item.CurrentProgram||item:item.ProgramInfo||item,downloadWidth=_imagehelper.default.getImageUrl(checkbox,apiClient,{width:downloadWidth,showChannelLogo:"channel"===options.imageSource,uiAspect:options.aspectInfo.aspect}),imgUrl=options.preferIcon?null:downloadWidth.imgUrl,imageContainerClass=options.imageContainerClass,imageClass="listItemImage",options.imageSize&&(imageClass+=" listItemImage-"+options.imageSize),options.roundImage&&(imageClass+=" listItemImage-round",imgUrl||(imageContainerClass+=" listItemImageContainer-round")),playOnImageClick=options.imagePlayButton&&!_layoutmanager.default.tv,options.playQueueIndicator&&item.PlaylistItemId&&(_playbackmanager.default.currentItem()||{}).PlaylistItemId===item.PlaylistItemId&&(imageContainerClass+=" playlistIndexIndicatorImage"),imageAction=playOnImageClick?"resume":action,(imgUrl||options.preferIcon||!1===options.defaultBackground)&&!options.defaultBackground||(imageContainerClass+=" defaultCardBackground"),styleRules=[],(color="Error"===item.Severity||"Fatal"===item.Severity||"Warn"===item.Severity?"background-color:#cc0000;color:#fff;":"")&&styleRules.push(color),styleRules.push("aspect-ratio:"+options.aspectInfo.aspectCss),html+='<div data-action="'+imageAction+'" class="'+imageContainerClass+'"'+(styleRules.length?' style="'+styleRules.join(";")+'"':"")+">",color=_indicators.default.getProgressBarHtml(item,{containerClass:"listItemProgressBar"}),imgUrl?(imageAction=downloadWidth.aspect?_imagehelper.default.getShapeFromAspect(downloadWidth.aspect):_imagehelper.default.getShape([item],options)||"square",imageContainerClass=_imagehelper.default.getAspectFromShape(imageAction,options),imageClass+=" listItemImage-"+imageAction,(styleRules=_imagehelper.default.getCoveredImageClass(checkbox,apiClient,downloadWidth,imageContainerClass.aspect))&&(imageClass+=styleRules),2===options.lazy?supportsObjectFit?(html+='<img draggable="false" class="'+imageClass+'"'+decodingAttribute+' style="aspect-ratio:'+imageContainerClass.aspectCss+';" src="'+imgUrl+'" />',isImg=!0):html+='<div class="'+imageClass+'" style="aspect-ratio:'+imageContainerClass.aspectCss+";background-image:url("+imgUrl+');">':supportsNativeLazyLoading&&supportsObjectFit?(html+='<img draggable="false" class="'+imageClass+'" loading="lazy"'+decodingAttribute+' style="aspect-ratio:'+imageContainerClass.aspectCss+';" src="'+imgUrl+'" />',isImg=!0):html+='<div class="'+imageClass+' lazy" style="aspect-ratio:'+imageContainerClass.aspectCss+";background-image:url("+imgUrl+');">',color&&(html+=color),isImg||(html+="</div>")):((imageAction=!(imageAction=item.Icon)&&options.enableDefaultIcon?itemController.getDefaultIcon(item):imageAction)&&(checkbox=options.iconClass,item.iconClass&&(checkbox+=" "+item.iconClass),html+='<i class="'+(checkbox+=getMdIconClass(imageAction))+'">'+imageAction+"</i>"),color&&(html+=color)),options.iconSpacing||(downloadWidth=_indicators.default.getPlayedIndicatorHtml(item,options.indicatorClass))&&(html+=downloadWidth),enableHoverPlayButton&&(html+='<button tabindex="-1" type="button" is="paper-icon-button-light" class="listItemOverlayButton-hover listItemOverlayButton-imagehover itemAction" data-action="'+getPlayAction(item,options)+'"><i class="md-icon md-icon-fill listItemOverlayButtonIcon autortl">&#xe037;</i></button>'),playOnImageClick&&(html+='<button title="'+_globalize.default.translate("Play")+'"  aria-label="'+_globalize.default.translate("Play")+'"type="button" is="paper-icon-button-light" class="listItemImageButton itemAction" data-action="resume"><i class="md-icon md-icon-fill listItemImageButton-icon autortl">&#xe037;</i></button>'),html+="</div>"),(options.showIndexNumberLeft||options.showChapterTimeLeft)&&(styleRules="listItem-indexnumberleft secondaryText",hoverPlayButtonRequested&&(styleRules+=" listItem-indexnumberleft-withhoverbutton"),options.showChapterTimeLeft?(html+='<div class="'+styleRules+'" style="width:9ch;">',null==item.StartPositionTicks?html+="&nbsp;":html+=_datetime.default.getDisplayRunningTime(item.StartPositionTicks)):options.showIndexNumberLeft&&(html+='<div class="'+styleRules+'">',null==item.IndexNumber?html+="&nbsp;":html+=item.IndexNumber),enableHoverPlayButton&&(html+='<button tabindex="-1" type="button" is="paper-icon-button-light" class="listItemOverlayButton-hover itemAction" data-action="'+getPlayAction(item,options)+'"><i class="md-icon md-icon-fill listItemOverlayButtonIcon autortl">&#xe037;</i></button>'),html+="</div>"),html+="<"+options.listItemBodyTagName+' class="'+options.listItemBodyClassName+'">',options.listItemBodyTextTagName),textCssClass=options.listItemBodyTextClass,listItemBodyTextOpen="<"+listItemBodyTextTagName+' class="'+textCssClass+'">',listItemBodyTextClose="</"+listItemBodyTextTagName+">",secondaryListItemBodyTextOpen='<div class="'+textCssClass+" "+options.listItemBodyTextSecondaryClass+'">',imageClass=item.ProgramInfo||item;switch(itemType){case"MusicAlbum":case"Audio":case"MusicVideo":case"Game":fields=options.fieldsParentNameAfter||options.fields;break;default:fields=options.fields}var displayName=_itemmanager.default.getDisplayName(imageClass,{includeParentInfo:options.includeParentInfoInTitle,includeIndexNumber:options.includeIndexNumberInTitle||(!item.SupportsResume||"Audio"!==item.Type)&&null});options.showIndexNumber&&null!=imageClass.IndexNumber&&(displayName=imageClass.IndexNumber+". "+displayName);for(var i=0,length=fields.length;i<length;i++){var mediaInfoHtml,field=fields[i];switch(field){case"Name":options.mediaInfoWithTitle?((mediaInfoHtml=_mediainfo.default.getPrimaryMediaInfoHtml(item,{episodeTitle:!1,originalAirDate:!1,subtitles:!1,endsAt:!1}))?html=html+("<"+listItemBodyTextTagName+' class="listItemBodyText listItemBodyText-withmediainfo mediaInfoItems listItemBodyText-nowrap '+options.listItemBodyTextSecondaryClass)+' flex align-items-center flex-direction-row">'+mediaInfoHtml:html+=listItemBodyTextOpen,html=html+_textencoding.default.htmlEncode(displayName)+listItemBodyTextClose,listItemBodyTextTagName="div",listItemBodyTextOpen=secondaryListItemBodyTextOpen,listItemBodyTextClose="</div>"):displayName&&(html+=listItemBodyTextOpen+_textencoding.default.htmlEncode(displayName)+listItemBodyTextClose,listItemBodyTextTagName="div",listItemBodyTextOpen=secondaryListItemBodyTextOpen,listItemBodyTextClose="</div>");break;case"ParentNameOrName":"Episode"===itemType&&item.SeriesName?item.SeriesId?(html+=listItemBodyTextOpen+getTextActionButton(options,{Id:item.SeriesId,ServerId:serverId,Name:item.SeriesName,Type:"Series",IsFolder:!0})+listItemBodyTextClose,listItemBodyTextTagName="div",listItemBodyTextOpen=secondaryListItemBodyTextOpen,listItemBodyTextClose="</div>"):item.SeriesName&&(html+=listItemBodyTextOpen+_textencoding.default.htmlEncode(item.SeriesName||"")+listItemBodyTextClose,listItemBodyTextTagName="div",listItemBodyTextOpen=secondaryListItemBodyTextOpen,listItemBodyTextClose="</div>"):isUsingLiveTvNaming(itemType)?(html+=listItemBodyTextOpen+_textencoding.default.htmlEncode(item.Name||"")+listItemBodyTextClose,listItemBodyTextTagName="div",listItemBodyTextOpen=secondaryListItemBodyTextOpen,listItemBodyTextClose="</div>"):(mediaInfoHtml=item.SeriesName||item.Series||item.Album||(item.AlbumArtist?item.AlbumArtist.Name||item.AlbumArtist:null)||item.GameSystem||"")&&(html+=listItemBodyTextOpen+_textencoding.default.htmlEncode(mediaInfoHtml||"")+listItemBodyTextClose,listItemBodyTextTagName="div",listItemBodyTextOpen=secondaryListItemBodyTextOpen,listItemBodyTextClose="</div>");break;case"ParentName":var showArtist=void 0,containerAlbumArtistIds=options.containerAlbumArtistIds,artistItems="MusicAlbum"===item.Type?item.AlbumArtists:item.ArtistItems;(!artistItems||!artistItems.length||1<artistItems.length||!containerAlbumArtistIds||1!==containerAlbumArtistIds.length||-1===containerAlbumArtistIds.indexOf(artistItems[0].Id))&&(showArtist=!0),item.AlbumArtists&&item.AlbumArtists.length&&"MusicAlbum"===itemType?html+=listItemBodyTextOpen+mapArtistsToTextButtons(item,artistItems,options)+listItemBodyTextClose:item.ArtistItems&&item.ArtistItems.length||item.AlbumArtists&&item.AlbumArtists.length?showArtist&&(html+=listItemBodyTextOpen+mapArtistsToTextButtons(item,artistItems,options)+listItemBodyTextClose):item.GameSystem&&item.GameSystemId?html+=listItemBodyTextOpen+getTextActionButton(options,{Id:item.GameSystemId,ServerId:serverId,Name:item.GameSystem,Type:"GameSystem",IsFolder:!0})+listItemBodyTextClose:html+=listItemBodyTextOpen+_textencoding.default.htmlEncode(isUsingLiveTvNaming(itemType)?item.Name:item.SeriesName||item.Series||item.Album||(item.AlbumArtist?item.AlbumArtist.Name||item.AlbumArtist:null)||item.GameSystem||"")+listItemBodyTextClose,listItemBodyTextTagName="div",listItemBodyTextOpen=secondaryListItemBodyTextOpen,listItemBodyTextClose="</div>";break;case"ItemCheckbox":case"ProductionYear":case"Overview":break;case"Type":html+=listItemBodyTextOpen+itemController.getItemTypeName(item.Type)+listItemBodyTextClose,listItemBodyTextTagName="div",listItemBodyTextOpen=secondaryListItemBodyTextOpen,listItemBodyTextClose="</div>";break;case"StartDateTime":html+=listItemBodyTextOpen+_datetime.default.toLocaleString(new Date(Date.parse(item.StartDate)),{weekday:"long",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})+listItemBodyTextClose,listItemBodyTextTagName="div",listItemBodyTextOpen=secondaryListItemBodyTextOpen,listItemBodyTextClose="</div>";break;case"StartToEndDateTime":html=(html+='<div class="listItemBodyText-withspacing '+textCssClass+" "+options.listItemBodyTextSecondaryClass+'">'+_datetime.default.toLocaleString(new Date(Date.parse(item.StartDate)),{weekday:"long",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}))+(" &ndash; "+_datetime.default.toLocaleString(new Date(Date.parse(item.EndDate)),{hour:"numeric",minute:"2-digit"}))+listItemBodyTextClose,listItemBodyTextTagName="div",listItemBodyTextOpen=secondaryListItemBodyTextOpen,listItemBodyTextClose="</div>";break;case"ChannelName":html=html+listItemBodyTextOpen+'<div class="flex align-items-center">',containerAlbumArtistIds=[];"TvChannel"===item.Type?containerAlbumArtistIds.push(item.Name):item.ChannelName?containerAlbumArtistIds.push(item.ChannelName):item.ProgramInfo&&item.ProgramInfo.ChannelName&&containerAlbumArtistIds.push(item.ProgramInfo.ChannelName),item.ChannelNumber?containerAlbumArtistIds.push(item.ChannelNumber):item.ProgramInfo&&item.ProgramInfo.ChannelNumber&&containerAlbumArtistIds.push(item.ProgramInfo.ChannelNumber),html+=_textencoding.default.htmlEncode(containerAlbumArtistIds.join(" "))+"</div>"+listItemBodyTextClose,listItemBodyTextOpen=secondaryListItemBodyTextOpen,listItemBodyTextClose="</div>";break;case"MappedChannelInfo":html+=listItemBodyTextOpen;showArtist=void 0;item.ListingsChannelName&&(showArtist=item.ListingsChannelName,item.ListingsChannelNumber&&(showArtist=item.ListingsChannelNumber+" "+showArtist),item.AffiliateCallSign&&(showArtist+=" - "+item.AffiliateCallSign),(artistItems=item.ListingsId||item.ListingsPath)&&(showArtist+=" - "+_textencoding.default.htmlEncode(artistItems)),showArtist=_globalize.default.translate("MappedToValue",showArtist)),html=html+(showArtist||_globalize.default.translate("NotMappedToGuideData"))+listItemBodyTextClose,listItemBodyTextTagName="div",listItemBodyTextOpen=secondaryListItemBodyTextOpen,listItemBodyTextClose="</div>";break;case"CurrentProgramParentName":item.CurrentProgram&&(html+=listItemBodyTextOpen+_textencoding.default.htmlEncode(item.CurrentProgram.Name||"")+listItemBodyTextClose,listItemBodyTextOpen=secondaryListItemBodyTextOpen,listItemBodyTextClose="</div>");break;case"CurrentProgramName":null!=(_item$CurrentProgram=item.CurrentProgram)&&_item$CurrentProgram.EpisodeTitle&&(html+=listItemBodyTextOpen+_textencoding.default.htmlEncode(_itemmanager.default.getDisplayName(item.CurrentProgram))+listItemBodyTextClose,listItemBodyTextOpen=secondaryListItemBodyTextOpen,listItemBodyTextClose="</div>");break;case"CurrentProgramTime":item.CurrentProgram&&(html+=listItemBodyTextOpen+function(item,showAirDateTime,showAirEndTime){var airTimeText="";if(item.StartDate)try{var date=new Date(Date.parse(item.StartDate));showAirDateTime&&(airTimeText+=_datetime.default.toLocaleDateString(date,{weekday:"short",month:"short",day:"numeric"})+" "),airTimeText+=_datetime.default.getDisplayTime(date),item.EndDate&&showAirEndTime&&(date=new Date(Date.parse(item.EndDate)),airTimeText+=" &ndash; "+_datetime.default.getDisplayTime(date))}catch(e){console.log("Error parsing date: "+item.StartDate)}return airTimeText}(item.CurrentProgram,!1,!0)+listItemBodyTextClose,listItemBodyTextOpen=secondaryListItemBodyTextOpen,listItemBodyTextClose="</div>");break;case"LogLine":html+=listItemBodyTextOpen+_textencoding.default.htmlEncode(item)+listItemBodyTextClose,listItemBodyTextTagName="div",listItemBodyTextOpen=secondaryListItemBodyTextOpen,listItemBodyTextClose="</div>";break;case"DeviceUserInfo":var _item$CurrentProgram="";item.LastUserName&&(item.LastUserId?_item$CurrentProgram+=getTextActionButton(options,{Id:item.LastUserId,Name:item.LastUserName,ServerId:serverId,Type:"User"},item.LastUserName+", "+_dataformatter.default.formatRelativeTime(item.DateLastActivity),null,null):item.LastUserName&&(_item$CurrentProgram+=item.LastUserName+", "+_dataformatter.default.formatRelativeTime(item.DateLastActivity))),html+=listItemBodyTextOpen+_item$CurrentProgram+listItemBodyTextClose,listItemBodyTextOpen=secondaryListItemBodyTextOpen,listItemBodyTextClose="</div>";break;case"ChannelNumber":item.ChannelNumber&&(html+=listItemBodyTextOpen+_textencoding.default.htmlEncode(item.ChannelNumber)+listItemBodyTextClose,listItemBodyTextOpen=secondaryListItemBodyTextOpen,listItemBodyTextClose="</div>");break;case"ShortOverview":item.ShortOverview&&(html+=listItemBodyTextOpen+(item.ShortOverview?_textencoding.default.htmlEncode(item.ShortOverview):"&nbsp;")+listItemBodyTextClose,listItemBodyTextOpen=secondaryListItemBodyTextOpen,listItemBodyTextClose="</div>");break;case"Date":html+=listItemBodyTextOpen+_datetime.default.toLocaleString(new Date(Date.parse(item.Date)))+listItemBodyTextClose,listItemBodyTextOpen=secondaryListItemBodyTextOpen,listItemBodyTextClose="</div>";break;case"ChapterTime":html+=listItemBodyTextOpen+(null==item.StartPositionTicks?"":_datetime.default.getDisplayRunningTime(item.StartPositionTicks))+listItemBodyTextClose,listItemBodyTextOpen=secondaryListItemBodyTextOpen,listItemBodyTextClose="</div>";break;case"PathOrTitle":html+=listItemBodyTextOpen+(item.Path||item.Title?_textencoding.default.htmlEncode(item.Path||item.Title):"&nbsp;")+listItemBodyTextClose,listItemBodyTextOpen=secondaryListItemBodyTextOpen,listItemBodyTextClose="</div>";break;case"Text":html+=listItemBodyTextOpen+(item.Text?_textencoding.default.htmlEncode(item.Text):"&nbsp;")+listItemBodyTextClose,listItemBodyTextOpen=secondaryListItemBodyTextOpen,listItemBodyTextClose="</div>";break;case"Path":html+=listItemBodyTextOpen+(item.Path?_textencoding.default.htmlEncode(item.Path):"&nbsp;")+listItemBodyTextClose,listItemBodyTextOpen=secondaryListItemBodyTextOpen,listItemBodyTextClose="</div>";break;case"ProviderName":html+=listItemBodyTextOpen+(item.ProviderName?_textencoding.default.htmlEncode(item.ProviderName):"&nbsp;")+listItemBodyTextClose,listItemBodyTextOpen=secondaryListItemBodyTextOpen,listItemBodyTextClose="</div>";break;case"MediaInfo":var _mediaInfoHtml=_mediainfo.default.getPrimaryMediaInfoHtml(item,{episodeTitle:!1,subtitles:!1,endsAt:!1});_mediaInfoHtml&&(html+='<div class="'+("listItemMediaInfo mediaInfoItems listItemBodyText listItemBodyText-withmediainfo "+options.listItemBodyTextSecondaryClass+" listItemBodyText-nowrap")+'">'+_mediaInfoHtml+"</div>");break;default:_mediaInfoHtml=itemController.resolveField(item,field);html+=listItemBodyTextOpen+(_mediaInfoHtml=null==_mediaInfoHtml?"":_mediaInfoHtml)+listItemBodyTextClose,listItemBodyTextOpen=secondaryListItemBodyTextOpen,listItemBodyTextClose="</div>"}}var imgUrl,isImg,checkbox,imageAction,color,playOnImageClick,styleRules,imageContainerClass=[];if(fieldMap.MediaStreamInfo&&_mediainfo.default.pushMediaStreamLines(item,options,imageContainerClass,itemController.getDefaultIcon(item)),html+=getTextLinesHtml(imageContainerClass,options),!1===options.mediaInfo||enableSideMediaInfo||(html+='<div class="'+("listItemMediaInfo mediaInfoItems listItemBodyText "+options.listItemBodyTextSecondaryClass+" listItemBodyText-nowrap")+'">'+_mediainfo.default.getPrimaryMediaInfoHtml(item,{episodeTitle:!1,subtitles:!1,endsAt:!1})+"</div>"),fieldMap.Overview&&(html=(html+='<div class="'+options.topOverviewClassName+'">')+(item.Overview?_dom.default.stripScripts(item.Overview):"")+"</div>"),html+="</"+options.listItemBodyTagName+">",item.SyncStatus&&(imgUrl="listItem-syncStatusIcon",_layoutmanager.default.tv||(imgUrl+=" listItem-syncStatusIcon-smallfont"),html+='<div class="listItemMediaInfo mediaInfoItems secondaryText"><i class="md-icon '+imgUrl+'">'+DownloadIcon+"</i></div>"),!1!==options.mediaInfo&&enableSideMediaInfo&&(isImg=_mediainfo.default.getPrimaryMediaInfoHtml(item,{year:!1,container:!1,episodeTitle:!1,criticRating:!1,endsAt:!1}))&&(!(checkbox="listItemMediaInfo mediaInfoItems secondaryText")!==options.autoHideMediaInfo&&(checkbox+=" listItemMediaInfo-autohide"),html+='<div class="'+checkbox+'">'+isImg+"</div>"),options.recordButton||"Timer"!==itemType&&"Program"!==itemType||(html+=_indicators.default.getTimerIndicator(item).replace("indicatorIcon","indicatorIcon listItemAside")),item.asideText&&(html=(html+='<div class="listItemAside '+(options.asideTextClass||"")+' secondaryText">')+item.asideText+"</div>"),item.asideIcon&&(html=(html+='<div class="listItemAside listItemAsideContainer '+(options.asideIconClass||"")+' secondaryText"><i class="listItemAsideIcon md-icon autortl">')+item.asideIcon+"</i></div>"),options.clickEntireItem)options.itemAccessSelection&&(html+='<div style="padding-inline-end:.5em;">',"Write"===item.UserItemShareLevel?html+=_globalize.default.translate("Edit"):"Read"===item.UserItemShareLevel?html+=_globalize.default.translate("View"):html+=_globalize.default.translate("None"),html=(html+="</div>")+getItemAccessSelectContainer(item,!0));else{if(options.allowButtonCommands){if(options.contextMenu&&options.moreButton&&itemController.supportsContextMenu(item)&&(imageAction="listItemContextMenuButton",options.hideMoreButtonOnTouch&&(imageAction+=" listItemContextMenuButton-autohide"),html+='<button title="'+_globalize.default.translate("More")+'" aria-label="'+_globalize.default.translate("More")+'" type="button" is="paper-icon-button-light" class="listItemButton '+imageAction+' itemAction md-icon" data-action="menu">&#xe5D3;</button>'),options.overviewButton&&item.Overview&&(html+='<button title="'+_globalize.default.translate("Overview")+'" aria-label="'+_globalize.default.translate("Overview")+'" type="button" is="paper-icon-button-light" class="listItemButton itemAction md-icon" data-action="overview">&#xe88F;</button>'),options.enableUserDataButtons&&(color=item.UserData||{},itemController.canMarkPlayed(item)&&(html+=_embyPlaystatebutton.default.getHtml(color.Played,"listViewUserDataButton listItemButton paper-icon-button-light itemAction")),itemController.canRate(item))&&(html+=_embyRatingbutton.default.getHtml(color.IsFavorite,"listViewUserDataButton listItemButton paper-icon-button-light itemAction")),null!=(downloadWidth=options.buttonCommands)&&downloadWidth.length)for(var commands=itemController.getCommands({items:[item],user:null==apiClient?void 0:apiClient.getCurrentUserCached()}),_i=0,_length=(commands=commands.filter(function(c){return options.buttonCommands.includes(c.id)})).length;_i<_length;_i++){var cmd=commands[_i];html+='<button title="'+cmd.name+'" aria-label="'+cmd.name+'" type="button" is="paper-icon-button-light" class="listItemButton itemAction md-icon'+getMdIconClass(cmd.icon)+'" data-action="'+cmd.id+'">'+cmd.icon+"</button>"}options.dragReorder&&!1!==item.CanReorder&&(html+='<i class="'+options.dragHandleClass+'">&#xe25D;</i>')}options.itemAccessSelection&&(html+=getItemAccessSelectContainer(item))}return options.enableBottomOverview&&(html=(html=html+'</div><div class="'+options.bottomOverviewClassName+'">')+(item.Overview?_dom.default.stripScripts(item.Overview):"")+"</div>"),html+="</div>",options.listItemParts?(playOnImageClick=_shortcuts.default.getShortcutAttributes(item,options),action&&playOnImageClick.push({name:"data-action",value:action}),options.isVirtualList||playOnImageClick.push({name:"data-index",value:index}),{attributes:playOnImageClick,html:html}):(hoverPlayButtonRequested=_shortcuts.default.getShortcutAttributesHtml(item,options),action&&(hoverPlayButtonRequested+=' data-action="'+action+'"'),options.isVirtualList||(hoverPlayButtonRequested+=' data-index="'+index+'"'),(styleRules=options.fixedAttributes)&&(hoverPlayButtonRequested+=" "+styleRules),enableHoverPlayButton=options.className,item.ItemClass&&(enableHoverPlayButton+=" "+item.ItemClass),"<"+tagName+' class="'+enableHoverPlayButton+'"'+hoverPlayButtonRequested+">"+html+"</"+tagName+">")}function getItemAccessSelectContainer(item,hide){var html="",html=(html+='<div class="selectContainer selectContainer-inline'+(hide?" hide":"")+'">')+'<select data-hidelabeltext="true" is="emby-select" class="emby-select-inline selectItemShareLevel" label="'+_globalize.default.translate("Access")+'" title="'+_globalize.default.translate("Access")+'">';return item.itemAccessItem.CanMakePublic&&(html+='<option value="None">'+_globalize.default.translate("None")+"</option>"),html=(html=(html+='<option value="Read"'+("Read"===item.UserItemShareLevel?" selected":"")+">"+_globalize.default.translate("View")+"</option>")+('<option value="Write"'+("Write"===item.UserItemShareLevel?" selected":"")+">"+_globalize.default.translate("Edit")+"</option>"))+"</select>"+"</div>"}function setListOptions(items,options){null==options.iconSpacing&&(options.preferIcon||options.code||!1!==options.image&&options.roundImage)&&(options.iconSpacing=!0),null==options.isBoundListItem&&(options.isBoundListItem=!0),options.itemSelector=".listItem",options.enableDefaultIcon=!1!==options.enableDefaultIcon;for(var contentWrapperClass=((options.contentWrapperClass||"")+" listItem-content").trim(),fieldMap=(options.contentWrapperClass=contentWrapperClass,options.containerAlbumArtistIds=(options.containerAlbumArtists||[]).map(getId),options.contextMenu=!1!==options.contextMenu,options.enableUserDataButtons=!1!==options.enableUserDataButtons,options.moreButton=options.contextMenu&&!1!==options.moreButton,options.fields||(options.fields=[],options.fields.push("Name")),options.fields=Array.from(new Set(options.fields)),options.autoMoveParentName&&(options.fieldsParentNameAfter=options.fields.slice(0),contentWrapperClass=options.fieldsParentNameAfter.indexOf("ParentName"),nameIndex=options.fieldsParentNameAfter.indexOf("Name"),-1!==contentWrapperClass&&-1!==nameIndex&&contentWrapperClass<nameIndex&&(options.fieldsParentNameAfter.splice(contentWrapperClass,1),options.fieldsParentNameAfter.splice(nameIndex,0,"ParentName")),-1!==contentWrapperClass)&&-1!==nameIndex&&nameIndex<contentWrapperClass&&(options.fields.splice(contentWrapperClass,1),options.fields.splice(Math.max(nameIndex-1,0),0,"ParentName")),{}),i=0,length=options.fields.length;i<length;i++)fieldMap[options.fields[i]]=!0;options.fieldMap=fieldMap,options.mediaInfo=!1!==options.mediaInfo,options.preferIcon?options.shape="square":options.shape=_imagehelper.default.getShape(items,options)||"square","banner"===options.shape&&(options.shape="backdrop"),"large"===options.imageSize?(options.contentWrapperClass+=" listItem-content-fb",options.imageDownloadWidth=400,options.enableSideMediaInfo=!(isLargeStyle=!0),options.iconSpacing||!1===options.itemMarginY||(options.contentWrapperClass+=" listItem-content-marginx3")):"medium"===options.imageSize?(options.contentWrapperClass+=" listItem-content-fb",options.imageDownloadWidth=200,options.enableSideMediaInfo=!1,options.iconSpacing||!1===options.itemMarginY||(options.contentWrapperClass+=" listItem-content-marginx2")):(options.iconSpacing||!1===options.itemMarginY||("small"===options.imageSize?options.contentWrapperClass+=" listItem-content-marginx2":options.contentWrapperClass+=" listItem-content-margin"),options.contentWrapperClass+=" listItem-content-bg",options.itemBackground&&(options.contentWrapperClass+=" listItem-content-bg-background"),options.imageDownloadWidth=80,options.enableSideMediaInfo=null!=options.enableSideMediaInfo?options.enableSideMediaInfo:"square"===options.shape),_layoutmanager.default.tv?(options.draggable=!1,options.dragReorder=!1,options.draggableXActions=!1,options.anyDraggable=!1):(options.draggable=!1!==options.draggable,options.draggableXActions=!1!==options.draggableXActions&&!0!==options.verticalWrap,options.anyDraggable=options.draggable||options.draggableXActions),options.allowButtonCommands=!_layoutmanager.default.tv,options.clickEntireItem=_layoutmanager.default.tv?!fieldMap.ItemCheckbox:!(options.mediaInfo||options.moreButton||options.enableUserDataButtons||options.itemAccessSelection||options.enableSideMediaInfo||options.imagePlayButton||fieldMap.ItemCheckbox||options.treeButton||options.draggableXActions||null!=(contentWrapperClass=options.buttonCommands)&&contentWrapperClass.length),_layoutmanager.default.tv&&(options.imageDownloadWidth*=1.5),options.isLargeStyle=isLargeStyle,options.action=options.action||"link",options.playAction||(options.playAction="playallfromhere"===options.action?"playallfromhere":"play"),options.tagName=options.clickEntireItem?"button":"div",options.listItemBodyTagName="div",options.multiSelectTitle=_globalize.default.translate("MultiSelect"),options.multiSelect=!1!==options.multiSelect&&!_layoutmanager.default.tv,!options.multiSelect&&!fieldMap.ItemCheckbox||embyCheckboxLoaded||(embyCheckboxLoaded=!0,Emby.importModule("./modules/emby-elements/emby-checkbox/emby-checkbox.js")),options.enableUserData=!1!==options.enableUserData,options.largeFont=!_layoutmanager.default.tv&&!1!==options.largeFont,options.listItemBodyTextTagName="large"===options.imageSize||options.largeHeading?"h3":"div";for(var nameIndex=("listItemBodyText "+(options.listItemBodyTextClass||"")).trim(),items=((options.isVirtualList||options.noTextWrap)&&(nameIndex+=" listItemBodyText-nowrap"),options.largeFont&&(nameIndex+=" listItemBodyText-lf"),options.listItemBodyTextClass=nameIndex,options.indicatorClass=isLargeStyle?"listItemIndicator listItem":"listItemIndicator listItemIndicator-mini listItem",options.listItemBodyTextSecondaryClass="listItemBodyText-secondary "+secondaryTextClass,"large"!==options.imageSize&&"medium"!==options.imageSize||(options.listItemBodyTextSecondaryClass+=" listItemBodyText-secondary-of"),"listItem"),contentWrapperClass=(_layoutmanager.default.tv||(options.contentWrapperClass+=" listItemContent-touchzoom",_browser.default.iOS)||_browser.default.osx||(items+=" listItem-autoactive"),options.verticalWrap&&(items+="  listItem-vertical-wrap"),!1!==options.image),nameIndex=((options.border||!1!==options.highlight&&(!_layoutmanager.default.tv||options.forceBorder))&&(options.contentWrapperClass+=" listItem-border",contentWrapperClass&&!1!==options.allowBorderXOffset&&(options.contentWrapperClass+=" listItem-border-offset"),options.autoHideBorderOnTouch)&&(options.contentWrapperClass+=" listItem-border-autohide"),(options.clickEntireItem||options.action&&"none"!==options.action)&&(items+=" itemAction"),"div"===options.tagName?options.addTabIndex=!0:"button"===options.tagName&&(items+=" listItem-button"),"none"===options.action&&!options.clickEntireItem||(items+=" listItemCursor"),options.enableFocusScaling=_layoutmanager.default.tv&&!1!==options.enableFocusScaling&&enableFocusTransfrom,_layoutmanager.default.tv?(options.enableFocusScaling&&(items+=" listItem-focusscale"),options.expandOutOnFocus&&(items+=" listItem-expandout"),items+=" listItem-tv"):items+=" listItem-hoverable",isLargeStyle&&(items+=" listItem-largeImage"),!1===options.verticalPadding&&(items+=" listItem-noverticalpadding"),options.itemClass&&(items+=" "+options.itemClass),options.contextMenu&&options.clickEntireItem&&(items+=" longpress"),options.dragReorder&&options.draggable?items+=" drop-target ordered-drop-target-y":options.dropTarget&&!_layoutmanager.default.tv&&(items+=" drop-target full-drop-target"),options.draggableXActions&&(items+=" draggable-x",options.draggable)&&(items+=" draggable-xy"),options.dragHandleClass=("listViewDragHandle dragHandle md-icon listItemIcon listItemIcon-transparent "+(options.dragHandleClass||"")).trim(),options.className=items,""),isLargeStyle=(options.shape&&!1!==options.allowBorderXOffset&&(options.contentWrapperClass+=" listItem-border-offset-"+options.shape,options.imageSize)&&(options.contentWrapperClass+=" listItem-border-offset-"+options.imageSize,options.contentWrapperClass+=" listItem-border-offset-"+options.shape+"-"+options.imageSize),!1!==options.image?(options.aspectInfo=_imagehelper.default.getAspectFromShape(options.shape,options),fieldMap.Overview&&"portrait"!==options.shape&&(options.enableBottomOverview=!1!==options.enableBottomOverview)):fieldMap.Overview&&(options.enableBottomOverview=!1!==options.enableBottomOverview),_layoutmanager.default.tv&&(options.enableBottomOverview=!1),options.enableBottomOverview&&(options.contentWrapperClass+=" listItem-content-withwrap"),nameIndex+='<div class="'+options.contentWrapperClass+'">',options.enableBottomOverview&&(nameIndex+='<div class="listItem-innerwrapper">'),fieldMap.ItemCheckbox&&(isLargeStyle="listItem-checkboxLabel",options.roundCheckbox&&(isLargeStyle+=" listItem-checkboxLabel-round"),options.itemCheckbox='<label data-action="toggleitemchecked" class="itemAction listItem-emby-checkbox-label emby-checkbox-label secondaryText"><input tabindex="-1" class="chkItemCheckbox emby-checkbox emby-checkbox-notext" is="emby-checkbox" type="checkbox" /><span class="checkboxLabel '+isLargeStyle+'"></span></label>',nameIndex+=options.itemCheckbox),options.treeButton&&(options.disabledTreeButtonHtml='<button disabled style="visibility:hidden;" is="paper-icon-button-light" type="button" data-action="toggletreenode" class="secondaryText itemAction md-icon autortl paper-icon-button-light '+(options.treeButtonClass||"")+'">&#xe5cc;</button>',options.treeButtonHtml='<button is="paper-icon-button-light" type="button" data-action="toggletreenode" class="secondaryText itemAction md-icon autortl paper-icon-button-light '+(options.treeButtonClass||"")+'">&#xe5cc;</button>',nameIndex+=options.treeButtonHtml),!1!==options.image&&(items=((options.imageContainerClass||"")+" listItemImageContainer").trim(),options.imageSize&&(items+=" listItemImageContainer-"+options.imageSize,_layoutmanager.default.tv)&&(items+=" listItemImageContainer-"+options.imageSize+"-tv"),options.clickEntireItem||(items+=" itemAction"),options.iconSpacing&&(items+=" listItemImageContainer-margin"),items+=" listItemImageContainer-"+options.shape,nameIndex+='<div class="'+(options.imageContainerClass=items)+'"></div>'),((options.listItemBodyClassName||"")+" listItemBody").trim()),textlines=(options.clickEntireItem||(isLargeStyle+=" itemAction"),contentWrapperClass||(isLargeStyle+=" listItemBody-noleftpadding"),!1===options.verticalPadding&&(isLargeStyle+=" listItemBody-noverticalpadding"),options.code&&(isLargeStyle+=" listItemBody-code"),options.dragReorder&&(isLargeStyle+=" listItemBody-draghandle"),options.iconSpacing||(isLargeStyle+=" listItemBody-reduceypadding"),options.iconClass?options.iconClass+=" listItemIcon md-icon autortl":options.iconClass="listItemIcon md-icon autortl",[]),_i2=0,_length2=options.fields.length;_i2<_length2;_i2++)switch(options.fields[_i2]){case"ItemCheckbox":case"ProductionYear":break;default:textlines.push("&nbsp;")}fieldMap.Overview&&(options.isLargeStyle?options.overviewLines=options.overviewLines||3:options.overviewLines=options.overviewLines||2,options.overviewClass="listItem-overview-"+options.overviewLines+"-lines");items=textlines.length,fieldMap.Overview&&(items+=options.overviewLines-1),options.mediaInfo&&!options.enableSideMediaInfo&&items++,options.listItemBodyClassName=isLargeStyle+=" listItemBody-"+items+"-lines",nameIndex=(nameIndex+="<"+options.listItemBodyTagName+' class="'+options.listItemBodyClassName+'">')+getTextLinesHtml(textlines,options),fieldMap.Overview&&(options.mediaInfo&&!options.enableSideMediaInfo&&(nameIndex+='<div class="listItemMediaInfo listItemBodyText '+options.listItemBodyTextSecondaryClass+' listItemBodyText-nowrap"></div>'),options.topOverviewClassName="listItem-overview listItem-topoverview listItemBodyText "+options.listItemBodyTextSecondaryClass,options.enableBottomOverview&&(options.topOverviewClassName+=" listItem-overview-autohide"),options.topOverviewClassName+=" "+options.overviewClass,nameIndex+='<div class="'+options.topOverviewClassName+'"></div>'),nameIndex+="</"+options.listItemBodyTagName+">",options.dragReorder&&(nameIndex+='<i class="'+options.dragHandleClass+'" style="visibility:hidden;">&#xe25D;</i>'),options.enableBottomOverview&&(nameIndex+="</div>",options.bottomOverviewClassName="listItem-bottomoverview secondaryText",options.bottomOverviewClassName+=" "+options.overviewClass,nameIndex+='<div class="'+options.bottomOverviewClassName+'">&nbsp;</div>'),nameIndex+="</div>",contentWrapperClass="";options.addTabIndex&&(contentWrapperClass+=' tabindex="0"'),options.anyDraggable&&(contentWrapperClass+=' draggable="true"'),"button"===options.tagName&&(contentWrapperClass+=' type="button"'),options.clickEntireItem,options.fixedAttributes=contentWrapperClass.trim(),options.templateInnerHTML=nameIndex}function getItemsHtml(items,options){setListOptions(items,options);for(var groupTitle="",html="",i=0,length=items.length;i<length;i++){var itemGroupTitle,item=items[i];options.showIndex&&(itemGroupTitle=function(item,options){return"disc"!==options.index||null==(options=item.ParentIndexNumber)?"":_globalize.default.translate("ValueDiscNumber",options)}(item,options))!==groupTitle&&(html=(html+=0===i?'<h2 class="listGroupHeader listGroupHeader-first">':'<h2 class="listGroupHeader">')+itemGroupTitle+"</h2>",groupTitle=itemGroupTitle),html+=getListItemHtml(item,i,options)}return html}_exports.default={getItemsHtml:getItemsHtml,setListOptions:setListOptions,getItemParts:function(item,index,options){return options.listItemParts=!0,getListItemHtml(item,index,options)},buildItems:function(items,options){var itemsContainer=options.itemsContainer;if(document.body.contains(itemsContainer)){var parentContainer=options.parentContainer;if(parentContainer){if(!items.length)return void parentContainer.classList.add("hide");parentContainer.classList.remove("hide")}parentContainer=getItemsHtml(items,options);itemsContainer.innerHTML=parentContainer,itemsContainer.items=items,options.multiSelect&&(itemsContainer.enableMultiSelect?itemsContainer.enableMultiSelect(!0):itemsContainer.setAttribute("data-multiselect","true")),options.contextMenu&&(itemsContainer.enableContextMenu?itemsContainer.enableContextMenu(!0):itemsContainer.setAttribute("data-contextmenu","true")),parentContainer&&_lazyimageloader.default.lazyChildren(itemsContainer),options.autoFocus&&_focusmanager.default.autoFocus(itemsContainer)}},virtualChunkSize:30,setListClasses:function(elem){(elem=elem.classList).remove("vertical-wrap"),elem.add("vertical-list")}}});