define(["exports","./../modules/dialoghelper/dialoghelper.js","./../modules/layoutmanager.js","./../modules/common/globalize.js","./../modules/loading/loading.js","./../modules/genericedit/genericedit.js","./../modules/common/responsehelper.js","./../modules/emby-apiclient/connectionmanager.js","./../modules/emby-elements/emby-input/emby-input.js","./../modules/emby-elements/emby-button/emby-button.js","./../modules/emby-elements/emby-checkbox/emby-checkbox.js","./../modules/emby-elements/emby-select/emby-select.js","./../modules/emby-elements/emby-scroller/emby-scroller.js","./../modules/emby-elements/emby-dialogclosebutton/emby-dialogclosebutton.js"],function(_exports,_dialoghelper,_layoutmanager,_globalize,_loading,_genericedit,_responsehelper,_connectionmanager,_embyInput,_embyButton,_embyCheckbox,_embySelect,_embyScroller,_embyDialogclosebutton){function showEditorInternal(apiClient,codec,editObjectContainer,template){var dialogOptions={removeOnClose:!!1,scrollY:!0},dlg=(editObjectContainer&&(_layoutmanager.default.tv?dialogOptions.size="fullscreen":dialogOptions.size="small"),_dialoghelper.default.createDialog(dialogOptions)),dialogOptions=(dlg.classList.add("formDialog"),dlg.classList.add("codecEditorDialog"),dlg.innerHTML=_globalize.default.translateDocument(template,"sharedcomponents"),dlg.querySelector(".btnSave")),template=dlg.querySelector(".btnReset"),editContainer=dlg.querySelector(".codecConfig");return dlg.querySelector(".formDialogHeaderTitle").innerHTML=codec.IsHardwareCodec?codec.Name:codec.MediaTypeName,editObjectContainer?(dlg.querySelector(".formDialogFooter").classList.remove("hide"),dlg.querySelector(".warningBanner").classList.remove("hide"),editObjectContainer.EditorRoot.DisplayName=null,dialogOptions.classList.remove("hide"),template.classList.remove("hide"),_genericedit.default.renderForm(editObjectContainer,editContainer).then(function(){_genericedit.default.setFormValues(editObjectContainer,editContainer)}),template.addEventListener("click",function(){for(var editors=editObjectContainer.EditorRoot.EditorItems,n=0;n<editors.length;n++){var editor=editors[n],defval=function(sourceObject,propertyPath){for(var subObject=sourceObject,pathElements=propertyPath.split("."),i=0;i<pathElements.length;i++){var pathElement=pathElements[i].replace("colitem","");if(!Object.hasOwn(subObject,pathElement))return null;subObject=subObject[pathElement]}return subObject}(editObjectContainer.DefaultObject,editor.Id);!function(sourceObject,propertyPath,value){for(var subObject=sourceObject,pathElements=propertyPath.split("."),i=0;i<pathElements.length-1;i++){var pathElement=pathElements[i].replace("colitem","");if(!Object.hasOwn(subObject,pathElement))return;subObject=subObject[pathElement]}subObject[pathElements[pathElements.length-1]]=value}(editObjectContainer.Object,editor.Id,defval)}_genericedit.default.setFormValues(editObjectContainer,editContainer)})):(dialogOptions=function(codec){var infoSections=[];return infoSections.push(codec.Description),infoSections.push(function(codec){var rows=[];codec.MaxBitRate&&rows.push(createRowV(["Max Bitrate: ",codec.MaxBitRate]));var frameSize=[];codec.MinWidth&&codec.MinHeight&&frameSize.push(codec.MinWidth+"x"+codec.MinHeight);codec.MaxWidth&&codec.MaxHeight&&(0===frameSize.length&&frameSize.push("max "),frameSize.push(codec.MaxWidth+"x"+codec.MaxHeight));0<frameSize.length&&rows.push(createRowV(["Frame Sizes: ",frameSize.join("...")]));frameSize=[];codec.MinFrameRate&&frameSize.push(codec.MinFrameRate+"fps");codec.MaxFrameRate&&(0===frameSize.length&&frameSize.push("max "),frameSize.push(codec.MaxFrameRate+"fps"));0<frameSize.length&&rows.push(createRowV(["Frame Rates: ",frameSize.join("...")]));codec.MaxInstanceCount&&rows.push(createRowV(["Max Instances: ",codec.MaxInstanceCount]));codec.SupportedColorFormatStrings&&rows.push(createRowV(["Color Formats: ",codec.SupportedColorFormatStrings.join(", ")]));return'<table style="border-spacing:1em .5em;">'+rows.join("\n")+"</table>"}(codec)),infoSections.push(function(codec){if(!codec.ProfileAndLevelInformation||0===codec.ProfileAndLevelInformation.length)return"";var items=codec.ProfileAndLevelInformation,rows=[],codec=function(cellData){return'<tr><th class="text-align-start" style="padding: 0; white-space: nowrap;">'+cellData.join('</th><th class="text-align-start" style="padding: 0; white-space: nowrap;">')+"</th></tr>"}(["Profile","Max Level","Max Bitrate","Bit Depths","Resolutions"]);rows.push(codec);for(var i=0;i<items.length;i++){var profile=items[i].Profile,desc=profile.Description||"",profile=(desc=desc.replace(" Profile",""),profile.BitDepths||[]),level=items[i].Level,resrates="",desc=(level.ResolutionRateStrings&&0<level.ResolutionRateStrings.length&&(resrates=level.ResolutionRateStrings[0],1<level.ResolutionRateStrings.length)&&(resrates+="&nbsp;-&nbsp;"+level.ResolutionRateStrings[level.ResolutionRateStrings.length-1]),createRow([desc,level.Description,level.MaxBitRateDisplay,profile.join(",&nbsp;"),resrates]));rows.push(desc)}return'<table style="border-spacing:.5em;">'+rows.join("\n")+"</table>"}(codec)),infoSections.map(wrapInfoSection).join("")}(codec),dlg.querySelector(".codecInfo").innerHTML=dialogOptions),_loading.default.hide(),dlg.querySelector("form").addEventListener("submit",function(e){_genericedit.default.getItemValues(editObjectContainer,editContainer);var url=apiClient.getUrl("Encoding/CodecParameters",{CodecId:codec.Id,ParameterContext:"Playback"});return apiClient.ajax({type:"POST",url:url,data:JSON.stringify(editObjectContainer.Object),contentType:"application/json"}).then(function(result){_dialoghelper.default.close(dlg),_responsehelper.default.handleConfigurationSavedResponse(result)},_responsehelper.default.handleErrorResponse),e.preventDefault(),!1}),new Promise(function(resolve,reject){dlg.addEventListener("close",function(){reject()}),_dialoghelper.default.open(dlg)})}function wrapInfoSection(info){return info&&0<info.length?'<div class="" style="margin-bottom:0.4em;">'+info+"</div>":""}function createRowV(cellData){return cellData[0]='<span style="white-space: nowrap; font-weight: bold;">'+cellData[0]+"</span>",createRow(cellData)}function createRow(cellData){return"<tr>"+('<td style="padding: 0; vertical-align: top;">'+cellData.join('</td><td style="padding: 0; vertical-align: top;">')+"</td>")+"</tr>"}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;_exports.default={show:function(codec,editParams){return _loading.default.show(),new Promise(function(resolve,reject){require(["text!transcoding/codeceditor.html"],function(template){template=_globalize.default.translateHtml(template);var url,apiClient=_connectionmanager.default.currentApiClient();codec.SupportsParameters&&editParams?(url=apiClient.getUrl("Encoding/CodecParameters",{CodecId:codec.Id,ParameterContext:"Playback"}),apiClient.getJSON(url).then(function(editObjectContainer){showEditorInternal(apiClient,codec,editObjectContainer,template).then(resolve,reject)})):showEditorInternal(apiClient,codec,null,template).then(resolve,reject)})})}}});