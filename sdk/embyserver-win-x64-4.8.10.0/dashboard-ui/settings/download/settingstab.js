define(["exports","./../../modules/tabbedview/basesettingstab.js","./../../modules/common/globalize.js","./../../modules/emby-elements/emby-scroller/emby-scroller.js","./../../modules/emby-elements/emby-select/emby-select.js","./../../modules/emby-elements/emby-button/emby-button.js","./../../modules/emby-elements/emby-button/paper-icon-button-light.js","./../../modules/emby-elements/emby-input/emby-input.js","./../../modules/emby-elements/emby-checkbox/emby-checkbox.js","./../../modules/common/appsettings.js","./../../modules/emby-apiclient/events.js","./../../modules/common/servicelocator.js","./../../modules/common/textencoding.js"],function(_exports,_basesettingstab,_globalize,_embyScroller,_embySelect,_embyButton,_paperIconButtonLight,_embyInput,_embyCheckbox,_appsettings,_events,_servicelocator,_textencoding){function filliOSLocation(view){var html='<option value="">'+_globalize.default.translate("InternalStorage")+"</option>",syncPathValue="%externalstorage%",syncPathName="",syncPath=_appsettings.default.syncPath(),syncPathValue=(syncPath&&syncPath.length?(syncPathName=" ("+(syncPathValue=syncPath).split("/").pop()+")",view.querySelector(".btnSelectPickerSyncPath").classList.remove("hide")):view.querySelector(".btnSelectPickerSyncPath").classList.add("hide"),html+='<option value="'+syncPathValue+'">Custom'+_textencoding.default.htmlEncode(syncPathName)+"</option>",view.querySelector(".selectSyncLocation"));syncPathValue.innerHTML=html,syncPathValue.value=syncPath||""}function onAndroidSyncLocationChange(e){e=e.target.closest("form").querySelector(".selectSyncLocation").value;_appsettings.default.syncPath(e),AndroidAppSettings.setSyncPath(e),MainActivity.authorizeStorage()}function oniOSSyncLocationChange(e){var e=e.target.closest("form"),path=e.querySelector(".selectSyncLocation").value,path=("%externalstorage%"===path?selectDownloadPathiOS.call(this):_appsettings.default.syncPath(path),_appsettings.default.syncPath());path&&path.length?e.querySelector(".btnSelectPickerSyncPath").classList.remove("hide"):e.querySelector(".btnSelectPickerSyncPath").classList.add("hide")}function loadForm(view){view.querySelector(".txtSyncPath").value=_appsettings.default.syncPath()||"",window.AndroidAppSettings?function(view){for(var html='<option value="">'+_globalize.default.translate("InternalStorage")+"</option>",dirs=AndroidAppHost.getWritableExternalStorageDirs(),size=dirs.size(),i=0;i<size;i++){var dir=dirs.get(i),name=dir.getName(),dir=dir.getUuid();html+='<option value="'+(dir?dir:"%externalstorage%")+'">'+_globalize.default.translate("ExternalStorage")+" ("+_textencoding.default.htmlEncode(name)+")</option>"}(view=view.querySelector(".selectSyncLocation")).innerHTML=html,view.value=_appsettings.default.syncPath()||""}(view):window.webkit.messageHandlers&&filliOSLocation(view)}function selectDownloadPathiOS(){var selectContainer=this.closest(".selectContainer");window.webkit.messageHandlers.selectSyncLocation.postMessage({}).then(function(result){result?(_appsettings.default.syncPath(result.Path||""),console.log("Picked folder: "+result),filliOSLocation(selectContainer)):_appsettings.default.syncPath("")},function(){console.log("Operation cancelled."),filliOSLocation(selectContainer)})}function selectDownloadPathWindows(){var inputContainer=this.closest(".inputContainer"),folderPicker=new Windows.Storage.Pickers.FolderPicker;folderPicker.suggestedStartLocation=Windows.Storage.Pickers.PickerLocationId.desktop,folderPicker.fileTypeFilter.replaceAll(["*"]),folderPicker.pickSingleFolderAsync().then(function(folder){folder?(Windows.Storage.AccessCache.StorageApplicationPermissions.futureAccessList.addOrReplace("PickedFolderToken",folder),inputContainer.querySelector(".txtSyncPath").value=folder.path,_appsettings.default.syncPath(folder.path),console.log("Picked folder: "+folder.path)):console.log("Operation cancelled.")})}function View(view,params){_basesettingstab.default.apply(this,arguments)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,Object.assign(View.prototype,_basesettingstab.default.prototype),View.prototype.onTemplateLoaded=function(){_basesettingstab.default.prototype.onTemplateLoaded.apply(this,arguments);var view=this.view;this.progressContainer=view.querySelector(".progressContainer"),this.itemProgressBarForeground=view.querySelector(".itemProgressBarForeground"),this.progressDescription=view.querySelector(".progressDescription"),window.AndroidAppSettings?(view.querySelector(".fldSyncLocation").classList.remove("hide"),view.querySelector(".selectSyncLocation").addEventListener("change",onAndroidSyncLocationChange)):window.webkit.messageHandlers?(view.querySelector(".fldSyncLocation").classList.remove("hide"),view.querySelector(".selectSyncLocation").addEventListener("change",oniOSSyncLocationChange),view.querySelector(".btnSelectPickerSyncPath").addEventListener("click",selectDownloadPathiOS)):view.querySelector(".fldSyncLocation").classList.add("hide"),window.Windows?(view.querySelector(".fldCustomSyncPath").classList.remove("hide"),view.querySelector(".btnSelectSyncPath").addEventListener("click",selectDownloadPathWindows)):view.querySelector(".fldCustomSyncPath").classList.add("hide"),view.querySelector("form").addEventListener("submit",function(e){return e.preventDefault(),!1}),this.boundOnDownloadProgress=function(e,progressInfo){var numItems=progressInfo.numItems||0,numItemsComplete=progressInfo.numItemsComplete||0,progressInfo=progressInfo.totalPercentComplete||0;this.itemProgressBarForeground.style.width=progressInfo+"%",this.progressDescription.innerHTML=_globalize.default.translate("DownloadNumItems",numItemsComplete+1,numItems),numItems&&progressInfo<100?this.progressContainer.classList.remove("hide"):this.progressContainer.classList.add("hide")}.bind(this)},View.prototype.loadTemplate=function(){return require(["text!settings/download/settingstab.html"])},View.prototype.onResume=function(options){_basesettingstab.default.prototype.onResume.apply(this,arguments),_events.default.on(_servicelocator.localSync,"progress",this.boundOnDownloadProgress),_servicelocator.localSync.setProgressUpdatesEnabled(!0)},View.prototype.loadSettingsInternal=function(){_servicelocator.localSync.sync();return loadForm(this.view),this.loadAutoSettings()},View.prototype.onPause=function(){this.boundOnDownloadProgress&&_events.default.off(_servicelocator.localSync,"progress",this.boundOnDownloadProgress),_servicelocator.localSync.setProgressUpdatesEnabled(!1),_basesettingstab.default.prototype.onPause.apply(this,arguments)},View.prototype.destroy=function(){_basesettingstab.default.prototype.destroy.apply(this,arguments),this.boundOnDownloadProgress&&(_events.default.off(_servicelocator.localSync,"progress",this.boundOnDownloadProgress),this.boundOnDownloadProgress=null),this.progressContainer=null,this.itemProgressBarForeground=null,this.progressDescription=null};_exports.default=View});