define(["exports","./../modules/viewmanager/basesettingsview.js","./../modules/loading/loading.js","./../modules/common/globalize.js","./../modules/emby-elements/emby-input/emby-input.js","./../modules/emby-elements/emby-button/emby-button.js","./../modules/emby-elements/emby-checkbox/emby-checkbox.js","./../modules/emby-elements/emby-select/emby-select.js","./../modules/emby-elements/emby-scroller/emby-scroller.js","./../modules/emby-elements/emby-slider/emby-slider.js","./../modules/emby-elements/emby-premierecontainer/emby-premierecontainer.js","./../modules/common/usersettings/usersettings.js","./../modules/common/usersettings/usersettingsbuilder.js","./../modules/emby-apiclient/connectionmanager.js","./../modules/common/pluginmanager.js","./../modules/skinmanager.js","./../modules/common/servicelocator.js","./../modules/layoutmanager.js","./../modules/emby-apiclient/events.js"],function(_exports,_basesettingsview,_loading,_globalize,_embyInput,_embyButton,_embyCheckbox,_embySelect,_embyScroller,_embySlider,_embyPremierecontainer,_usersettings,_usersettingsbuilder,_connectionmanager,_pluginmanager,_skinmanager,_servicelocator,_layoutmanager,_events){function fillThemes(select,isSettings){for(var mainThemeValue,themes=_skinmanager.default.getThemes(),defaultFound=!1,i=0,length=themes.length;i<length;i++){var theme=themes[i],value=theme.id;(theme.isDefault&&!isSettings||theme.isSettingsDefault&&isSettings)&&(defaultFound=!(value="")),theme.value=value}isSettings&&(mainThemeValue=isSettings&&!defaultFound?"":"maintheme",themes.unshift({name:_globalize.default.translate("SameAsMainTheme"),id:"maintheme",value:mainThemeValue,isSettingsDefault:_servicelocator.appHost.supports("multiserver")})),select.innerHTML=themes.map(function(t){return'<option value="'+t.value+'">'+t.name+"</option>"}).join("")}function showHideThemeSettingsButton(btnThemeSettings){var controller=_skinmanager.default.getCurrentThemeController();null!=controller&&controller.hasSettings&&controller.hasSettings()?btnThemeSettings.classList.remove("hide"):btnThemeSettings.classList.add("hide")}function showThemeSettings(){var controller=_skinmanager.default.getCurrentThemeController();null!=controller&&controller.hasSettings&&controller.hasSettings()&&controller.showSettings()}function normalizeCardSize(cardSize){switch(cardSize){case"normal":case"default":return"";default:return cardSize}}function setPremiereText(elem,key){_servicelocator.appHost.supports("externallinks")&&_servicelocator.appHost.supports("externalpremium")?elem.innerHTML=_globalize.default.translate(key,'<a is="emby-linkbutton" href="https://emby.media/premiere" data-preset="premiereinfo" target="_blank" class="button-link">',"</a>"):elem.innerHTML=_globalize.default.translate(key,"","")}function View(view,params){_basesettingsview.default.apply(this,arguments);for(var apiClient=_connectionmanager.default.getApiClient(params.serverId),userId=params.userId||apiClient.getCurrentUserId(),userSettings=userId===apiClient.getCurrentUserId()?_usersettings.default:new _usersettingsbuilder.default,apiClient={serverId:apiClient.serverId(),userId:userId,element:view.querySelector(".settingsContainer"),userSettings:userSettings},featurePremiereInfo=((this.settingsOptions=apiClient).element.querySelector(".selectLayout").addEventListener("change",function(e){e=e.target.closest(".settingsContainer").querySelector(".selectCardSize"),this.setFieldValue(e,normalizeCardSize("normal"),!0)}.bind(this)),apiClient.element.querySelector(".chkThemeSong").addEventListener("change",function(e){var context=e.target.closest(".settingsContainer");_servicelocator.appHost.supports("themesongvolume")&&e.target.checked?context.querySelector(".fldThemeSongVolume").classList.remove("hide"):context.querySelector(".fldThemeSongVolume").classList.add("hide")}.bind(this)),apiClient.element.querySelector("form").addEventListener("submit",function(e){return e.preventDefault(),!1}.bind(this)),apiClient.element.querySelectorAll(".featurePremiereInfo")),i=0,length=featurePremiereInfo.length;i<length;i++)setPremiereText(featurePremiereInfo[i],"FeatureRequiresEmbyPremiere");!function(view){var displayModePremiere=view.querySelector(".displayModePremiere");setPremiereText(displayModePremiere,"PlaybackTvModeRequiresEmbyPremiere"),_servicelocator.iapManager.isUnlockedByDefault("playback").then(function(result){_servicelocator.iapManager.isUnlockedByDefault("playback-tv").then(function(result){displayModePremiere.classList.add("hide")},function(result){displayModePremiere.classList.remove("hide")})},function(result){displayModePremiere.classList.add("hide")})}(view);userId=view.querySelector(".selectTheme"),userSettings=view.querySelector(".selectSettingsTheme"),apiClient=view.querySelector(".btnThemeSettings");apiClient.addEventListener("click",showThemeSettings),fillThemes(userId),fillThemes(userSettings,!0),showHideThemeSettingsButton(apiClient),function(context){var context=context.querySelector(".selectScreensaver"),options=_pluginmanager.default.ofType("screensaver").map(function(plugin){return{name:plugin.name,value:plugin.id}});options.unshift({name:_globalize.default.translate("None"),value:"none"}),context.innerHTML=options.map(function(o){return'<option value="'+o.value+'">'+o.name+"</option>"}).join("")}(view),function(context){var context=context.querySelector(".selectSoundEffects"),options=_pluginmanager.default.ofType("soundeffects").map(function(plugin){return{name:plugin.name,value:plugin.id}});options.unshift({name:_globalize.default.translate("None"),value:"none"}),context.innerHTML=options.map(function(o){return'<option value="'+o.value+'">'+o.name+"</option>"}).join("")}(view),view.querySelector(".selectSlidehowInterval").innerHTML=[5,10,15,20,25,30].map(function(option){return{name:_globalize.default.translate("ValueSeconds",option),value:1e3*option}}).map(function(o){return'<option value="'+o.value+'">'+o.name+"</option>"}).join(""),this.boundonThemeLoaded=function(){showHideThemeSettingsButton(this.view.querySelector(".btnThemeSettings"))}.bind(this),_events.default.on(_skinmanager.default,"themeloaded",this.boundonThemeLoaded)}function revertToNoneIfNeeded(elem,value){return value&&elem.querySelector('option[value="'+value+'"]')?value:"none"}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,Object.assign(View.prototype,_basesettingsview.default.prototype),View.prototype.loadSettingsInternal=function(){var options,userId,apiClient,userSettings,instance=this;return options=instance.settingsOptions,_loading.default.show(),userId=options.userId,apiClient=_connectionmanager.default.getApiClient(options.serverId),userSettings=options.userSettings,apiClient.getUser(userId).then(function(user){return options.user=user,(userId===apiClient.getCurrentUserId()?Promise.resolve():userSettings.setUserInfo(userId,apiClient)).then(function(){_loading.default.hide()})}).then(function(){return instance.loadAutoSettings()})},View.prototype.getAutoSettingsObjectsPromises=function(){var options,list=_basesettingsview.default.prototype.getAutoSettingsObjectsPromises.apply(this,arguments);return list.push((options=this.settingsOptions,Promise.resolve({key:"userconfiguration",value:options.user.Configuration}))),list},View.prototype.getSettingValueFromOwner=function(owner,memberInfo){switch(memberInfo.member){case"getEnableLogoAsTitle":return this.settingsOptions.userSettings.getEnableLogoAsTitle(_globalize.default.getCurrentLocale());case"showDetailPoster":return this.settingsOptions.userSettings.showDetailPoster(_layoutmanager.default.tv);case"cardSize":return normalizeCardSize(_basesettingsview.default.prototype.getSettingValueFromOwner.apply(this,arguments));case"soundEffects":return revertToNoneIfNeeded(this.view.querySelector(".selectSoundEffects"),_basesettingsview.default.prototype.getSettingValueFromOwner.apply(this,arguments));case"screensaver":return revertToNoneIfNeeded(this.view.querySelector(".selectScreensaver"),_basesettingsview.default.prototype.getSettingValueFromOwner.apply(this,arguments));default:return _basesettingsview.default.prototype.getSettingValueFromOwner.apply(this,arguments)}},View.prototype.saveAutoSettingIntoOwner=function(elem,owner,memberInfo,value){if("showDetailPoster"!==memberInfo.member)return _basesettingsview.default.prototype.saveAutoSettingIntoOwner.apply(this,arguments);this.settingsOptions.userSettings.showDetailPoster(_layoutmanager.default.tv,value)},View.prototype.getNamedSettingsOwner=function(owner){switch(owner){case"usersettings":return this.settingsOptions.userSettings;case"userconfiguration":return this.settingsOptions.user.Configuration;default:return _basesettingsview.default.prototype.getNamedSettingsOwner.apply(this,arguments)}},View.prototype.getUserConfigurationUserId=function(){return this.settingsOptions.userId},View.prototype.destroy=function(){_basesettingsview.default.prototype.destroy.apply(this,arguments),this.settingsOptions=null,this.boundonThemeLoaded&&(_events.default.off(_skinmanager.default,"themeloaded",this.boundonThemeLoaded),this.boundonThemeLoaded=null)};_exports.default=View});