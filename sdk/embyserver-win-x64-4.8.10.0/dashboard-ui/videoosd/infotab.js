define(["exports","./basetab.js","./../modules/common/itemmanager/itemmanager.js","./../modules/mediainfo/mediainfo.js","./../modules/cardbuilder/cardbuilder.js","./../modules/dom.js","./../modules/common/playback/playbackmanager.js","./../modules/common/globalize.js","./../modules/layoutmanager.js"],function(_exports,_basetab,_itemmanager,_mediainfo,_cardbuilder,_dom,_playbackmanager,_globalize,_layoutmanager){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;var BackdropFilterSupported=CSS.supports("backdrop-filter","blur(1em)")||CSS.supports("-webkit-backdrop-filter","blur(1em)");function getDetailImageListOptions(items){return{renderer:_cardbuilder.default,options:{overlayText:!0,fields:[],action:"none",multiSelect:!1,ratingButton:!1,playedButton:!1,cardClass:"osdInfoImageCard",cardBoxClass:"osdInfoImageCardBox",cardContentClass:"legacyLazyLoadImmediate",defaultIcon:!0,typeIndicator:!1,playedIndicator:!1,syncIndicator:!1,timerIndicator:!1,randomDefaultBackground:!1,staticElement:!0,progress:!1,hoverPlayButton:!1,moreButton:!1,enableUserData:!1},virtualScrollLayout:"vertical-grid"}}function initDetailImage(instance,view){view=view.querySelector(".videoosd-poster");view.fetchData=function(){var item=this.currentOptions.displayItem,items=[];return item&&(item.SeriesPrimaryImageTag&&(item={Id:item.SeriesId,Name:item.SeriesName,ServerId:item.ServerId,ImageTags:{Primary:item.SeriesPrimaryImageTag},IsFolder:!0,PrimaryImageAspectRatio:2/3}),items.push(item)),Promise.resolve({Items:items,TotalRecordCount:items.length})}.bind(instance),view.getListOptions=getDetailImageListOptions,instance.imageItemsContainer=view}function InfoTab(view){_basetab.default.apply(this,arguments),this.enableSecondaryText=!1,BackdropFilterSupported&&_dom.default.allowBackdropFilter()?BackdropFilterSupported&&(this.enableSecondaryText=!0,view.classList.add("dialog-blur"),view.classList.remove("videoosd-tabBackground")):view.classList.add("videoosd-tabBackground")}function onReadMoreClick(e){var options,e=e.currentTarget.closest(".videoosd-info-overview").querySelector(".osdinfo-overview-text"),item=this.currentOptions.displayItem;options={html:e.innerHTML,confirmButton:!1,title:_itemmanager.default.getDisplayName(item)||item.Name,centerText:!1,item:item},Emby.importModule("./modules/common/dialogs/alert.js").then(function(alert){return alert(options)})}Object.assign(InfoTab.prototype,_basetab.default.prototype),InfoTab.prototype.loadTemplate=function(){var view=this.view,secondaryTextClass=this.enableSecondaryText?" secondaryText":"";return view.innerHTML='<div is="emby-itemscontainer" class="videoosd-poster flex flex-direction-column justify-content-center flex-shrink-zero">\n                    </div>\n                    <div class="videoosd-info flex flex-direction-column justify-content-flex-start flex-grow verticalFieldItems verticalFieldItems-condensed-medium">\n                        <h2 class="videoosd-info-title" style="margin:0;">\n                        </h2>\n                        <div class="videoosd-info-title2 flex flex-direction-row flex-wrap-wrap hide">\n                        </div>\n                        <div class="flex flex-direction-row flex-wrap-wrap'+secondaryTextClass+'">\n                            <div class="videoosd-info-mediainfo mediaInfoItems flex flex-direction-row flex-wrap-wrap">\n                            </div>\n                        </div>\n                        <div class="videoosd-info-mediainfo2'+secondaryTextClass+' mediaInfoItems flex flex-direction-row flex-wrap-wrap">\n                        </div>\n                        <div class="videoosd-info-mediasourceInfo'+secondaryTextClass+' mediaInfoItems flex flex-direction-row flex-wrap-wrap">\n                        </div>\n\n                        <div class="videoosd-info-overview'+secondaryTextClass+' hide flex flex-direction-row align-items-flex-end focuscontainer-x">\n\n                            <button disabled type="button" is="emby-button" data-focusscale="false" class="button-link button-link-color-inherit btnInfoTabOverviewText text-align-start" style="opacity:initial;">\n                                <div class="osdinfo-overview-text"></div>\n                            </button>\n                            <a href="#" is="emby-linkbutton" class="button-link btnInfoTabReadMore hide flex-shrink-zero'+secondaryTextClass+'">'+_globalize.default.translate("HeaderReadMore")+'</a>\n                        </div>\n                     </div>\n                     <div class="flex-shrink-zero infoTabButtonsContainer hide">\n                        <button is="emby-button" type="button" class="btnPlayFromBeginning raised">\n                            <i class="md-icon md-icon-fill button-icon button-icon-left autortl">&#xe037;</i>\n                            <span class="btnPlayFromBeginningText"></span>\n                        </button>\n                     </div>\n                        ',view.querySelector(".btnPlayFromBeginningText").innerHTML=_globalize.default.translate("FromBeginning"),view.querySelector(".btnInfoTabOverviewText").addEventListener("click",onReadMoreClick.bind(this)),view.querySelector(".btnInfoTabReadMore").addEventListener("click",onReadMoreClick.bind(this)),view.querySelector(".btnPlayFromBeginning").addEventListener("click",function(e){_playbackmanager.default.seek(0)}.bind(this)),this.infoTabButtonsContainer=view.querySelector(".infoTabButtonsContainer"),_layoutmanager.default.tv||this.infoTabButtonsContainer.classList.add("infoTabButtonsContainer-autohide"),initDetailImage(this,view),Promise.resolve()},InfoTab.prototype.refreshItem=function(){_basetab.default.prototype.refreshItem.apply(this,arguments),this.imageItemsContainer.refreshItems();var options=this.currentOptions,item=options.displayItem,mediaSource=options.mediaSource,options=options.currentPlayer,titleElem=this.view.querySelector(".videoosd-info-title"),title2Elem=this.view.querySelector(".videoosd-info-title2"),seriesName=item.SeriesName||(item.IsSeries||item.EpisodeTitle?item.Name:null),seriesName=(seriesName?(titleElem.innerHTML=seriesName,"Program"===item.Type?title2Elem.classList.add("hide"):(title2Elem.innerHTML=_itemmanager.default.getDisplayName(item,{}),title2Elem.classList.remove("hide"))):(titleElem.innerHTML=_itemmanager.default.getDisplayName(item,{}),title2Elem.classList.add("hide")),item.Overview),titleElem=seriesName?_dom.default.stripScripts(seriesName):"";!function(elem,overview){var textElement=elem.querySelector(".osdinfo-overview-text"),btnReadMore=elem.querySelector(".btnInfoTabReadMore");btnReadMore.innerHTML=_globalize.default.translate("More"),_layoutmanager.default.tv?(elem.classList.remove("videoosd-info-overview-scroll"),textElement.classList.add("osdinfo-overview-text-readmore")):(elem.classList.add("videoosd-info-overview-scroll"),textElement.classList.remove("osdinfo-overview-text-readmore")),overview?(textElement.innerHTML=overview,elem.classList.remove("hide"),overview=textElement.closest("button"),_layoutmanager.default.tv?overview.removeAttribute("disabled"):overview.setAttribute("disabled","disabled"),btnReadMore.classList.add("hide")):(elem.classList.add("hide"),textElement.innerHTML="")}(this.view.querySelector(".videoosd-info-overview"),titleElem),_mediainfo.default.fillPrimaryMediaInfo(this.view.querySelector(".videoosd-info-mediainfo"),item,{endsAt:!1,bitrate:"Audio"===item.MediaType,mediaSource:mediaSource}),_mediainfo.default.fillSecondaryMediaInfo(this.view.querySelector(".videoosd-info-mediainfo2"),item,{mediaSource:mediaSource}),function(instance,mediaSource,currentPlayer){var infos,currentIndex,instance=instance.view.querySelector(".videoosd-info-mediasourceInfo");mediaSource&&(infos=[],(mediaSource=(mediaSource.MediaStreams||[]).filter(function(m){return"Video"===m.Type})[0])&&infos.push('<div class="mediaInfoItem">'+mediaSource.DisplayTitle+"</div>"),mediaSource=_playbackmanager.default.audioTracks(currentPlayer),currentIndex=_playbackmanager.default.getAudioStreamIndex(currentPlayer),(currentPlayer=mediaSource.filter(function(m){return m.Index===currentIndex})[0])&&infos.push('<div class="mediaInfoItem">'+currentPlayer.DisplayTitle+"</div>"),instance.innerHTML=infos.join(""),infos.length)?instance.classList.remove("hide"):instance.classList.add("hide")}(this,mediaSource,options),mediaSource.RunTimeTicks?this.infoTabButtonsContainer.classList.remove("hide"):this.infoTabButtonsContainer.classList.add("hide")},InfoTab.prototype.onResume=function(options){var instance=this;return _basetab.default.prototype.onResume.apply(this,arguments).then(function(){var optionsWithoutRefresh=Object.assign(Object.assign({},options),{refresh:!1});return instance.imageItemsContainer.resume(optionsWithoutRefresh).then(function(){options.refresh&&instance.refreshItem()})})},InfoTab.prototype.onPause=function(){_basetab.default.prototype.onPause.apply(this,arguments),this.imageItemsContainer.pause()},InfoTab.prototype.destroy=function(){_basetab.default.prototype.destroy.apply(this,arguments),this.endsAtElem=null,this.imageItemsContainer=null,this.infoTabButtonsContainer=null};_exports.default=InfoTab});