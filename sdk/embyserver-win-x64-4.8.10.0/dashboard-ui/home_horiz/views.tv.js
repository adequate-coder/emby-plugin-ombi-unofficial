define(["exports","./../modules/emby-apiclient/connectionmanager.js","./../modules/cardbuilder/cardbuilder.js","./../modules/common/itemmanager/itemmanager.js","./../modules/emby-elements/emby-itemscontainer/emby-itemscontainer.js","./../modules/common/globalize.js","./../modules/approuter.js","./spotlight.js","./../modules/tabbedview/basetab.js"],function(_exports,_connectionmanager,_cardbuilder,_itemmanager,_embyItemscontainer,_globalize,_approuter,_spotlight,_basetab){function backdropImageUrl(item,options){return(options=options||{}).type=options.type||"Backdrop",options.maxWidth||options.width||options.maxHeight||options.height||(options.quality=100),item.BackdropImageTags&&item.BackdropImageTags.length?(options.tag=item.BackdropImageTags[0],_connectionmanager.default.getApiClient(item.ServerId).getImageUrl(item.Id,options)):null}function TVTab(view,params){_basetab.default.apply(this,arguments)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,Object.assign(TVTab.prototype,_basetab.default.prototype),TVTab.prototype.scrollDirection=function(){return"x"},TVTab.prototype.onTemplateLoaded=function(){_basetab.default.prototype.onTemplateLoaded.apply(this,arguments);var view=this.view;this.latestItemsContainer=view.querySelector(".latestSection .itemsContainer"),this.latestItemsContainer.fetchData=function(){var options={IncludeItemTypes:"Episode",Limit:12,ParentId:this.params.parentId,Fields:this.getRequestedItemFields(),EnableImageTypes:this.getRequestedImageTypes(),ImageTypeLimit:1};return this.getApiClient().getLatestItems(options)}.bind(this),this.latestItemsContainer.getListOptions=function(){return{renderer:_cardbuilder.default,options:{shape:"backdrop",preferThumb:!0,showGroupCount:!0,multiSelect:!1,horizontalGrid:!0}}}.bind(this),this.latestItemsContainer.parentContainer=this.latestItemsContainer.closest(".horizontalSection"),this.addFocusBehavior(this.latestItemsContainer),this.resumeItemsContainer=view.querySelector(".resumeSection .itemsContainer"),this.resumeItemsContainer.fetchData=function(){var apiClient=this.getApiClient(),options={Limit:24,IncludeItemTypes:"Episode",ParentId:this.params.parentId,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Thumb,Logo"};return apiClient.getResumableItems(apiClient.getCurrentUserId(),options)}.bind(this),this.resumeItemsContainer.getListOptions=function(){return{renderer:_cardbuilder.default,options:{shape:"backdrop",preferThumb:!0,scalable:!1,multiSelect:!1,horizontalGrid:!0}}}.bind(this),this.resumeItemsContainer.parentContainer=this.resumeItemsContainer.closest(".horizontalSection"),this.addFocusBehavior(this.resumeItemsContainer),this.categoryItemsContainer=view.querySelector(".categoryItemsContainer"),this.categoryItemsContainer.fetchData=function(){var apiClient=this.getApiClient(),parentId=this.params.parentId;return apiClient.getItems(apiClient.getCurrentUserId(),{SortBy:"IsFavoriteOrLiked,Random",SortOrder:"Descending",IncludeItemTypes:"Series",Limit:3,Recursive:!0,ParentId:parentId,ImageTypes:"Backdrop",Fields:this.getRequestedItemFields(),EnableImageTypes:this.getRequestedImageTypes(),ImageTypeLimit:1}).then(function(seriesResult){var seriesResult=seriesResult.Items,imgOptions={maxWidth:600},items=[];return items.push({Name:_globalize.default.translate("Shows"),Id:"tvshows",ServerId:apiClient.serverId(),ParentId:parentId,Icon:_itemmanager.default.getDefaultIcon({CollectionType:"tvshows"}),IsCategory:!0,ImageUrl:1<seriesResult.length?backdropImageUrl(seriesResult[1],imgOptions):null}),items.push({Name:_globalize.default.translate("Favorites"),Id:"tvshows_favorites",ServerId:apiClient.serverId(),ParentId:parentId,Icon:"favorite",IsCategory:!0,ImageUrl:seriesResult.length?backdropImageUrl(seriesResult[0],imgOptions):null}),items.push({Name:_globalize.default.translate("Upcoming"),Id:"tvshows_upcoming",ServerId:apiClient.serverId(),ParentId:parentId,Icon:"&#xe916;",IsCategory:!0}),Promise.resolve({Items:items,TotalRecordCount:items.length})})}.bind(this),this.categoryItemsContainer.getListOptions=function(){return{renderer:_cardbuilder.default,options:{shape:"backdrop",multiSelect:!1,contextMenu:!1,overlayText:!0,fields:["Name"],action:"custom",cardClass:"categoryItemsContainer-spotlight-backdropCard"}}}.bind(this),this.categoryItemsContainer.addEventListener("action-null",function(e){var e=e.detail.item,url="/tv?serverId="+_connectionmanager.default.getApiClient(e).serverId()+"&parentId="+e.ParentId;1<(e=e.Id.split("_")).length&&(url+="&tab="+e[1]),_approuter.default.show(url)}.bind(this)),this.addFocusBehavior(this.categoryItemsContainer),this.spotlight=new _spotlight.default(view.querySelector(".spotlightItemsContainer"),function(query){var apiClient=this.getApiClient();return apiClient.getItems(apiClient.getCurrentUserId(),Object.assign({SortBy:"Random",IncludeItemTypes:"Series",Recursive:!0,ParentId:this.params.parentId,EnableImageTypes:"Backdrop,Logo",ImageTypes:"Backdrop",Fields:this.getRequestedItemFields(),ImageTypeLimit:1},query))}.bind(this),function(){var apiClient=this.getApiClient();return{Id:this.params.parentId,ServerId:apiClient.serverId(),CollectionType:"tvshows",Name:_globalize.default.translate("Shows"),IsFolder:!0}}.bind(this))},TVTab.prototype.onResume=function(options){_basetab.default.prototype.onResume.apply(this,arguments);var promises=[this.spotlight.resume(options),this.categoryItemsContainer.resume(options),this.resumeItemsContainer.resume(options),this.latestItemsContainer.resume(options)],instance=this;return Promise.all(promises).then(function(){options.autoFocus&&instance.autoFocus()})},TVTab.prototype.onPause=function(){_basetab.default.prototype.onPause.apply(this,arguments),this.spotlight.pause(),this.categoryItemsContainer.pause(),this.latestItemsContainer.pause(),this.resumeItemsContainer.pause()},TVTab.prototype.destroy=function(){_basetab.default.prototype.destroy.apply(this,arguments),this.spotlight&&(this.spotlight.destroy(),this.spotlight=null),this.categoryItemsContainer=null,this.latestItemsContainer=null,this.resumeItemsContainer=null},TVTab.prototype.loadTemplate=function(){return require(["text!home_horiz/views.tv.html"])};_exports.default=TVTab});