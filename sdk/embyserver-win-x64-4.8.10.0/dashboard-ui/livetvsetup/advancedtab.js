define(["exports","./../modules/tabbedview/basetab.js","./../modules/loading/loading.js","./../modules/common/globalize.js","./../modules/emby-elements/emby-input/emby-input.js","./../modules/emby-elements/emby-button/emby-button.js","./../modules/emby-elements/emby-checkbox/emby-checkbox.js","./../modules/emby-elements/emby-select/emby-select.js","./../modules/common/responsehelper.js"],function(_exports,_basetab,_loading,_globalize,_embyInput,_embyButton,_embyCheckbox,_embySelect,_responsehelper){function onSubmit(e){_loading.default.show();var form=this;return ApiClient.getNamedConfiguration("livetv").then(function(config){config.GuideDays=form.querySelector(".selectGuideDays").value||null,config.BufferLimitInMinutes=60*parseInt(form.querySelector(".selectBufferSize").value);var recordingPath=form.querySelector(".txtRecordingPath").value||void 0,movieRecordingPath=form.querySelector(".txtMovieRecordingPath").value||void 0,seriesRecordingPath=form.querySelector(".txtSeriesRecordingPath").value||void 0,recordingPathChanged=recordingPath!==config.RecordingPath||movieRecordingPath!==config.MovieRecordingPath||seriesRecordingPath!==config.SeriesRecordingPath;config.RecordingPath=recordingPath,config.MovieRecordingPath=movieRecordingPath,config.SeriesRecordingPath=seriesRecordingPath,config.RecordingFolderId=form.querySelector(".selectRecordingFolder").value||null,config.MovieRecordingFolderId=form.querySelector(".selectMovieRecordingFolder").value||null,config.SeriesRecordingFolderId=form.querySelector(".selectSeriesRecordingFolder").value||null,config.WakeServer=form.querySelector(".chkWakeServer").checked,config.RecordingEncodingFormat="mkv",config.PrePaddingSeconds=60*form.querySelector(".txtPrePaddingMinutes").value,config.PostPaddingSeconds=60*form.querySelector(".txtPostPaddingMinutes").value,config.RecordingPostProcessor=form.querySelector(".txtPostProcessor").value,config.RecordingPostProcessorArguments=form.querySelector(".txtPostProcessorArguments").value,ApiClient.updateNamedConfiguration("livetv",config).then(function(){_responsehelper.default.handleConfigurationSavedResponse(),function(recordingPathChanged){var msg="";recordingPathChanged&&(msg+=_globalize.default.translate("RecordingPathChangeMessage"));msg&&!function(options){Emby.importModule("./modules/common/dialogs/alert.js").then(function(alert){return alert(options)})}(msg)}(recordingPathChanged)})}),e.preventDefault(),e.stopPropagation(),!1}function getRecordingFoldersFromPropertyName(instance,query,propertyName){return instance.getAvailableRecordingOptions().then(function(availableRecordingOptions){var availableRecordingOptions=availableRecordingOptions[propertyName].slice(0),total=availableRecordingOptions.length;return availableRecordingOptions.unshift({Name:"",Type:"Folder",Id:"",ServerId:instance.getApiClient().serverId()}),{TotalRecordCount:total+=1,Items:availableRecordingOptions}})}function View(view,params){_basetab.default.apply(this,arguments)}function showOrHideAll(page,className,show){for(var elems="string"==typeof className?page.querySelectorAll("."+className):className,i=0,length=elems.length;i<length;i++)show?elems[i].classList.remove("hide"):elems[i].classList.add("hide")}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,Object.assign(View.prototype,_basetab.default.prototype),View.prototype.onResume=function(options){_basetab.default.prototype.onResume.apply(this,arguments),_loading.default.show();var view=this.view;ApiClient.getSystemInfo().then(function(systemInfo){systemInfo.SupportsWakeServer?view.querySelector(".fldWakeServer").classList.remove("hide"):view.querySelector(".fldWakeServer").classList.add("hide")}),ApiClient.getNamedConfiguration("livetv").then(function(config){!function(page,config){page.querySelector(".selectGuideDays").value=config.GuideDays||"",page.querySelector(".selectBufferSize").value=(config.BufferLimitInMinutes||0)/60,page.querySelector(".txtPrePaddingMinutes").value=config.PrePaddingSeconds/60,page.querySelector(".txtPostPaddingMinutes").value=config.PostPaddingSeconds/60,page.querySelector(".txtRecordingPath").value=config.RecordingPath||"",page.querySelector(".txtMovieRecordingPath").value=config.MovieRecordingPath||"",page.querySelector(".txtSeriesRecordingPath").value=config.SeriesRecordingPath||"",config.RecordingFolderId?page.querySelector(".selectRecordingFolder").setValues([config.RecordingFolderId]):page.querySelector(".selectRecordingFolder").setValues([],null,[{Id:"",Name:""}]),config.MovieRecordingFolderId?page.querySelector(".selectMovieRecordingFolder").setValues([config.MovieRecordingFolderId]):page.querySelector(".selectMovieRecordingFolder").setValues([],null,[{Id:"",Name:""}]),config.SeriesRecordingFolderId?page.querySelector(".selectSeriesRecordingFolder").setValues([config.SeriesRecordingFolderId]):page.querySelector(".selectSeriesRecordingFolder").setValues([],null,[{Id:"",Name:""}]),page.querySelector(".txtPostProcessor").value=config.RecordingPostProcessor||"",page.querySelector(".txtPostProcessorArguments").value=config.RecordingPostProcessorArguments||"",page.querySelector(".chkWakeServer").checked=null==config.WakeServer||config.WakeServer,_loading.default.hide()}(view,config)})},View.prototype.getAvailableRecordingOptions=function(){return this._availableRecordingOptions||(this._availableRecordingOptions=this.getApiClient().getAvailableRecordingOptions())},View.prototype.loadTemplate=function(){return require(["text!livetvsetup/advancedtab.html"])},View.prototype.onTemplateLoaded=function(){_basetab.default.prototype.onTemplateLoaded.apply(this,arguments);var page=this.view,extraPostProcessingArgs=(page.querySelector(".liveTvSettingsForm").addEventListener("submit",onSubmit),page.querySelector(".btnSelectRecordingPath").addEventListener("click",function(){Emby.importModule("./modules/directorybrowser/directorybrowser.js").then(function(directoryBrowser){var picker=new directoryBrowser;picker.show({callback:function(path){path&&(page.querySelector(".txtRecordingPath").value=path),picker.close()},validateWriteable:!0})})}),page.querySelector(".btnSelectMovieRecordingPath").addEventListener("click",function(){Emby.importModule("./modules/directorybrowser/directorybrowser.js").then(function(directoryBrowser){var picker=new directoryBrowser;picker.show({callback:function(path){path&&(page.querySelector(".txtMovieRecordingPath").value=path),picker.close()},validateWriteable:!0})})}),page.querySelector(".btnSelectSeriesRecordingPath").addEventListener("click",function(){Emby.importModule("./modules/directorybrowser/directorybrowser.js").then(function(directoryBrowser){var picker=new directoryBrowser;picker.show({callback:function(path){path&&(page.querySelector(".txtSeriesRecordingPath").value=path),picker.close()},validateWriteable:!0})})}),page.querySelector(".btnSelectPostProcessorPath").addEventListener("click",function(){Emby.importModule("./modules/directorybrowser/directorybrowser.js").then(function(directoryBrowser){var picker=new directoryBrowser;picker.show({includeFiles:!0,callback:function(path){path&&(page.querySelector(".txtPostProcessor").value=path),picker.close()}})})}),[]),extraPostProcessingArgsElem=page.querySelector(".extraPostProcessingArgs");extraPostProcessingArgs.push("{channelname}"),extraPostProcessingArgs.push("{channelnumber}"),extraPostProcessingArgsElem.innerHTML=extraPostProcessingArgs.join("<br/>"),extraPostProcessingArgs.length?extraPostProcessingArgsElem.classList.remove("hide"):extraPostProcessingArgsElem.classList.add("hide"),page.querySelector(".selectRecordingFolder").getItems=function(query){return getRecordingFoldersFromPropertyName(this,0,"RecordingFolders")}.bind(this),page.querySelector(".selectMovieRecordingFolder").getItems=function(query){return getRecordingFoldersFromPropertyName(this,0,"MovieRecordingFolders")}.bind(this),page.querySelector(".selectSeriesRecordingFolder").getItems=function(query){return getRecordingFoldersFromPropertyName(this,0,"SeriesRecordingFolders")}.bind(this),this.getApiClient().isMinServerVersion("4.8.0.58")?(showOrHideAll(page,"fldRecordingFolderById",!0),showOrHideAll(page,"fldRecordingFolderByPath",!1)):(showOrHideAll(page,"fldRecordingFolderById",!1),showOrHideAll(page,"fldRecordingFolderByPath",!0)),this.getApiClient().isMinServerVersion("4.8.0.68")?showOrHideAll(page,"fldBufferSize",!0):showOrHideAll(page,"fldBufferSize",!1)},View.prototype.destroy=function(){_basetab.default.prototype.destroy.apply(this,arguments),this._availableRecordingOptions=null};_exports.default=View});