define(["exports","./../modules/viewmanager/basesettingsview.js","./../modules/loading/loading.js","./../modules/common/globalize.js","./../modules/emby-elements/emby-input/emby-input.js","./../modules/emby-elements/emby-button/emby-button.js","./../modules/emby-elements/emby-checkbox/emby-checkbox.js","./../modules/emby-elements/emby-select/emby-select.js","./../modules/emby-elements/emby-scroller/emby-scroller.js","./../modules/approuter.js","./../modules/common/responsehelper.js","./../components/tunerpicker.js"],function(_exports,_basesettingsview,_loading,_globalize,_embyInput,_embyButton,_embyCheckbox,_embySelect,_embyScroller,_approuter,_responsehelper,_tunerpicker){function onBackClick(){_approuter.default.back()}function fillTunerHostInfo(view,info){!function(view,value){var mayIncludeUnsupportedDrmChannels="hdhomerun"===value,supportsTranscoding="hdhomerun"===value,supportsFavorites="hdhomerun"===value,supportsTunerIpAddress="hdhomerun"===value,supportsTunerFileOrUrl="m3u"===value,supportsTunerCount="m3u"===value,supportsUserAgent="m3u"===value,suppportsSubmit="other"!==value,supportsSelectablePath=supportsTunerFileOrUrl,txtDevicePath=view.querySelector(".txtDevicePath");supportsTunerIpAddress?(txtDevicePath.label(_globalize.default.translate("LabelTunerIpAddress")),view.querySelector(".fldPath").classList.remove("hide")):supportsTunerFileOrUrl?(txtDevicePath.label(_globalize.default.translate("LabelFileOrUrl")),view.querySelector(".fldPath").classList.remove("hide")):view.querySelector(".fldPath").classList.add("hide");"hdhomerun"===value||"hauppauge"===value?view.querySelector(".btnDetect").classList.remove("hide"):view.querySelector(".btnDetect").classList.add("hide");supportsSelectablePath?(view.querySelector(".btnSelectPath").classList.remove("hide"),view.querySelector(".txtDevicePath").setAttribute("required","required")):(view.querySelector(".btnSelectPath").classList.add("hide"),view.querySelector(".txtDevicePath").removeAttribute("required"));supportsUserAgent?(view.querySelector(".fldUserAgent").classList.remove("hide"),view.querySelector(".fldReferrer").classList.remove("hide")):(view.querySelector(".fldUserAgent").classList.add("hide"),view.querySelector(".fldReferrer").classList.add("hide"));supportsFavorites?view.querySelector(".fldFavorites").classList.remove("hide"):view.querySelector(".fldFavorites").classList.add("hide");supportsTranscoding?view.querySelector(".fldTranscode").classList.remove("hide"):view.querySelector(".fldTranscode").classList.add("hide");supportsTunerCount?(view.querySelector(".fldTunerCount").classList.remove("hide"),view.querySelector(".txtTunerCount").setAttribute("required","required")):(view.querySelector(".fldTunerCount").classList.add("hide"),view.querySelector(".txtTunerCount").removeAttribute("required"));mayIncludeUnsupportedDrmChannels?view.querySelector(".drmMessage").classList.remove("hide"):view.querySelector(".drmMessage").classList.add("hide");suppportsSubmit?view.querySelector(".button-submit").classList.remove("hide"):view.querySelector(".button-submit").classList.add("hide")}(view,info.Type||""),view.querySelector(".txtDevicePath").value=info.Url||"",view.querySelector(".txtFriendlyName").value=info.FriendlyName||"",view.querySelector(".txtUserAgent").value=info.UserAgent||"",view.querySelector(".txtReferrer").value=info.Referrer||"",view.querySelector(".fldDeviceId").value=info.DeviceId||"",view.querySelector(".chkFavorite").checked=info.ImportFavoritesOnly,view.querySelector(".chkTranscode").checked=info.AllowHWTranscoding,view.querySelector(".txtTunerCount").value=info.TunerCount||"0"}function View(view,params){function submitForm(page){_loading.default.show();var info={Type:params.type,Url:page.querySelector(".txtDevicePath").value||null,UserAgent:page.querySelector(".txtUserAgent").value||null,Referrer:page.querySelector(".txtReferrer").value||null,FriendlyName:page.querySelector(".txtFriendlyName").value||null,DeviceId:page.querySelector(".fldDeviceId").value||null,TunerCount:page.querySelector(".txtTunerCount").value||0,ImportFavoritesOnly:page.querySelector(".chkFavorite").checked,AllowHWTranscoding:page.querySelector(".chkTranscode").checked},page=params.id;page&&(info.Id=page),ApiClient.saveTunerHostConfiguration(info).then(function(result){_responsehelper.default.handleConfigurationSavedResponse(),_approuter.default.show(_approuter.default.getRouteUrl("LiveTVSetup",{SavedTunerHostId:(result||{}).Id||info.Id,IsNew:null==params.id}))},function(){var options;_loading.default.hide(),options={text:_globalize.default.translate("ErrorSavingTvProvider")},Emby.importModule("./modules/common/dialogs/alert.js").then(function(alert){return alert(options)})})}_basesettingsview.default.apply(this,arguments),params.id?view.querySelector(".saveButtonText").innerHTML=_globalize.default.translate("Save"):view.querySelector(".saveButtonText").innerHTML=_globalize.default.translate("HeaderAddTvSource"),view.querySelector(".btnCancel").addEventListener("click",onBackClick),view.querySelector("form").addEventListener("submit",function(e){return e.preventDefault(),e.stopPropagation(),submitForm(view),!1}),view.querySelector(".btnDetect").addEventListener("click",function(){(new _tunerpicker.default).show({serverId:ApiClient.serverId()}).then(function(info){fillTunerHostInfo(view,info)})}),view.querySelector(".btnSelectPath").addEventListener("click",function(){Emby.importModule("./modules/directorybrowser/directorybrowser.js").then(function(directoryBrowser){var picker=new directoryBrowser;picker.show({includeFiles:!0,callback:function(path){path&&(view.querySelector(".txtDevicePath").value=path),picker.close()}})})})}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,Object.assign(View.prototype,_basesettingsview.default.prototype),View.prototype.loadSettingsInternal=function(){var view=this.view,params=this.params,currentId=params.id;return function(view,type){return ApiClient.getJSON(ApiClient.getUrl("LiveTv/TunerHosts/Types")).then(function(types){types=types.filter(function(t){return t.Id===type})[0];types&&(view.querySelector(".typeName").innerHTML=types.Name)})}(view,params.type).then(function(){return function(view,providerInfo){return view.querySelector(".txtDevicePath").value="",view.querySelector(".chkFavorite").checked=!1,view.querySelector(".txtDevicePath").value="",providerInfo.Id?ApiClient.getTunerHostConfiguration(providerInfo.Id).then(function(info){fillTunerHostInfo(view,info||providerInfo)}):(fillTunerHostInfo(view,providerInfo),Promise.resolve())}(view,{Id:currentId,Type:params.type})})};_exports.default=View});