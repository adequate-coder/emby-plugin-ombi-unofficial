define(["exports","./../modules/tabbedview/basetab.js","./../modules/common/globalize.js","./../modules/emby-elements/emby-input/emby-input.js","./../modules/emby-elements/emby-button/emby-button.js","./../modules/emby-elements/emby-checkbox/emby-checkbox.js","./../modules/emby-elements/emby-select/emby-select.js","./../modules/emby-elements/emby-scroller/emby-scroller.js","./../modules/emby-elements/emby-itemscontainer/emby-itemscontainer.js","./../modules/emby-elements/emby-premierecontainer/emby-premierecontainer.js","./../components/taskbutton.js","./../modules/cardbuilder/cardbuilder.js","./../modules/approuter.js"],function(_exports,_basetab,_globalize,_embyInput,_embyButton,_embyCheckbox,_embySelect,_embyScroller,_embyItemscontainer,_embyPremierecontainer,_taskbutton,_cardbuilder,_approuter){function getListingProviders(){var apiClient=this.apiClient;return apiClient.getJSON(ApiClient.getUrl("LiveTv/ListingProviders")).catch(function(){return apiClient.getNamedConfiguration("livetv").then(function(config){return config.ListingProviders})}).then(function(results){return function(providers,apiClient){for(var i=0,length=providers.length;i<length;i++){var provider=providers[i];provider.Name||(provider.Name=provider.Type),provider.Url||(provider.Url=provider.Path||provider.ListingsId),provider.SetupUrl||(provider.SetupUrl="#"),provider.ProviderType=provider.Type,provider.Type="LiveTVGuideSource",provider.ServerId=apiClient.serverId()}}(results,apiClient),results})}function getTunerDevices(){var apiClient=this.apiClient;return apiClient.getJSON(ApiClient.getUrl("LiveTv/TunerHosts")).catch(function(){return apiClient.getNamedConfiguration("livetv").then(function(config){return config.TunerHosts})}).then(function(results){return function(devices,apiClient){for(var i=0,length=devices.length;i<length;i++){var tuner=devices[i];tuner.Type="LiveTVTunerDevice",tuner.Name=tuner.FriendlyName,tuner.ServerId=apiClient.serverId()}}(results,apiClient),results})}function addDevice(button){ApiClient.getJSON(ApiClient.getUrl("LiveTv/TunerHosts/Types")).then(function(types){var options,allTunerTypes=types;return types=allTunerTypes.map(function(t){return{id:t.Id,name:t.Name}}),options={items:types,title:_globalize.default.translate("HeaderAddTvSource"),positionTo:button,positionY:"bottom",bottomText:_globalize.default.translate("ForAdditionalLiveTvOptions",'<a is="emby-linkbutton" href="'+_approuter.default.getRouteUrl("PluginCatalog")+'" class="button-link">',"</a>")},Emby.importModule("./modules/actionsheet/actionsheet.js").then(function(ActionSheet){return ActionSheet.show(options)}).then(function(typeId){!function(allTunerTypes,typeId){allTunerTypes=(allTunerTypes=allTunerTypes.filter(function(t){return t.Id===typeId})[0].SetupUrl)||"livetvsetup/livetvtuner.html?type="+typeId,_approuter.default.show(allTunerTypes)}(allTunerTypes,typeId)})})}function LiveTVSetupTab(view,params){_basetab.default.apply(this,arguments)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,require(["flexStyles","material-icons"]),Object.assign(LiveTVSetupTab.prototype,_basetab.default.prototype),LiveTVSetupTab.prototype.loadTemplate=function(){return require(["text!livetvsetup/setuptab.html"])},LiveTVSetupTab.prototype.onTemplateLoaded=function(){_basetab.default.prototype.onTemplateLoaded.apply(this,arguments);var view=this.view;view.querySelector(".btnAddDevice").addEventListener("click",function(){addDevice(this)}),view.querySelector(".btnAddProvider").addEventListener("click",function(){_approuter.default.show("livetvsetup/guideprovider.html")}),view.querySelector(".premiereInfo").innerHTML=_globalize.default.translate("DvrSubscriptionRequired",'<a is="emby-linkbutton" href="https://emby.media/premiere" target="_blank" class="button-link">',"</a>"),this.apiClient=ApiClient,this.tunersItemsContainer=view.querySelector(".devicesList"),this.tunersItemsContainer.fetchData=getTunerDevices.bind(this),this.tunersItemsContainer.getListOptions=function(){return{renderer:_cardbuilder.default,options:{fields:["Name","Url"],multiSelect:!1,draggable:!1,action:"edit",shape:"backdrop",defaultBackground:!0},virtualScrollLayout:"vertical-grid"}}.bind(this),this.providersItemsContainer=view.querySelector(".providerList"),this.providersItemsContainer.fetchData=getListingProviders.bind(this),this.providersItemsContainer.getListOptions=function(){return{renderer:_cardbuilder.default,options:{fields:["Name","Url"],multiSelect:!1,draggable:!1,action:"edit",shape:"backdrop",defaultBackground:!0},virtualScrollLayout:"vertical-grid"}}.bind(this),this.guideRefreshTaskButton=new _taskbutton.default({progressElem:this.view.querySelector(".refreshGuideProgress"),taskKey:"RefreshGuide",button:this.view.querySelector(".btnRefresh")})},LiveTVSetupTab.prototype.onResume=function(options){var _this$guideRefreshTas;return _basetab.default.prototype.onResume.apply(this,arguments),null!=(_this$guideRefreshTas=this.guideRefreshTaskButton)&&_this$guideRefreshTas.resume({}),Promise.all([this.tunersItemsContainer.resume(options),this.providersItemsContainer.resume(options)])},LiveTVSetupTab.prototype.onPause=function(){var _this$guideRefreshTas2;_basetab.default.prototype.onPause.apply(this,arguments),this.tunersItemsContainer.pause(),this.providersItemsContainer.pause(),null!=(_this$guideRefreshTas2=this.guideRefreshTaskButton)&&_this$guideRefreshTas2.pause()},LiveTVSetupTab.prototype.destroy=function(){var _this$guideRefreshTas3;_basetab.default.prototype.destroy.apply(this,arguments),null!=(_this$guideRefreshTas3=this.guideRefreshTaskButton)&&_this$guideRefreshTas3.destroy(),this.guideRefreshTaskButton=null};_exports.default=LiveTVSetupTab});