define(["exports","./../modules/common/globalize.js","./../modules/layoutmanager.js","./../modules/focusmanager.js","./../modules/loading/loading.js","./../modules/dialoghelper/dialoghelper.js","./../modules/emby-elements/emby-button/emby-button.js","./../modules/emby-elements/emby-itemscontainer/emby-itemscontainer.js","./../modules/emby-elements/emby-dialogclosebutton/emby-dialogclosebutton.js","./../modules/dom.js","./../modules/cardbuilder/cardbuilder.js"],function(_exports,_globalize,_layoutmanager,_focusmanager,_loading,_dialoghelper,_embyButton,_embyItemscontainer,_embyDialogclosebutton,_dom,_cardbuilder){function getListOptions(){return{renderer:_cardbuilder.default,options:function(){return{enableDefaultIcon:!0,action:"custom",fields:["Name","Filename"],draggable:!1,multiSelect:!1,contextMenu:!1,hoverPlayButton:!1,imageSize:"Collection"===this.options.type||_layoutmanager.default.tv?"smaller":"small",enableUserDataButtons:!1,mediaInfo:!1,shape:"backdrop",textLinks:!1}}.apply(this),virtualScrollLayout:"vertical-list"}}function getItems(query){_loading.default.show();var instance=this,apiClient=(this.context.querySelector(".loadingContent").classList.remove("hide"),ApiClient),serverId=apiClient.serverId();return apiClient.getJSON(apiClient.getUrl("LiveTv/Tuners/Discvover",{NewDevicesOnly:!0})).then(function(items){instance.context.querySelector(".loadingContent").classList.add("hide");var totalRecordCount=items.length;return null!=query&&query.StartIndex&&(items=items.slice(query.StartIndex)),null!=query&&query.Limit&&(items.length=Math.min(query.Limit,items.length)),{TotalRecordCount:totalRecordCount,Items:items=items.map(function(item){return{Type:"GenericListItem",ServerId:serverId,Name:function(providerId){switch(providerId=providerId.toLowerCase()){case"m3u":return"M3U";case"hdhomerun":return"HDHomerun";case"hauppauge":return"Hauppauge";case"satip":return"DVB";default:return"Unknown"}}(item.Type),Filename:item.FriendlyName,OriginalItem:item,Icon:"&#xe1b2;"}})}})}function onItemsContainerUpgraded(){this.itemsContainer.resume({refresh:!0}).then(function(){var context=this.context;_focusmanager.default.autoFocus(context,{skipIfNotEnabled:!0})}.bind(this))}function TunerPicker(){}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,require(["material-icons","formDialogStyle"]),TunerPicker.prototype.show=function(options){var dialogOptions={removeOnClose:!0,scrollY:!1},dialogOptions=(_layoutmanager.default.tv?dialogOptions.size="fullscreen":dialogOptions.size="fullscreen-border",_dialoghelper.default.createDialog(dialogOptions)),html=(dialogOptions.classList.add("formDialog"),""),html=(html=(html=(html=(html=(html+='<div class="formDialogHeader">')+'<button type="button" is="emby-dialogclosebutton"></button>'+'<h3 class="formDialogHeaderTitle">')+_globalize.default.translate("HeaderAddTvSource"))+"</h3>"+"</div>")+function(){var html="";return html+'<div class="formDialogContent flex flex-direction-column align-items-center" style="overflow:hidden;">'+'<div is="emby-scroller" data-horizontal="false" data-forcescrollbar="true" data-focusscroll="true" class="flex flex-grow virtualScrollerScrollContainer" style="width:100%;">'+'<div class="scrollSlider padded-left padded-right padded-top flex-grow">'+'<div class="loadingContent hide">'+("<h1>"+_globalize.default.translate("DetectingDevices")+"...</h1>")+("<p>"+_globalize.default.translate("MessagePleaseWait")+"</p>")+"</div>"+('<p class="noItemsMessage hide">'+_globalize.default.translate("NoNewDevicesFound")+"</p>")+'<div is="emby-itemscontainer" data-virtualscrolllayout="vertical-grid" class="itemsContainer itemsContainer-defaultCardSize vertical-wrap padded-bottom-page">'+"</div>"+"</div>"+"</div>"+"</div>"}(),dialogOptions.innerHTML=html,dialogOptions.querySelector(".itemsContainer")),instance=(html.addEventListener("action-null",function(e){this.dialogResult=e.detail.item.OriginalItem,_dialoghelper.default.close(this.context)}.bind(this)),html.fetchData=getItems.bind(this),html.getListOptions=getListOptions.bind(this),html.afterRefresh=function(result){var items=result.Items||result,result=result.TotalRecordCount||items.length;_loading.default.hide(),result?this.context.querySelector(".noItemsMessage").classList.add("hide"):this.context.querySelector(".noItemsMessage").classList.remove("hide")}.bind(this),this.itemsContainer=html,this.context=dialogOptions,this.options=options,dialogOptions.addEventListener("opened",function(){var itemsContainer=this.itemsContainer;itemsContainer.resume?onItemsContainerUpgraded.call(this):_dom.default.addEventListener(itemsContainer,"upgraded",onItemsContainerUpgraded.bind(this),{once:!0})}.bind(this)),this);return _dialoghelper.default.open(dialogOptions).then(function(){var result=instance.dialogResult;return instance.cleanup(),result?Promise.resolve(result):Promise.reject()})},TunerPicker.prototype.cleanup=function(){this.options=null,this.context=null,this.itemsContainer=null,this.dialogResult=null};_exports.default=TunerPicker});