define(["exports","./../../modules/common/itemmanager/itemmanager.js","./../../modules/common/globalize.js","./../../modules/common/servicelocator.js","./../imageoptionseditor/imageoptionseditor.js","./../../modules/emby-elements/emby-scroller/emby-scroller.js","./../../modules/emby-elements/emby-input/emby-input.js","./../../modules/emby-elements/emby-select/emby-select.js","./../../modules/emby-elements/emby-checkbox/emby-checkbox.js","./../../modules/emby-elements/emby-itemscontainer/emby-itemscontainer.js","./../../modules/listview/listview.js","./../../modules/layoutmanager.js"],function(_exports,_itemmanager,_globalize,_servicelocator,_imageoptionseditor,_embyScroller,_embyInput,_embySelect,_embyCheckbox,_embyItemscontainer,_listview,_layoutmanager){var currentLibraryOptions,currentAvailableOptions;function getSelectLanguages(query){var apiClient=ApiClient,select=this;return apiClient.getCultures().then(function(cultures){var selectedValues=select.values;Array.isArray(selectedValues)||(selectedValues=null!=(_selectedValues=selectedValues)&&_selectedValues.split?selectedValues.split(","):[]);(items=cultures.map(function(c){return{Name:c.DisplayName,Id:c.TwoLetterISOLanguageName,Type:"GenericListItem"}})).sort(function(a,b){a=selectedValues.indexOf(a.Id),b=selectedValues.indexOf(b.Id);return(a=a<0?items.length:a)===(b=b<0?items.length:b)?0:a<b?-1:1});var _selectedValues=items.length,items=items.slice(query.StartIndex||0);return null!=query.Limit&&items.length>query.Limit&&(items.length=Math.min(items.length,query.Limit)),{TotalRecordCount:_selectedValues,Items:items}})}function populateLanguagesIntoSelect(select,languages){var html="";html+="<option value=''></option>";for(var i=0,length=languages.length;i<length;i++){var culture=languages[i];html+="<option value='"+culture.TwoLetterISOLanguageName+"'>"+culture.DisplayName+"</option>"}select.innerHTML=html}function populateRefreshInterval(select,interval){var html="",html=(html+="<option value='0'>"+_globalize.default.translate("Never")+"</option>")+interval.map(function(val){return"<option value='"+val+"'>"+_globalize.default.translate("EveryNDays",val)+"</option>"}).join("");select.innerHTML=html}function populateMaxDownloadAge(select){var html="",html=(html+="<option value='0'>"+_globalize.default.translate("NoAgeLimit")+"</option>")+[14,30,60,90,120,180].map(function(val){return"<option value='"+val+"' "+(180===val?" selected":"")+">"+_globalize.default.translate("NDays",val)+"</option>"}).join("");select.innerHTML=html}function refreshItemsContainers(page){for(var promises=[],itemsContainers=page.querySelectorAll(".itemsContainer"),i=0,length=itemsContainers.length;i<length;i++)promises.push(function(itemsContainer){return itemsContainer.waitForCustomElementUpgrade().then(function(){itemsContainer.resume({refresh:!0})})}(itemsContainers[i]));Promise.all(promises)}function getOrderedPlugins(plugins,configuredOrder){return(plugins=plugins.slice(0)).sort(function(a,b){return(a=configuredOrder.indexOf(a.Name))<(b=configuredOrder.indexOf(b.Name))?-1:b<a?1:0}),plugins}function getItemsFromSourceItems(query,sourceItems){for(var items=sourceItems.map(function(i,index){var plugin,enableLink,linkStart;return(i.Features||[]).includes("RequiredSetup")?(enableLink=(plugin=i).SetupUrl,linkStart=enableLink?'<a href="'+plugin.SetupUrl+'" is="emby-linkbutton" class="button-link">'+plugin.Name:plugin.Name,enableLink=enableLink?"</a>":"",plugin=_globalize.default.translate("ProviderNeedsSetupWithUrl",plugin.Name,linkStart,enableLink)):"thetvdb"===(i.Name||"").toLowerCase()&&(linkStart="Metadata provided by {0}TheTVDB{1}. Please consider supporting TheTVDB by adding missing information or subscribing.",plugin=linkStart=_servicelocator.appHost.supports("externallinks")&&_servicelocator.appHost.supports("targetblank")&&!_layoutmanager.default.tv?linkStart.replace("{0}",'<a is="emby-linkbutton" class="button-link" href="https://u10505776.ct.sendgrid.net/ls/click?upn=xMYYCP13hVd-2BZPpbVcMPHeLXfv-2BPRdIsKm2qSeirIHi7kH9am8IxD-2BavFbeqGqIXhYSX_3vJGkDxT-2BkunZNiBhP0A-2FgnzP8fpop8DS6eHDvUovCjNP0soWQW676fXXT2AIkyRKGna8SCDrkQjnhaj530jQSTa87HTuTDwvGiBqeSwPxTSgVxlxCgw4O-2BSuP8cT8LWN-2BvSLziJev27SJk22WNo8EAmmMxf9PnByhpFrDxhEhHfYN-2BUTgSydVQKwe4mFY53vPm-2Fus5xrLlvgo6e4STB4g-3D-3D" target="_blank">').replace("{1}","</a>"):linkStart.replace("{0}","").replace("{1}","")),{Type:"GenericListItem",Name:i.Name,Icon:"folder",DeleteType:"remove",OriginalItem:i,CanReorder:!0,ShortOverviewHtml:plugin}}),i=0,length=items.length;i<length;i++){var item=items[i];item.CanMoveUp=0<i,item.CanMoveDown=i<items.length-1}return Promise.resolve({Items:items,TotalRecordCount:items.length})}function getItems(query,property,orderProperty){return getItemsFromSourceItems(0,getOrderedPlugins(currentAvailableOptions[property]||[],currentLibraryOptions[orderProperty]||[]))}function getMetadataReaderItems(query){return getItems(0,"MetadataReaders","LocalMetadataReaderOrder")}function isLocalMetadataReaderOriginalItemChecked(item){var libraryOptions=currentLibraryOptions;return!(null!=libraryOptions&&null!=(libraryOptions=libraryOptions.DisabledLocalMetadataReaders)&&libraryOptions.includes(item.Name))}function isLocalMetadataReaderChecked(item){return isLocalMetadataReaderOriginalItemChecked(item.OriginalItem)}function removeItemOnce(arr,value){value=arr.indexOf(value);-1<value&&arr.splice(value,1)}function onProviderChecked(options,disabledListProperty){for(var items=options.items,checked=options.checked,options=currentLibraryOptions,disabledProviders=(options[disabledListProperty]||(options[disabledListProperty]=[]),options[disabledListProperty]),i=0,length=items.length;i<length;i++){var key=items[i].OriginalItem.Name;checked?disabledProviders.includes(key)&&removeItemOnce(disabledProviders,key):disabledProviders.includes(key)||disabledProviders.push(key)}return Promise.resolve()}function onLocalMetadataReaderChecked(options){return onProviderChecked(options,"DisabledLocalMetadataReaders")}function onItemsMovedToNewIndex(movedItems,allItems,options,orderProperty,libraryOptionsObject){console.log("onItemsMovedToNewIndex");var fromIndex=options.currentIndex,options=options.newIndex;return console.log("onItemsMovedToNewIndex, fromIndex: "+fromIndex+", newIndex: "+options),fromIndex!==options&&(function(arr,fromIndex,toIndex){var element=arr[fromIndex];arr.splice(fromIndex,1),arr.splice(toIndex,0,element)}(allItems,fromIndex,options),(libraryOptionsObject||currentLibraryOptions)[orderProperty]=allItems.map(function(i){return i.Name})),Promise.resolve()}function onMetadataReadersMoved(items,options){return onItemsMovedToNewIndex(0,currentAvailableOptions.MetadataReaders,options,"LocalMetadataReaderOrder")}function getMetadataReaderListOptions(items){return{renderer:_listview.default,options:{moreButton:!1,defaultBackground:!1,action:_layoutmanager.default.tv?"menu":"none",buttonCommands:["delete"],fields:["ItemCheckbox","Name"],draggable:!0,draggableXActions:!1,dragReorder:!0,roundImage:!0,image:!1,multiSelect:!1,getIsItemChecked:isLocalMetadataReaderChecked,checkboxAction:onLocalMetadataReaderChecked,commandActions:{moveInOrder:onMetadataReadersMoved}}}}function getSubtitleFetcherItems(query){return getItems(0,"SubtitleFetchers","SubtitleFetcherOrder")}function isSubtitleFetcherChecked(item){var libraryOptions=currentLibraryOptions;return!(null!=libraryOptions&&null!=(libraryOptions=libraryOptions.DisabledSubtitleFetchers)&&libraryOptions.includes(item.OriginalItem.Name))}function onSubtitleFetcherChecked(options){return onProviderChecked(options,"DisabledSubtitleFetchers")}function onSubtitleFetchersMoved(items,options){return onItemsMovedToNewIndex(0,currentAvailableOptions.SubtitleFetchers,options,"SubtitleFetcherOrder")}function getSubtitleFetcherListOptions(){return{renderer:_listview.default,options:{moreButton:!1,defaultBackground:!1,action:_layoutmanager.default.tv?"menu":"none",buttonCommands:["delete"],fields:["ItemCheckbox","Name","ShortOverviewHtml"],draggable:!0,draggableXActions:!1,dragReorder:!0,roundImage:!0,image:!1,multiSelect:!1,getIsItemChecked:isSubtitleFetcherChecked,checkboxAction:onSubtitleFetcherChecked,commandActions:{moveInOrder:onSubtitleFetchersMoved}}}}function getLyricsFetcherItems(query){return getItems(0,"LyricsFetchers","LyricsFetcherOrder")}function isLyricsFetcherChecked(item){var libraryOptions=currentLibraryOptions;return!(null!=libraryOptions&&null!=(libraryOptions=libraryOptions.DisabledLyricsFetchers)&&libraryOptions.includes(item.OriginalItem.Name))}function onLyricsFetcherChecked(options){return onProviderChecked(options,"DisabledLyricsFetchers")}function onLyricsFetchersMoved(items,options){return onItemsMovedToNewIndex(0,currentAvailableOptions.LyricsFetchers,options,"LyricsFetcherOrder")}function getLyricsFetcherListOptions(){return{renderer:_listview.default,options:{moreButton:!1,defaultBackground:!1,action:_layoutmanager.default.tv?"menu":"none",buttonCommands:["delete"],fields:["ItemCheckbox","Name","ShortOverviewHtml"],draggable:!0,draggableXActions:!1,dragReorder:!0,roundImage:!0,image:!1,multiSelect:!1,getIsItemChecked:isLyricsFetcherChecked,checkboxAction:onLyricsFetcherChecked,commandActions:{moveInOrder:onLyricsFetchersMoved}}}}function getImageFetcherItems(query){var type=this.getAttribute("data-type");return getItemsFromSourceItems(0,getOrderedPlugins(getTypeOptions(currentAvailableOptions,type).ImageFetchers||[],(getTypeOptions(currentLibraryOptions,type)||{}).ImageFetcherOrder||[]))}function getImageFetcherListOptions(){return{renderer:_listview.default,options:{moreButton:!1,defaultBackground:!1,action:_layoutmanager.default.tv?"menu":"none",buttonCommands:["delete"],fields:["ItemCheckbox","Name","ShortOverviewHtml"],draggable:!0,draggableXActions:!1,dragReorder:!0,roundImage:!0,image:!1,multiSelect:!1,getIsItemChecked:function(item){var type=this.getAttribute("data-type"),type=getTypeOptions(currentLibraryOptions,type)||{};return item=item.OriginalItem,type.ImageFetchers?type.ImageFetchers.includes(item.Name):item.DefaultEnabled}.bind(this),checkboxAction:function(options){for(var type=this.getAttribute("data-type"),type=getTypeOptions(currentLibraryOptions,type,!0),items=options.items,checked=options.checked,enabledProviders=(type.ImageFetchers||(type.ImageFetchers=[]),type.ImageFetchers),i=0,length=items.length;i<length;i++){var key=items[i].OriginalItem.Name;checked?enabledProviders.includes(key)||enabledProviders.push(key):enabledProviders.includes(key)&&removeItemOnce(enabledProviders,key)}return Promise.resolve()}.bind(this),commandActions:{moveInOrder:function(items,options){var type=this.getAttribute("data-type"),libraryOptionsForType=getTypeOptions(currentLibraryOptions,type,!0);return onItemsMovedToNewIndex(0,getTypeOptions(currentAvailableOptions,type).ImageFetchers||[],options,"ImageFetcherOrder",libraryOptionsForType)}.bind(this)}}}}function getMetadataFetcherItems(query){var type=this.getAttribute("data-type");return getItemsFromSourceItems(0,getOrderedPlugins(getTypeOptions(currentAvailableOptions,type).MetadataFetchers||[],(getTypeOptions(currentLibraryOptions,type)||{}).MetadataFetcherOrder||[]))}function isMetadataFetcherOriginalItemChecked(item,type){type=getTypeOptions(currentLibraryOptions,type)||{};return type.MetadataFetchers?type.MetadataFetchers.includes(item.Name):item.DefaultEnabled}function getMetadataFetcherListOptions(){return{renderer:_listview.default,options:{moreButton:!1,defaultBackground:!1,action:_layoutmanager.default.tv?"menu":"none",buttonCommands:["delete"],fields:["ItemCheckbox","Name","ShortOverviewHtml"],draggable:!0,draggableXActions:!1,dragReorder:!0,roundImage:!0,image:!1,multiSelect:!1,getIsItemChecked:function(item){var type=this.getAttribute("data-type");return isMetadataFetcherOriginalItemChecked(item=item.OriginalItem,type)}.bind(this),checkboxAction:function(options){for(var type=this.getAttribute("data-type"),type=getTypeOptions(currentLibraryOptions,type,!0),items=options.items,checked=options.checked,enabledProviders=(type.MetadataFetchers||(type.MetadataFetchers=[]),type.MetadataFetchers),i=0,length=items.length;i<length;i++){var key=items[i].OriginalItem.Name;checked?enabledProviders.includes(key)||enabledProviders.push(key):enabledProviders.includes(key)&&removeItemOnce(enabledProviders,key)}return Promise.resolve()}.bind(this),commandActions:{moveInOrder:function(items,options){var type=this.getAttribute("data-type"),libraryOptionsForType=getTypeOptions(currentLibraryOptions,type,!0);return onItemsMovedToNewIndex(0,getTypeOptions(currentAvailableOptions,type).MetadataFetchers||[],options,"MetadataFetcherOrder",libraryOptionsForType)}.bind(this)}}}}function getTypeOptions(allOptions,type,createIfNotFound){for(var allTypeOptions=allOptions.TypeOptions||[],i=0,length=allTypeOptions.length;i<length;i++){var typeOptions=allTypeOptions[i];if(typeOptions.Type===type)return typeOptions}return createIfNotFound?(createIfNotFound={Type:type},allOptions.TypeOptions||(allOptions.TypeOptions=[]),allOptions.TypeOptions.push(createIfNotFound),createIfNotFound):null}function renderMetadataFetchers(page,availableOptions,libraryOptions,contentType){for(var html="",elem=page.querySelector(".metadataFetchers"),i=0,length=availableOptions.TypeOptions.length;i<length;i++){var availableTypeOptions=availableOptions.TypeOptions[i];html+=function(availableTypeOptions,libraryOptionsForType){return getOrderedPlugins(availableTypeOptions.MetadataFetchers||[],libraryOptionsForType.MetadataFetcherOrder||[]).length?'<div class="metadataFetcher verticalSection verticalSection-extrabottompadding" data-type="'+availableTypeOptions.Type+'"><div class="sectionTitleContainer"><h2 class="sectionTitle">'+_globalize.default.translate("HeaderTypeMetadataDownloaders",_itemmanager.default.getItemTypeName(availableTypeOptions.Type))+'</h2></div><p class="secondaryText" style="margin:.5em 0;">'+_globalize.default.translate("LabelMetadataDownloadersHelp")+'</p><div class="itemsContainer" is="emby-itemscontainer" data-type="'+availableTypeOptions.Type+'"></div></div>':""}(availableTypeOptions,getTypeOptions(libraryOptions,availableTypeOptions.Type)||{})}elem.innerHTML=html;for(var itemsContainers=elem.querySelectorAll(".itemsContainer"),_i=0,_length=itemsContainers.length;_i<_length;_i++){var itemsContainer=itemsContainers[_i];itemsContainer.fetchData=getMetadataFetcherItems.bind(itemsContainer),itemsContainer.getListOptions=getMetadataFetcherListOptions.bind(itemsContainer)}html?(elem.classList.remove("hide"),page.querySelector(".fldAutoRefreshInterval").classList.remove("hide"),contentType&&"tvshows"!==contentType?page.querySelector(".fldPlaceholderMetadataRefreshInterval").classList.add("hide"):page.querySelector(".fldPlaceholderMetadataRefreshInterval").classList.remove("hide"),page.querySelector(".fldMetadataLanguage").classList.remove("hide"),page.querySelector(".fldMetadataCountry").classList.remove("hide")):(elem.classList.add("hide"),page.querySelector(".fldAutoRefreshInterval").classList.add("hide"),page.querySelector(".fldPlaceholderMetadataRefreshInterval").classList.add("hide"),page.querySelector(".fldMetadataLanguage").classList.add("hide"),page.querySelector(".fldMetadataCountry").classList.add("hide")),html?page.querySelector(".fldImageLanguage").classList.remove("hide"):page.querySelector(".fldImageLanguage").classList.add("hide")}function renderImageFetchers(page,availableOptions,libraryOptions){for(var html="",elem=page.querySelector(".imageFetchers"),i=0,length=availableOptions.TypeOptions.length;i<length;i++){var availableTypeOptions=availableOptions.TypeOptions[i];html+=function(availableTypeOptions,libraryOptionsForType){var html="";return getOrderedPlugins(availableTypeOptions.ImageFetchers||[],libraryOptionsForType.ImageFetcherOrder||[]).length&&(html=(html=html+('<div class="imageFetcher verticalSection verticalSection-extrabottompadding" data-type="'+availableTypeOptions.Type)+'"><div class="sectionTitleContainer">')+'<h2 class="sectionTitle">'+_globalize.default.translate("HeaderTypeImageFetchers",_itemmanager.default.getItemTypeName(availableTypeOptions.Type))+"</h2>",(1<(libraryOptionsForType=availableTypeOptions.SupportedImageTypes||[]).length||1===libraryOptionsForType.length&&"Primary"!==libraryOptionsForType[0])&&(html+='<button is="emby-button" class="raised raised-mini btnImageOptionsForType" type="button" style="margin:0 1.25em;font-size:90%;"><span>'+_globalize.default.translate("HeaderFetcherSettings")+"</span></button>"),html=(html=(html+="</div>")+'<p class="secondaryText" style="margin:.5em 0;">'+_globalize.default.translate("LabelImageFetchersHelp")+"</p>")+'<div class="itemsContainer" is="emby-itemscontainer" data-type="'+availableTypeOptions.Type+'"></div></div>'),html}(availableTypeOptions,getTypeOptions(libraryOptions,availableTypeOptions.Type)||{})}elem.innerHTML=html;for(var itemsContainers=elem.querySelectorAll(".itemsContainer"),_i2=0,_length2=itemsContainers.length;_i2<_length2;_i2++){var itemsContainer=itemsContainers[_i2];itemsContainer.fetchData=getImageFetcherItems.bind(itemsContainer),itemsContainer.getListOptions=getImageFetcherListOptions.bind(itemsContainer)}html?(elem.classList.remove("hide"),page.querySelector(".chkDownloadImagesInAdvanceContainer").classList.remove("hide"),page.querySelector(".chkSaveLocalContainer").classList.remove("hide")):(elem.classList.add("hide"),page.querySelector(".chkDownloadImagesInAdvanceContainer").classList.add("hide"),page.querySelector(".chkSaveLocalContainer").classList.add("hide"))}function populateMetadataSettings(parent,contentType){var isNewLibrary=parent.classList.contains("newlibrary");return ApiClient.getJSON(ApiClient.getUrl("Libraries/AvailableOptions",{LibraryContentType:contentType,IsNewLibrary:isNewLibrary})).then(function(availableOptions){if(currentAvailableOptions=availableOptions,parent.availableOptions=availableOptions,parent.closest(".newlibrary"))for(var i=0,length=currentAvailableOptions.TypeOptions.length;i<length;i++){var availableTypeOptions=currentAvailableOptions.TypeOptions[i],libraryOptionsForType=getTypeOptions(currentLibraryOptions,availableTypeOptions.Type,!0);libraryOptionsForType.MetadataFetchers=(availableTypeOptions.MetadataFetchers||[]).filter(function(m){return m.DefaultEnabled}).map(function(m){return m.Name}),libraryOptionsForType.ImageFetchers=(availableTypeOptions.ImageFetchers||[]).filter(function(m){return m.DefaultEnabled}).map(function(m){return m.Name})}!function(page,metadataSavers){var html="",page=page.querySelector(".metadataSavers");if(metadataSavers.length){for(var html=html+('<h2 class="checkboxListLabel">'+_globalize.default.translate("HeaderMetadataSavers")+"</h2>")+'<div class="checkboxList">',i=0,length=metadataSavers.length;i<length;i++){var plugin=metadataSavers[i];html+='<label><input type="checkbox" data-defaultenabled="'+plugin.DefaultEnabled+'" is="emby-checkbox" class="chkMetadataSaver" data-pluginname="'+plugin.Name+'" '+!1+"><span>"+plugin.Name+"</span></label>"}html=(html+="</div>")+('<div class="fieldDescription" style="margin-top:.25em;">'+_globalize.default.translate("LabelMetadataSaversHelp")+"</div>"),page.innerHTML=html,page.classList.remove("hide")}else page.innerHTML="",page.classList.add("hide")}(parent,availableOptions.MetadataSavers),renderMetadataFetchers(parent,availableOptions,{},contentType),renderImageFetchers(parent,availableOptions,{}),refreshItemsContainers(parent),onMetadataFetchersOrReadersChange.call(parent.querySelector(".metadataFetchers"))}).catch(function(){return Promise.resolve()})}function onImageFetchersContainerClick(e){e=e.target.closest(".btnImageOptionsForType");e&&!function(type){var typeOptions=getTypeOptions(currentLibraryOptions,type),availableOptions=(typeOptions||currentLibraryOptions.TypeOptions.push(typeOptions={Type:type}),getTypeOptions(currentAvailableOptions||{},type));(new _imageoptionseditor.default).show(type,typeOptions,availableOptions)}(e.closest(".imageFetcher").getAttribute("data-type"))}function onMetadataFetchersOrReadersChange(e){for(var parent=this.closest(".libraryOptions"),availableOptions=currentAvailableOptions,allFeatures=[],i=0,length=availableOptions.TypeOptions.length;i<length;i++)for(var availableTypeOptions=availableOptions.TypeOptions[i],plugins=availableTypeOptions.MetadataFetchers||[],j=0;j<plugins.length;j++){var plugin=plugins[j];isMetadataFetcherOriginalItemChecked(plugin,availableTypeOptions.Type)&&(allFeatures=allFeatures.concat(plugin.Features||[]))}allFeatures.includes("Collections")?parent.querySelector(".fldImportCollections").classList.remove("hide"):parent.querySelector(".fldImportCollections").classList.add("hide"),allFeatures.includes("Adult")?parent.querySelector(".fldAdult").classList.remove("hide"):parent.querySelector(".fldAdult").classList.add("hide"),onImportCollectionsChange.call(parent.querySelector(".chkImportCollections"))}function onImportCollectionsChange(e){for(var parent=this.closest(".libraryOptions"),fldMinCollectionSize=parent.querySelector(".fldMinCollectionSize"),allFeatures=[],readers=currentAvailableOptions.MetadataReaders||[],i=0;i<readers.length;i++){var plugin=readers[i];isLocalMetadataReaderOriginalItemChecked(plugin)&&(allFeatures=allFeatures.concat(plugin.Features||[]))}allFeatures.includes("Collections")||this.checked&&parent.querySelector(".fldImportCollections:not(.hide)")?fldMinCollectionSize.classList.remove("hide"):fldMinCollectionSize.classList.add("hide")}function onThumbnailScheduleChange(e){var e=e.target.closest(".thumbnailSettingsSection"),fldThumbnailInterval=e.querySelector(".fldThumbnailInterval"),fldThumbnailInterval=(this.value?fldThumbnailInterval.classList.remove("hide"):fldThumbnailInterval.classList.add("hide"),e.querySelector(".selectThumbnailInterval"));onThumbnailIntervalChange.call(fldThumbnailInterval,{target:fldThumbnailInterval})}function onThumbnailIntervalChange(e){var e=e.target.closest(".thumbnailSettingsSection"),fldSaveThumbnailSetsLocally=e.querySelector(".fldSaveThumbnailSetsLocally"),e=e.querySelector(".selectThumbnailImages");"-1"!==this.value&&e.value?fldSaveThumbnailSetsLocally.classList.remove("hide"):fldSaveThumbnailSetsLocally.classList.add("hide")}function triggerElementEvents(parent){var selectThumbnailImages=parent.querySelector(".selectThumbnailImages"),selectThumbnailImages=(onThumbnailScheduleChange.call(selectThumbnailImages,{target:selectThumbnailImages}),parent.querySelector(".selectThumbnailInterval")),selectThumbnailImages=(onThumbnailIntervalChange.call(selectThumbnailImages,{target:selectThumbnailImages}),parent.querySelector(".chkImportCollections"));onImportCollectionsChange.call(selectThumbnailImages,{target:selectThumbnailImages})}function setContentType(parent,contentType){return"homevideos"===contentType?parent.querySelector(".chkEnablePhotosContainer").classList.remove("hide"):parent.querySelector(".chkEnablePhotosContainer").classList.add("hide"),contentType&&"music"!==contentType&&"audiobooks"!==contentType?parent.querySelector(".fldImportPlaylists").classList.add("hide"):parent.querySelector(".fldImportPlaylists").classList.remove("hide"),"tvshows"!==contentType&&"movies"!==contentType&&"homevideos"!==contentType&&"musicvideos"!==contentType&&"mixed"!==contentType&&contentType?(parent.querySelector(".thumbnailSettingsSection").classList.add("hide"),parent.querySelector(".fldIgnoreSample").classList.add("hide"),parent.querySelector(".txtIgnoreSampleFiles").removeAttribute("required")):(parent.querySelector(".thumbnailSettingsSection").classList.remove("hide"),parent.querySelector(".fldIgnoreSample").classList.remove("hide"),parent.querySelector(".txtIgnoreSampleFiles").setAttribute("required","required")),"tvshows"!==contentType&&contentType?parent.querySelector(".introDetectionSection").classList.add("hide"):parent.querySelector(".introDetectionSection").classList.remove("hide"),"tvshows"!==contentType&&"movies"!==contentType&&"homevideos"!==contentType&&"musicvideos"!==contentType&&"mixed"!==contentType&&"audiobooks"!==contentType&&contentType?(parent.querySelector(".playbackSettings").classList.add("hide"),parent.querySelector(".txtMinResumePct").removeAttribute("required"),parent.querySelector(".txtMaxResumePct").removeAttribute("required"),parent.querySelector(".txtMinResumeDuration").removeAttribute("required")):(parent.querySelector(".playbackSettings").classList.remove("hide"),parent.querySelector(".txtMinResumePct").setAttribute("required","required"),parent.querySelector(".txtMaxResumePct").setAttribute("required","required"),parent.querySelector(".txtMinResumeDuration").setAttribute("required","required")),"music"===contentType||"audiobooks"===contentType?parent.querySelector(".musicFolderStructureSection").classList.remove("hide"):parent.querySelector(".musicFolderStructureSection").classList.add("hide"),"tvshows"!==contentType||ApiClient.isMinServerVersion("4.8.0.59")?parent.querySelector(".chkImportMissingEpisodesContainer").classList.add("hide"):parent.querySelector(".chkImportMissingEpisodesContainer").classList.remove("hide"),"playlists"!==contentType&&"boxsets"!==contentType?parent.querySelector(".fldRealtimeMonitor").classList.remove("hide"):parent.querySelector(".fldRealtimeMonitor").classList.add("hide"),ApiClient.isMinServerVersion("4.8.0.67")&&"playlists"!==contentType&&"boxsets"!==contentType?parent.querySelector(".fldCacheImages").classList.remove("hide"):parent.querySelector(".fldCacheImages").classList.add("hide"),"tvshows"===contentType?parent.querySelector(".chkAutomaticallyGroupSeriesContainer").classList.remove("hide"):parent.querySelector(".chkAutomaticallyGroupSeriesContainer").classList.add("hide"),"games"===contentType||"books"===contentType||"boxsets"===contentType||"playlists"===contentType||"music"===contentType?parent.querySelector(".chkEnableEmbeddedTitlesContainer").classList.add("hide"):parent.querySelector(".chkEnableEmbeddedTitlesContainer").classList.remove("hide"),"audiobooks"===contentType?(parent.querySelector(".selectMusicFolderStructure_artist_album_track").innerHTML=_globalize.default.translate("PerfectAuthorAudioBookTrack"),parent.querySelector(".selectMusicFolderStructure_album_track").innerHTML=_globalize.default.translate("PerfectAudioBookTrack")):(parent.querySelector(".selectMusicFolderStructure_artist_album_track").innerHTML=_globalize.default.translate("PerfectArtistAlbumTrack"),parent.querySelector(".selectMusicFolderStructure_album_track").innerHTML=_globalize.default.translate("PerfectAlbumTrack")),ApiClient.getSystemInfo().then(function(info){"Windows"===info.OperatingSystem?parent.querySelector(".fldSaveMetadataHidden").classList.remove("hide"):parent.querySelector(".fldSaveMetadataHidden").classList.add("hide")}),parent.querySelector(".chkEnableAudioResume").checked="audiobooks"===contentType,populateMetadataSettings(parent,contentType)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;_exports.default={embed:function(parent,contentType,libraryOptions){currentLibraryOptions={TypeOptions:[]};var isNewLibrary=(currentAvailableOptions=null)==libraryOptions;return isNewLibrary&&parent.classList.add("newlibrary"),require(["text!./components/libraryoptionseditor/libraryoptionseditor.template.html"]).then(function(responses){parent.innerHTML=_globalize.default.translateDocument(responses[0]);var select,responses=parent.querySelector(".metadataReaderItemsContainer"),responses=(responses.fetchData=getMetadataReaderItems,responses.getListOptions=getMetadataReaderListOptions,responses.parentContainer=responses.closest(".verticalSection"),parent.querySelector(".subtitleFetchersItemsContainer")),responses=(responses.fetchData=getSubtitleFetcherItems,responses.getListOptions=getSubtitleFetcherListOptions,responses.parentContainer=responses.closest(".subtitleDownloadSettings"),parent.querySelector(".lyricsFetchersItemsContainer")),responses=(responses.fetchData=getLyricsFetcherItems,responses.getListOptions=getLyricsFetcherListOptions,responses.parentContainer=responses.closest(".lyricsDownloadSettings"),populateRefreshInterval(parent.querySelector(".selectAutoRefreshInterval"),[30,60,90]),populateRefreshInterval(parent.querySelector(".selectPlaceholderMetadataRefreshInterval"),[2,3,7,14,30,60,90]),populateMaxDownloadAge(parent.querySelector(".selectSubtitleDownloadMaxAge")),populateMaxDownloadAge(parent.querySelector(".selectLyricsDownloadMaxAge")),[function(parent){return ApiClient.getCultures().then(function(languages){populateLanguagesIntoSelect(parent.querySelector(".selectLanguage"),languages),populateLanguagesIntoSelect(parent.querySelector(".selectImageLanguage"),languages)})}(parent),(select=parent.querySelector(".selectCountry"),ApiClient.getCountries().then(function(allCountries){var html="";html+="<option value=''></option>";for(var i=0,length=allCountries.length;i<length;i++){var culture=allCountries[i];html+="<option value='"+culture.TwoLetterISORegionName+"'>"+culture.DisplayName+"</option>"}select.innerHTML=html}))]);return function(parent){var options=[{name:_globalize.default.translate("ValueSeconds",10),value:10,selected:' selected="selected"'},{name:_globalize.default.translate("ChapterMarkers"),value:-1}];parent.querySelector(".selectThumbnailInterval").innerHTML=options.map(function(o){return"<option"+(o.selected||"")+' value="'+o.value+'">'+o.name+"</option>"}).join("")}(parent),Promise.all(responses).then(function(){return setContentType(parent,contentType).then(function(){libraryOptions?function(parent,options){currentLibraryOptions=options,currentAvailableOptions=parent.availableOptions,parent.querySelector(".selectLanguage").value=options.PreferredMetadataLanguage||"",parent.querySelector(".selectImageLanguage").value=options.PreferredImageLanguage||"",parent.querySelector(".selectCountry").value=options.MetadataCountryCode||"",parent.querySelector(".selectAutoRefreshInterval").value=options.AutomaticRefreshIntervalDays||"0",parent.querySelector(".selectPlaceholderMetadataRefreshInterval").value=options.PlaceholderMetadataRefreshIntervalDays||"0",parent.querySelector(".chkEnablePhotos").checked=options.EnablePhotos,parent.querySelector(".chkImportPlaylists").checked=!1!==options.ImportPlaylists,parent.querySelector(".chkEnableRealtimeMonitor").checked=options.EnableRealtimeMonitor,parent.querySelector(".selectMusicFolderStructure").value=options.MusicFolderStructure||"",parent.querySelector(".txtIgnoreSampleFiles").value=Math.round((options.SampleIgnoreSize||0)/1024/1024),parent.querySelector(".selectMinCollectionSize").value=options.MinCollectionItems||2,parent.querySelector(".chkImportCollections").checked=options.ImportCollections||!1,parent.querySelector(".chkAdult").checked=options.EnableAdultMetadata||!1,parent.querySelector(".selectThumbnailImages").value=options.EnableChapterImageExtraction&&options.ExtractChapterImagesDuringLibraryScan?"scanandtask":options.EnableChapterImageExtraction?"task":"",parent.querySelector(".chkLocalThumbnailSets").checked=options.SaveLocalThumbnailSets,parent.querySelector(".selectThumbnailInterval").value=options.ThumbnailImagesIntervalSeconds||"10",parent.querySelector(".selectIntroDetection").value=options.EnableMarkerDetection&&options.EnableMarkerDetectionDuringLibraryScan?"scanandtask":options.EnableMarkerDetection?"task":"",parent.querySelector(".chkDownloadImagesInAdvance").checked=options.DownloadImagesInAdvance,parent.querySelector(".chkSaveLocal").checked=options.SaveLocalMetadata,parent.querySelector(".chkCacheImages").checked=options.CacheImages||!1,parent.querySelector(".chkImportMissingEpisodes").checked=options.ImportMissingEpisodes,parent.querySelector(".chkAutomaticallyGroupSeries").checked=options.EnableAutomaticSeriesGrouping,parent.querySelector(".chkEnableEmbeddedTitles").checked=options.EnableEmbeddedTitles,parent.querySelector(".chkSkipIfGraphicalSubsPresent").checked=options.SkipSubtitlesIfEmbeddedSubtitlesPresent,parent.querySelector(".chkSaveSubtitlesLocally").checked=options.SaveSubtitlesWithMedia,parent.querySelector(".chkSaveLyricsLocally").checked=options.SaveLyricsWithMedia,parent.querySelector(".selectSubtitleDownloadMaxAge").value=null==options.SubtitleDownloadMaxAgeDays?180:options.SubtitleDownloadMaxAgeDays,parent.querySelector(".chkSkipIfAudioTrackPresent").checked=options.SkipSubtitlesIfAudioTrackMatches,parent.querySelector(".chkRequireHashMatch").checked=options.RequirePerfectSubtitleMatch,parent.querySelector(".chkForcedSubtitlesOnly").checked=options.ForcedSubtitlesOnly,parent.querySelector(".selectLyricsDownloadMaxAge").value=null==options.LyricsDownloadMaxAgeDays?180:options.LyricsDownloadMaxAgeDays,parent.querySelector(".txtMinResumePct").value=null==options.MinResumePct?"2":options.MinResumePct,parent.querySelector(".txtMaxResumePct").value=null==options.MaxResumePct?"90":options.MaxResumePct,parent.querySelector(".txtMinResumeDuration").value=null==options.MinResumeDurationSeconds?"120":options.MinResumeDurationSeconds,parent.querySelector(".chkSaveMetadataHidden").checked=options.SaveMetadataHidden||!1,Array.prototype.forEach.call(parent.querySelectorAll(".chkMetadataSaver"),function(elem){elem.checked=options.MetadataSavers?-1!==options.MetadataSavers.indexOf(elem.getAttribute("data-pluginname")):"true"===elem.getAttribute("data-defaultenabled")}),parent.querySelector(".selectSubtitleLanguages").values=options.SubtitleDownloadLanguages||[],parent.querySelector(".selectLyricsLanguages").values=options.LyricsDownloadLanguages||[],renderMetadataFetchers(parent,parent.availableOptions,options,options.ContentType),renderImageFetchers(parent,parent.availableOptions,options),refreshItemsContainers(parent),triggerElementEvents(parent)}(parent,libraryOptions):function(parent){parent.querySelector(".selectSubtitleLanguages").values=[],parent.querySelector(".selectLyricsLanguages").values=[]}(parent),triggerElementEvents(parent),onMetadataFetchersOrReadersChange.call(parent.querySelector(".metadataFetchers")),function(parent){parent.querySelector(".imageFetchers").addEventListener("click",onImageFetchersContainerClick),parent.querySelector(".selectThumbnailImages").addEventListener("change",onThumbnailScheduleChange),parent.querySelector(".selectThumbnailInterval").addEventListener("change",onThumbnailIntervalChange),parent.querySelector(".chkImportCollections").addEventListener("change",onImportCollectionsChange),parent.querySelector(".metadataFetchers").addEventListener("change",onMetadataFetchersOrReadersChange),parent.querySelector(".metadataReaders").addEventListener("change",onMetadataFetchersOrReadersChange);var selectSubtitleLanguages=parent.querySelector(".selectSubtitleLanguages");selectSubtitleLanguages.getItems=getSelectLanguages.bind(selectSubtitleLanguages),(selectSubtitleLanguages=parent.querySelector(".selectLyricsLanguages")).getItems=getSelectLanguages.bind(selectSubtitleLanguages)}(parent)})})})},setContentType:setContentType,getLibraryOptions:function(parent){var options=Object.assign(currentLibraryOptions,{EnableArchiveMediaFiles:!1,EnablePhotos:parent.querySelector(".chkEnablePhotos").checked,ImportPlaylists:parent.querySelector(".chkImportPlaylists").checked,SampleIgnoreSize:1024*parent.querySelector(".txtIgnoreSampleFiles").value*1024,EnableRealtimeMonitor:parent.querySelector(".chkEnableRealtimeMonitor").checked,ExtractChapterImagesDuringLibraryScan:"scanandtask"===parent.querySelector(".selectThumbnailImages").value,EnableChapterImageExtraction:!!parent.querySelector(".selectThumbnailImages").value,EnableMarkerDetectionDuringLibraryScan:"scanandtask"===parent.querySelector(".selectIntroDetection").value,EnableMarkerDetection:!!parent.querySelector(".selectIntroDetection").value,SaveLocalThumbnailSets:parent.querySelector(".chkLocalThumbnailSets").checked,ThumbnailImagesIntervalSeconds:parent.querySelector(".selectThumbnailInterval").value,DownloadImagesInAdvance:parent.querySelector(".chkDownloadImagesInAdvance").checked,EnableInternetProviders:!0,ImportMissingEpisodes:parent.querySelector(".chkImportMissingEpisodes").checked,SaveLocalMetadata:parent.querySelector(".chkSaveLocal").checked,CacheImages:parent.querySelector(".chkCacheImages").checked,EnableAutomaticSeriesGrouping:parent.querySelector(".chkAutomaticallyGroupSeries").checked,PreferredMetadataLanguage:parent.querySelector(".selectLanguage").value,PreferredImageLanguage:parent.querySelector(".selectImageLanguage").value,MetadataCountryCode:parent.querySelector(".selectCountry").value,AutomaticRefreshIntervalDays:parseInt(parent.querySelector(".selectAutoRefreshInterval").value),PlaceholderMetadataRefreshIntervalDays:parseInt(parent.querySelector(".selectPlaceholderMetadataRefreshInterval").value),EnableEmbeddedTitles:parent.querySelector(".chkEnableEmbeddedTitles").checked,SkipSubtitlesIfEmbeddedSubtitlesPresent:parent.querySelector(".chkSkipIfGraphicalSubsPresent").checked,SkipSubtitlesIfAudioTrackMatches:parent.querySelector(".chkSkipIfAudioTrackPresent").checked,SaveSubtitlesWithMedia:parent.querySelector(".chkSaveSubtitlesLocally").checked,SaveLyricsWithMedia:parent.querySelector(".chkSaveLyricsLocally").checked,SubtitleDownloadMaxAgeDays:parent.querySelector(".selectSubtitleDownloadMaxAge").value,LyricsDownloadMaxAgeDays:parent.querySelector(".selectLyricsDownloadMaxAge").value,RequirePerfectSubtitleMatch:parent.querySelector(".chkRequireHashMatch").checked,ForcedSubtitlesOnly:parent.querySelector(".chkForcedSubtitlesOnly").checked,EnableAudioResume:parent.querySelector(".chkEnableAudioResume").checked,MinResumePct:parent.querySelector(".txtMinResumePct").value,MaxResumePct:parent.querySelector(".txtMaxResumePct").value,MinResumeDurationSeconds:parent.querySelector(".txtMinResumeDuration").value,MusicFolderStructure:parent.querySelector(".selectMusicFolderStructure").value||null,ImportCollections:parent.querySelector(".chkImportCollections").checked,SaveMetadataHidden:parent.querySelector(".chkSaveMetadataHidden").checked,EnableAdultMetadata:parent.querySelector(".chkAdult").checked,MinCollectionItems:parseInt(parent.querySelector(".selectMinCollectionSize").value),MetadataSavers:Array.prototype.map.call(Array.prototype.filter.call(parent.querySelectorAll(".chkMetadataSaver"),function(elem){return elem.checked}),function(elem){return elem.getAttribute("data-pluginname")})});return options.TypeOptions||(options.TypeOptions=[]),options.SubtitleDownloadLanguages=parent.querySelector(".selectSubtitleLanguages").values,options.LyricsDownloadLanguages=parent.querySelector(".selectLyricsLanguages").values,options},setAdvancedVisible:function(parent,visible){for(var elems=parent.querySelectorAll(".advanced"),i=0,length=elems.length;i<length;i++)visible?elems[i].classList.remove("advancedHide"):elems[i].classList.add("advancedHide")}}});