define(["exports","./../modules/emby-apiclient/connectionmanager.js","./../modules/layoutmanager.js","./../modules/cardbuilder/cardbuilder.js","./../modules/tabbedview/basetab.js","./../modules/emby-elements/emby-itemscontainer/emby-itemscontainer.js","./../modules/emby-elements/emby-scroller/emby-scroller.js"],function(_exports,_connectionmanager,_layoutmanager,_cardbuilder,_basetab,_embyItemscontainer,_embyScroller){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;var msPerDay=864e5;function TvSuggestionsTab(view,params){_basetab.default.apply(this,arguments),this.view=view,this.params=params,this.apiClient=_connectionmanager.default.getApiClient(params.serverId),function(view){for(var containers=view.querySelectorAll(".autoScrollSection"),i=0,length=containers.length;i<length;i++){var section=containers[i],sectionType=section.getAttribute("data-section"),commands="",sectionType='<div is="emby-scroller" class="padded-top-focusscale padded-bottom-focusscale padded-left padded-left-page padded-right" data-mousewheel="false" data-focusscroll="true"><div is="emby-itemscontainer"'+(commands="resume"===sectionType?' data-commands="removefromresume"':commands)+' data-focusabletype="nearest" class="itemsContainer scrollSlider focusable focuscontainer-x" data-monitor="videoplayback,markplayed" data-virtualscrolllayout="horizontal-grid"></div></div>';section.insertAdjacentHTML("beforeend",sectionType)}}(view),this.resumeItemsContainer=view.querySelector(".resumeSection .itemsContainer"),this.resumeItemsContainer.fetchData=function(query){var apiClient=this.apiClient,parentId=this.params.parentId;return apiClient.getResumableItems(apiClient.getCurrentUserId(),Object.assign({IncludeItemTypes:"Episode",Fields:this.getRequestedItemFields()+",PrimaryImageAspectRatio",ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:this.getRequestedImageTypes()},query))}.bind(this),this.resumeItemsContainer.getListOptions=function(){var enableFocusPreview=this.enableFocusPreview();return{renderer:_cardbuilder.default,options:{preferThumb:!0,shape:"backdrop",scalable:!0,fields:enableFocusPreview?[]:["ParentName","Name"],centerText:!0,overlayPlayButton:!0,cardLayout:!1,focusTransformTitleAdjust:!0,animateProgressBar:!0,bottomPadding:enableFocusPreview?"focuspreview":null},virtualScrollLayout:"horizontal-grid"}}.bind(this),this.resumeItemsContainer.parentContainer=view.querySelector(".resumeSection"),this.addFocusBehavior(this.resumeItemsContainer),this.latestItemsContainer=view.querySelector(".latestSection .itemsContainer"),this.latestItemsContainer.fetchData=function(query){var parentId=this.params.parentId;return this.apiClient.getLatestItems(Object.assign({IncludeItemTypes:"Episode",Limit:30,Fields:this.getRequestedItemFields()+",PrimaryImageAspectRatio",ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:this.getRequestedImageTypes(),GroupItems:!0}),query)}.bind(this),this.latestItemsContainer.getListOptions=function(){var enableFocusPreview=this.enableFocusPreview();return{renderer:_cardbuilder.default,options:{preferThumb:!0,shape:"backdrop",scalable:!0,fields:enableFocusPreview?[]:["Name"],centerText:!0,overlayPlayButton:!0,cardLayout:!1,focusTransformTitleAdjust:!0,bottomPadding:enableFocusPreview?"focuspreview":null},virtualScrollLayout:"horizontal-grid"}}.bind(this),this.latestItemsContainer.parentContainer=view.querySelector(".latestSection"),this.addFocusBehavior(this.latestItemsContainer),this.recentlyReleasedItemsContainer=view.querySelector(".recentlyReleasedSection .itemsContainer"),this.recentlyReleasedItemsContainer.fetchData=function(query){var parentId=this.params.parentId,apiClient=this.apiClient,minPremiereDate=new Date(Date.now());return minPremiereDate.setTime(minPremiereDate.getTime()-14*msPerDay),apiClient.getItems(apiClient.getCurrentUserId(),Object.assign({Fields:this.getRequestedItemFields()+",PrimaryImageAspectRatio",IncludeItemTypes:"Episode",ParentId:parentId,Recursive:!0,SortBy:"ProductionYear,PremiereDate,SortParentIndexNumber,SortIndexNumber",SortOrder:"Descending,Descending,Ascending,Ascending",MinPremiereDate:minPremiereDate.toISOString(),IsUnaired:!1},query))}.bind(this),this.recentlyReleasedItemsContainer.getListOptions=function(){var enableFocusPreview=this.enableFocusPreview();return{renderer:_cardbuilder.default,options:{preferThumb:!0,shape:"backdrop",scalable:!0,fields:enableFocusPreview?[]:["ParentName","Name"],centerText:!0,overlayPlayButton:!0,cardLayout:!1,focusTransformTitleAdjust:!0,animateProgressBar:!0,bottomPadding:enableFocusPreview?"focuspreview":null},virtualScrollLayout:"horizontal-grid"}}.bind(this),this.recentlyReleasedItemsContainer.parentContainer=view.querySelector(".recentlyReleasedSection"),this.addFocusBehavior(this.recentlyReleasedItemsContainer),params.parentId&&(this.resumeItemsContainer.setAttribute("data-parentid",params.parentId),this.latestItemsContainer.setAttribute("data-parentid",params.parentId),this.recentlyReleasedItemsContainer.setAttribute("data-parentid",params.parentId))}Object.assign(TvSuggestionsTab.prototype,_basetab.default.prototype),TvSuggestionsTab.prototype.enablePushDownFocusPreview=function(){return _layoutmanager.default.tv&&"y"===this.scrollDirection()},TvSuggestionsTab.prototype.onResume=function(options){_basetab.default.prototype.onResume.apply(this,arguments);var promises=[],instance=(promises.push(this.resumeItemsContainer.resume(options)),promises.push(this.latestItemsContainer.resume(options)),promises.push(this.recentlyReleasedItemsContainer.resume(options)),this);Promise.all(promises).then(function(){options.autoFocus&&instance.autoFocus(),instance.fillFocusPreviewIfNeeded()})},TvSuggestionsTab.prototype.onPause=function(){_basetab.default.prototype.onPause.apply(this,arguments),this.resumeItemsContainer.pause(),this.latestItemsContainer.pause(),this.recentlyReleasedItemsContainer.pause()},TvSuggestionsTab.prototype.destroy=function(){_basetab.default.prototype.destroy.apply(this,arguments),this.resumeItemsContainer=null,this.latestItemsContainer=null,this.recentlyReleasedItemsContainer=null};_exports.default=TvSuggestionsTab});